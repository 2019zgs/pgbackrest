{
   "co6" : {
      "all" : {
         "user-guide" : [
            {
               "key" : {
                  "image" : "pgbackrest/test:co6-s3-server",
                  "name" : "s3-server",
                  "os" : "co6"
               },
               "type" : "host",
               "value" : {
                  "ip" : "172.17.0.2"
               }
            },
            {
               "key" : {
                  "image" : "pgbackrest/test:co6-base",
                  "name" : "db-primary",
                  "os" : "co6"
               },
               "type" : "host",
               "value" : {
                  "ip" : "172.17.0.3"
               }
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres perl -V | grep USE_64_BIT_INT"
                  ],
                  "host" : "db-primary",
                  "output" : true
               },
               "type" : "exe",
               "value" : {
                  "output" : [
                     "                        USE_64_BIT_INT USE_ITHREADS USE_LARGE_FILES"
                  ]
               }
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo rm -f /usr/bin/pgbackrest"
                  ],
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo rm -f /usr/bin/pg_backrest"
                  ],
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo rm -rf /usr/lib/perl5/BackRest"
                  ],
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo rm -rf /usr/share/perl5/BackRest"
                  ],
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo rm -rf /usr/lib/perl5/pgBackRest"
                  ],
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo rm -rf /usr/share/perl5/pgBackRest"
                  ],
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo yum install perl perl-Time-HiRes perl-parent perl-JSON \\",
                     "    perl-Digest-SHA perl-DBD-Pg perl-XML-LibXML perl-IO-Socket-SSL"
                  ],
                  "cmd-extra" : "-y",
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo mkdir /root/pgbackrest-release-1.29"
                  ],
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo cp -r /backrest/bin /root/pgbackrest-release-1.29"
                  ],
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo cp -r /backrest/build /root/pgbackrest-release-1.29"
                  ],
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo cp -r /backrest/lib /root/pgbackrest-release-1.29"
                  ],
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo cp -r /backrest/libc /root/pgbackrest-release-1.29"
                  ],
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo cp -r /backrest/src /root/pgbackrest-release-1.29"
                  ],
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo cp -r /root/pgbackrest-release-1.29/lib/pgBackRest \\",
                     "    /usr/share/perl5"
                  ],
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo find /usr/share/perl5/pgBackRest -type f -exec chmod 644 {} +"
                  ],
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo find /usr/share/perl5/pgBackRest -type d -exec chmod 755 {} +"
                  ],
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo cp /root/pgbackrest-release-1.29/bin/pgbackrest /usr/bin/pgbackrest"
                  ],
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo chmod 755 /usr/bin/pgbackrest"
                  ],
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo mkdir -m 770 /var/log/pgbackrest"
                  ],
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo chown postgres:postgres /var/log/pgbackrest"
                  ],
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo touch /etc/pgbackrest.conf"
                  ],
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo chmod 640 /etc/pgbackrest.conf"
                  ],
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo chown postgres:postgres /etc/pgbackrest.conf"
                  ],
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo sh -c 'cd /root/pgbackrest-release-1.29/libc && \\",
                     "    perl Makefile.PL INSTALLMAN1DIR=none INSTALLMAN3DIR=none'"
                  ],
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo make -C /root/pgbackrest-release-1.29/libc test"
                  ],
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo make -C /root/pgbackrest-release-1.29/libc install"
                  ],
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres pgbackrest"
                  ],
                  "host" : "db-primary",
                  "output" : true
               },
               "type" : "exe",
               "value" : {
                  "output" : [
                     "pgBackRest 1.29 - General help",
                     "",
                     "Usage:",
                     "    pgbackrest [options] [command]",
                     "",
                     "Commands:",
                     "    archive-get     Get a WAL segment from the archive.",
                     "    archive-push    Push a WAL segment to the archive.",
                     "    backup          Backup a database cluster.",
                     "    check           Check the configuration.",
                     "    expire          Expire backups that exceed retention.",
                     "    help            Get help.",
                     "    info            Retrieve information about backups.",
                     "    restore         Restore a database cluster.",
                     "    stanza-create   Create the required stanza data.",
                     "    stanza-delete   Delete a stanza.",
                     "    stanza-upgrade  Upgrade a stanza.",
                     "    start           Allow pgBackRest processes to run.",
                     "    stop            Stop pgBackRest processes from running.",
                     "    version         Get version.",
                     "",
                     "Use 'pgbackrest help [command]' for more information."
                  ]
               }
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo service postgresql-9.5 initdb"
                  ],
                  "host" : "db-primary",
                  "output" : true
               },
               "type" : "exe",
               "value" : {
                  "output" : [
                     "Initializing database: [  OK  ]\r"
                  ]
               }
            },
            {
               "key" : {
                  "file" : "/var/lib/pgsql/9.5/data/postgresql.conf",
                  "host" : "db-primary",
                  "option" : {
                     "listen_addresses" : {
                        "value" : "'*'"
                     }
                  }
               },
               "type" : "cfg-postgresql",
               "value" : {
                  "config" : [
                     "listen_addresses = '*'"
                  ]
               }
            },
            {
               "key" : {
                  "file" : "/var/lib/pgsql/9.5/data/postgresql.conf",
                  "host" : "db-primary",
                  "option" : {
                     "log_line_prefix" : {
                        "value" : "''"
                     }
                  }
               },
               "type" : "cfg-postgresql",
               "value" : {
                  "config" : [
                     "listen_addresses = '*'",
                     "log_line_prefix = ''"
                  ]
               }
            },
            {
               "key" : {
                  "file" : "/var/lib/pgsql/9.5/data/postgresql.conf",
                  "host" : "db-primary",
                  "option" : {
                     "log_filename" : {
                        "value" : "'postgresql.log'"
                     }
                  }
               },
               "type" : "cfg-postgresql",
               "value" : {
                  "config" : [
                     "listen_addresses = '*'",
                     "log_filename = 'postgresql.log'",
                     "log_line_prefix = ''"
                  ]
               }
            },
            {
               "key" : {
                  "file" : "/etc/pgbackrest.conf",
                  "host" : "db-primary",
                  "option" : {
                     "demo" : {
                        "db-path" : {
                           "value" : "/var/lib/pgsql/9.5/data"
                        }
                     },
                     "global" : {
                        "log-level-stderr" : {
                           "value" : "off"
                        },
                        "log-timestamp" : {
                           "value" : "n"
                        }
                     }
                  }
               },
               "type" : "cfg-pgbackrest",
               "value" : {
                  "config" : [
                     "[demo]",
                     "db-path=/var/lib/pgsql/9.5/data"
                  ]
               }
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo mkdir /var/lib/pgbackrest"
                  ],
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo chmod 750 /var/lib/pgbackrest"
                  ],
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo chown postgres:postgres /var/lib/pgbackrest"
                  ],
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "file" : "/etc/pgbackrest.conf",
                  "host" : "db-primary",
                  "option" : {
                     "global" : {
                        "repo-path" : {
                           "value" : "/var/lib/pgbackrest"
                        }
                     }
                  }
               },
               "type" : "cfg-pgbackrest",
               "value" : {
                  "config" : [
                     "[demo]",
                     "db-path=/var/lib/pgsql/9.5/data",
                     "",
                     "[global]",
                     "repo-path=/var/lib/pgbackrest"
                  ]
               }
            },
            {
               "key" : {
                  "file" : "/var/lib/pgsql/9.5/data/postgresql.conf",
                  "host" : "db-primary",
                  "option" : {
                     "archive_command" : {
                        "value" : "'pgbackrest --stanza=demo archive-push %p'"
                     },
                     "archive_mode" : {
                        "value" : "on"
                     },
                     "max_wal_senders" : {
                        "value" : "3"
                     },
                     "wal_level" : {
                        "value" : "hot_standby"
                     }
                  }
               },
               "type" : "cfg-postgresql",
               "value" : {
                  "config" : [
                     "archive_command = 'pgbackrest --stanza=demo archive-push %p'",
                     "archive_mode = on",
                     "listen_addresses = '*'",
                     "log_filename = 'postgresql.log'",
                     "log_line_prefix = ''",
                     "max_wal_senders = 3",
                     "wal_level = hot_standby"
                  ]
               }
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo service postgresql-9.5 restart"
                  ],
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres sleep 2"
                  ],
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "file" : "/etc/pgbackrest.conf",
                  "host" : "db-primary",
                  "option" : {
                     "global" : {
                        "retention-full" : {
                           "value" : "2"
                        }
                     }
                  }
               },
               "type" : "cfg-pgbackrest",
               "value" : {
                  "config" : [
                     "[demo]",
                     "db-path=/var/lib/pgsql/9.5/data",
                     "",
                     "[global]",
                     "repo-path=/var/lib/pgbackrest",
                     "retention-full=2"
                  ]
               }
            },
            {
               "key" : {
                  "file" : "/etc/pgbackrest.conf",
                  "host" : "db-primary",
                  "option" : {
                     "global" : {
                        "repo-cipher-pass" : {
                           "value" : "zWaf6XtpjIVZC5444yXB+cgFDFl7MxGlgkZSaoPvTGirhPygu4jOKOXf9LO4vjfO"
                        },
                        "repo-cipher-type" : {
                           "value" : "aes-256-cbc"
                        }
                     }
                  }
               },
               "type" : "cfg-pgbackrest",
               "value" : {
                  "config" : [
                     "[demo]",
                     "db-path=/var/lib/pgsql/9.5/data",
                     "",
                     "[global]",
                     "repo-cipher-pass=zWaf6XtpjIVZC5444yXB+cgFDFl7MxGlgkZSaoPvTGirhPygu4jOKOXf9LO4vjfO",
                     "repo-cipher-type=aes-256-cbc",
                     "repo-path=/var/lib/pgbackrest",
                     "retention-full=2"
                  ]
               }
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres pgbackrest --stanza=demo --log-level-console=info stanza-create"
                  ],
                  "highlight" : {
                     "filter" : true,
                     "filter-context" : 2,
                     "list" : [
                        "completed successfully"
                     ]
                  },
                  "host" : "db-primary",
                  "output" : true
               },
               "type" : "exe",
               "value" : {
                  "output" : [
                     "P00   INFO: stanza-create command begin 1.29: --db1-path=/var/lib/pgsql/9.5/data --log-level-console=info --log-level-stderr=off --no-log-timestamp --repo-cipher-pass=<redacted> --repo-cipher-type=aes-256-cbc --repo-path=/var/lib/pgbackrest --stanza=demo",
                     "P00   INFO: stanza-create command end: completed successfully"
                  ]
               }
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres pgbackrest --stanza=demo --log-level-console=info check"
                  ],
                  "highlight" : {
                     "filter" : true,
                     "filter-context" : 2,
                     "list" : [
                        " successfully stored in the archive at "
                     ]
                  },
                  "host" : "db-primary",
                  "output" : true
               },
               "type" : "exe",
               "value" : {
                  "output" : [
                     "P00   INFO: check command begin 1.29: --db1-path=/var/lib/pgsql/9.5/data --log-level-console=info --log-level-stderr=off --no-log-timestamp --repo-cipher-pass=<redacted> --repo-cipher-type=aes-256-cbc --repo-path=/var/lib/pgbackrest --stanza=demo",
                     "P00   INFO: WAL segment 000000010000000000000001 successfully stored in the archive at '/var/lib/pgbackrest/archive/demo/9.5-1/0000000100000000/000000010000000000000001-a76d4770a7303d50fa20fa070753769766ce7e20.gz'",
                     "P00   INFO: check command end: completed successfully"
                  ]
               }
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres pgbackrest --stanza=demo \\",
                     "    --log-level-console=info backup"
                  ],
                  "highlight" : {
                     "filter" : true,
                     "filter-context" : 2,
                     "list" : [
                        "no prior backup exists|full backup size"
                     ]
                  },
                  "host" : "db-primary",
                  "output" : true
               },
               "type" : "exe",
               "value" : {
                  "output" : [
                     "P00   INFO: backup command begin 1.29: --db1-path=/var/lib/pgsql/9.5/data --log-level-console=info --log-level-stderr=off --no-log-timestamp --repo-cipher-pass=<redacted> --repo-cipher-type=aes-256-cbc --repo-path=/var/lib/pgbackrest --retention-full=2 --stanza=demo",
                     "P00   WARN: no prior backup exists, incr backup has been changed to full",
                     "P00   INFO: execute exclusive pg_start_backup() with label \"pgBackRest backup started at 2018-07-05 22:08:07\": backup begins after the next regular checkpoint completes",
                     "P00   INFO: backup start archive = 000000010000000000000002, lsn = 0/2000028",
                     "       [filtered 851 lines of output]",
                     "P01   INFO: backup file /var/lib/pgsql/9.5/data/base/1/13085 (0B, 100%)",
                     "P01   INFO: backup file /var/lib/pgsql/9.5/data/base/1/13080 (0B, 100%)",
                     "P00   INFO: full backup size = 21.3MB",
                     "P00   INFO: execute exclusive pg_stop_backup() and wait for all WAL segments to archive",
                     "P00   INFO: backup stop archive = 000000010000000000000002, lsn = 0/2000130",
                     "       [filtered 4 lines of output]"
                  ]
               }
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres ls -1 /var/lib/pgbackrest/backup/demo | tail -5 | head -1"
                  ],
                  "host" : "db-primary",
                  "output" : true
               },
               "type" : "exe",
               "value" : {
                  "output" : [
                     "20180705-220807F"
                  ]
               }
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres pgbackrest --stanza=demo --type=diff \\",
                     "    --log-level-console=info backup"
                  ],
                  "highlight" : {
                     "filter" : true,
                     "filter-context" : 2,
                     "list" : [
                        "diff backup size"
                     ]
                  },
                  "host" : "db-primary",
                  "output" : true
               },
               "type" : "exe",
               "value" : {
                  "output" : [
                     "       [filtered 4 lines of output]",
                     "P01   INFO: backup file /var/lib/pgsql/9.5/data/global/pg_control (8KB, 97%) checksum 1beb26bdec1af179493361b40f1b3eb5daadc435",
                     "P01   INFO: backup file /var/lib/pgsql/9.5/data/backup_label (236B, 100%) checksum 8833ba28644f9cda20065b921e52eb980a63fce9",
                     "P00   INFO: diff backup size = 8.2KB",
                     "P00   INFO: execute exclusive pg_stop_backup() and wait for all WAL segments to archive",
                     "P00   INFO: backup stop archive = 000000010000000000000003, lsn = 0/30000F8",
                     "       [filtered 4 lines of output]"
                  ]
               }
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres pgbackrest info"
                  ],
                  "highlight" : {
                     "filter" : false,
                     "filter-context" : 2,
                     "list" : [
                        "(full|incr|diff) backup"
                     ]
                  },
                  "host" : "db-primary",
                  "output" : true
               },
               "type" : "exe",
               "value" : {
                  "output" : [
                     "stanza: demo",
                     "    status: ok",
                     "",
                     "    db (current)",
                     "        wal archive min/max (9.5-1): 000000010000000000000002 / 000000010000000000000003",
                     "",
                     "        full backup: 20180705-220807F",
                     "            timestamp start/stop: 2018-07-05 22:08:07 / 2018-07-05 22:08:19",
                     "            wal start/stop: 000000010000000000000002 / 000000010000000000000002",
                     "            database size: 21.3MB, backup size: 21.3MB",
                     "            repository size: 2.4MB, repository backup size: 2.4MB",
                     "",
                     "        diff backup: 20180705-220807F_20180705-220820D",
                     "            timestamp start/stop: 2018-07-05 22:08:20 / 2018-07-05 22:08:23",
                     "            wal start/stop: 000000010000000000000003 / 000000010000000000000003",
                     "            database size: 21.3MB, backup size: 8.2KB",
                     "            repository size: 2.4MB, repository backup size: 400B",
                     "            backup reference list: 20180705-220807F"
                  ]
               }
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo service postgresql-9.5 stop"
                  ],
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres rm /var/lib/pgsql/9.5/data/global/pg_control"
                  ],
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres sleep 2"
                  ],
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo rm -f /var/lib/pgsql/9.5/pgstartup.log"
                  ],
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo service postgresql-9.5 start"
                  ],
                  "err-expect" : "1",
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo cat /var/lib/pgsql/9.5/pgstartup.log"
                  ],
                  "highlight" : {
                     "filter" : true,
                     "filter-context" : 2,
                     "list" : [
                        "could not find the database system"
                     ]
                  },
                  "host" : "db-primary",
                  "output" : true
               },
               "type" : "exe",
               "value" : {
                  "output" : [
                     "postmaster: could not find the database system",
                     "Expected to find it in the directory \"/var/lib/pgsql/9.5/data\",",
                     "but could not open file \"/var/lib/pgsql/9.5/data/global/pg_control\": No such file or directory"
                  ]
               }
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres find /var/lib/pgsql/9.5/data -mindepth 1 -delete"
                  ],
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres pgbackrest --stanza=demo restore"
                  ],
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo service postgresql-9.5 start"
                  ],
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres sleep 2"
                  ],
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres pgbackrest --stanza=demo --type=incr \\",
                     "    --log-level-console=info backup"
                  ],
                  "highlight" : {
                     "filter" : true,
                     "filter-context" : 2,
                     "list" : [
                        "backup begins after the next regular checkpoint completes"
                     ]
                  },
                  "host" : "db-primary",
                  "output" : true
               },
               "type" : "exe",
               "value" : {
                  "output" : [
                     "P00   INFO: backup command begin 1.29: --db1-path=/var/lib/pgsql/9.5/data --log-level-console=info --log-level-stderr=off --no-log-timestamp --repo-cipher-pass=<redacted> --repo-cipher-type=aes-256-cbc --repo-path=/var/lib/pgbackrest --retention-full=2 --stanza=demo --type=incr",
                     "P00   INFO: last backup label = 20180705-220807F_20180705-220820D, version = 1.29",
                     "P00   INFO: execute exclusive pg_start_backup() with label \"pgBackRest backup started at 2018-07-05 22:08:42\": backup begins after the next regular checkpoint completes",
                     "P00   INFO: backup start archive = 000000020000000000000005, lsn = 0/5000028",
                     "P01   INFO: backup file /var/lib/pgsql/9.5/data/pg_multixact/offsets/0000 (8KB, 31%) checksum 0631457264ff7f8d5fb1edc2c0211992a67c73e6",
                     "       [filtered 11 lines of output]"
                  ]
               }
            },
            {
               "key" : {
                  "file" : "/etc/pgbackrest.conf",
                  "host" : "db-primary",
                  "option" : {
                     "global" : {
                        "start-fast" : {
                           "value" : "y"
                        }
                     }
                  }
               },
               "type" : "cfg-pgbackrest",
               "value" : {
                  "config" : [
                     "[demo]",
                     "db-path=/var/lib/pgsql/9.5/data",
                     "",
                     "[global]",
                     "repo-cipher-pass=zWaf6XtpjIVZC5444yXB+cgFDFl7MxGlgkZSaoPvTGirhPygu4jOKOXf9LO4vjfO",
                     "repo-cipher-type=aes-256-cbc",
                     "repo-path=/var/lib/pgbackrest",
                     "retention-full=2",
                     "start-fast=y"
                  ]
               }
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres pgbackrest --stanza=demo --type=incr \\",
                     "    --log-level-console=info backup"
                  ],
                  "highlight" : {
                     "filter" : true,
                     "filter-context" : 2,
                     "list" : [
                        "backup begins after the requested immediate checkpoint completes"
                     ]
                  },
                  "host" : "db-primary",
                  "output" : true
               },
               "type" : "exe",
               "value" : {
                  "output" : [
                     "P00   INFO: backup command begin 1.29: --db1-path=/var/lib/pgsql/9.5/data --log-level-console=info --log-level-stderr=off --no-log-timestamp --repo-cipher-pass=<redacted> --repo-cipher-type=aes-256-cbc --repo-path=/var/lib/pgbackrest --retention-full=2 --stanza=demo --start-fast --type=incr",
                     "P00   INFO: last backup label = 20180705-220807F_20180705-220842I, version = 1.29",
                     "P00   INFO: execute exclusive pg_start_backup() with label \"pgBackRest backup started at 2018-07-05 22:08:47\": backup begins after the requested immediate checkpoint completes",
                     "P00   INFO: backup start archive = 000000020000000000000006, lsn = 0/6000028",
                     "P01   INFO: backup file /var/lib/pgsql/9.5/data/global/pg_control (8KB, 97%) checksum c60278eb2c060aa6b599f02b6e17ae7f608d1606",
                     "       [filtered 8 lines of output]"
                  ]
               }
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo chmod 550 /var/lib/pgbackrest/backup/demo/"
                  ],
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres pgbackrest --stanza=demo --type=incr \\",
                     "    --log-level-console=info backup"
                  ],
                  "err-expect" : "47",
                  "highlight" : {
                     "filter" : true,
                     "filter-context" : 2,
                     "list" : [
                        "ERROR:"
                     ]
                  },
                  "host" : "db-primary",
                  "output" : true
               },
               "type" : "exe",
               "value" : {
                  "output" : [
                     "       [filtered 2 lines of output]",
                     "P00   INFO: execute exclusive pg_start_backup() with label \"pgBackRest backup started at 2018-07-05 22:08:52\": backup begins after the requested immediate checkpoint completes",
                     "P00   INFO: backup start archive = 000000020000000000000007, lsn = 0/7000028",
                     "P00  ERROR: [047]: unable to create path '/var/lib/pgbackrest/backup/demo/20180705-220807F_20180705-220852I': Permission denied",
                     "P00   INFO: backup command end: aborted with exception [047]"
                  ]
               }
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo chmod 750 /var/lib/pgbackrest/backup/demo/"
                  ],
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres pgbackrest --stanza=demo --type=incr \\",
                     "    --log-level-console=info backup"
                  ],
                  "err-expect" : "57",
                  "highlight" : {
                     "filter" : true,
                     "filter-context" : 2,
                     "list" : [
                        "ERROR:"
                     ]
                  },
                  "host" : "db-primary",
                  "output" : true
               },
               "type" : "exe",
               "value" : {
                  "output" : [
                     "P00   INFO: backup command begin 1.29: --db1-path=/var/lib/pgsql/9.5/data --log-level-console=info --log-level-stderr=off --no-log-timestamp --repo-cipher-pass=<redacted> --repo-cipher-type=aes-256-cbc --repo-path=/var/lib/pgbackrest --retention-full=2 --stanza=demo --start-fast --type=incr",
                     "P00   INFO: last backup label = 20180705-220807F_20180705-220847I, version = 1.29",
                     "P00   INFO: execute exclusive pg_start_backup() with label \"pgBackRest backup started at 2018-07-05 22:08:54\": backup begins after the requested immediate checkpoint completes",
                     "P00  ERROR: [057]: ERROR:  a backup is already in progress",
                     "            HINT:  Run pg_stop_backup() and try again.:",
                     "            select to_char(current_timestamp, 'YYYY-MM-DD HH24:MI:SS.US TZ'), pg_xlogfile_name(lsn), lsn::text from pg_start_backup('pgBackRest backup started at 2018-07-05 22:08:54', true) as lsn"
                  ]
               }
            },
            {
               "key" : {
                  "file" : "/etc/pgbackrest.conf",
                  "host" : "db-primary",
                  "option" : {
                     "global" : {
                        "stop-auto" : {
                           "value" : "y"
                        }
                     }
                  }
               },
               "type" : "cfg-pgbackrest",
               "value" : {
                  "config" : [
                     "[demo]",
                     "db-path=/var/lib/pgsql/9.5/data",
                     "",
                     "[global]",
                     "repo-cipher-pass=zWaf6XtpjIVZC5444yXB+cgFDFl7MxGlgkZSaoPvTGirhPygu4jOKOXf9LO4vjfO",
                     "repo-cipher-type=aes-256-cbc",
                     "repo-path=/var/lib/pgbackrest",
                     "retention-full=2",
                     "start-fast=y",
                     "stop-auto=y"
                  ]
               }
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres pgbackrest --stanza=demo --type=incr \\",
                     "    --log-level-console=info backup"
                  ],
                  "highlight" : {
                     "filter" : true,
                     "filter-context" : 2,
                     "list" : [
                        "cluster is already in backup mode|backup begins after the requested immediate checkpoint completes"
                     ]
                  },
                  "host" : "db-primary",
                  "output" : true
               },
               "type" : "exe",
               "value" : {
                  "output" : [
                     "P00   INFO: backup command begin 1.29: --db1-path=/var/lib/pgsql/9.5/data --log-level-console=info --log-level-stderr=off --no-log-timestamp --repo-cipher-pass=<redacted> --repo-cipher-type=aes-256-cbc --repo-path=/var/lib/pgbackrest --retention-full=2 --stanza=demo --start-fast --stop-auto --type=incr",
                     "P00   INFO: last backup label = 20180705-220807F_20180705-220847I, version = 1.29",
                     "P00   WARN: the cluster is already in backup mode but no pgBackRest backup process is running. pg_stop_backup() will be called so a new backup can be started.",
                     "P00   INFO: execute exclusive pg_stop_backup() and wait for all WAL segments to archive",
                     "P00   INFO: execute exclusive pg_start_backup() with label \"pgBackRest backup started at 2018-07-05 22:08:56\": backup begins after the requested immediate checkpoint completes",
                     "P00   INFO: backup start archive = 000000020000000000000008, lsn = 0/8000028",
                     "P01   INFO: backup file /var/lib/pgsql/9.5/data/global/pg_control (8KB, 85%) checksum 0b2a7e26ae0e3fdd3899cab80c8d4d78558313fd",
                     "       [filtered 9 lines of output]"
                  ]
               }
            },
            {
               "key" : {
                  "file" : "/etc/pgbackrest.conf",
                  "host" : "db-primary",
                  "option" : {
                     "global" : {
                        "retention-full" : {
                           "value" : "2"
                        }
                     }
                  }
               },
               "type" : "cfg-pgbackrest",
               "value" : {
                  "config" : [
                     "[demo]",
                     "db-path=/var/lib/pgsql/9.5/data",
                     "",
                     "[global]",
                     "repo-cipher-pass=zWaf6XtpjIVZC5444yXB+cgFDFl7MxGlgkZSaoPvTGirhPygu4jOKOXf9LO4vjfO",
                     "repo-cipher-type=aes-256-cbc",
                     "repo-path=/var/lib/pgbackrest",
                     "retention-full=2",
                     "start-fast=y",
                     "stop-auto=y"
                  ]
               }
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres pgbackrest --stanza=demo --type=full \\",
                     "    --log-level-console=detail backup"
                  ],
                  "highlight" : {
                     "filter" : true,
                     "filter-context" : 2,
                     "list" : [
                        "archive retention on backup 20180705-220807F|remove archive"
                     ]
                  },
                  "host" : "db-primary",
                  "output" : true
               },
               "type" : "exe",
               "value" : {
                  "output" : [
                     "       [filtered 860 lines of output]",
                     "P00   INFO: backup command end: completed successfully",
                     "P00   INFO: expire command begin 1.29: --log-level-console=detail --log-level-stderr=off --no-log-timestamp --repo-cipher-pass=<redacted> --repo-cipher-type=aes-256-cbc --repo-path=/var/lib/pgbackrest --retention-archive=2 --retention-full=2 --stanza=demo",
                     "P00 DETAIL: archive retention on backup 20180705-220807F, archiveId = 9.5-1, start = 000000010000000000000002",
                     "P00 DETAIL: no archive to remove, archiveId = 9.5-1",
                     "P00   INFO: expire command end: completed successfully"
                  ]
               }
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres ls -1 /var/lib/pgbackrest/backup/demo | tail -5 | head -1"
                  ],
                  "host" : "db-primary",
                  "output" : true
               },
               "type" : "exe",
               "value" : {
                  "output" : [
                     "20180705-220902F"
                  ]
               }
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres pgbackrest --stanza=demo --type=full \\",
                     "    --log-level-console=info backup"
                  ],
                  "highlight" : {
                     "filter" : true,
                     "filter-context" : 2,
                     "list" : [
                        "expire full backup set\\: 20180705-220807F|archive retention on backup 20180705-220902F|remove archive"
                     ]
                  },
                  "host" : "db-primary",
                  "output" : true
               },
               "type" : "exe",
               "value" : {
                  "output" : [
                     "       [filtered 860 lines of output]",
                     "P00   INFO: backup command end: completed successfully",
                     "P00   INFO: expire command begin 1.29: --log-level-console=info --log-level-stderr=off --no-log-timestamp --repo-cipher-pass=<redacted> --repo-cipher-type=aes-256-cbc --repo-path=/var/lib/pgbackrest --retention-archive=2 --retention-full=2 --stanza=demo",
                     "P00   INFO: expire full backup set: 20180705-220807F, 20180705-220807F_20180705-220820D, 20180705-220807F_20180705-220842I, 20180705-220807F_20180705-220847I, 20180705-220807F_20180705-220856I",
                     "P00   INFO: remove expired backup 20180705-220807F_20180705-220856I",
                     "P00   INFO: remove expired backup 20180705-220807F_20180705-220847I",
                     "       [filtered 3 lines of output]"
                  ]
               }
            },
            {
               "key" : {
                  "file" : "/etc/pgbackrest.conf",
                  "host" : "db-primary",
                  "option" : {
                     "global" : {
                        "retention-diff" : {
                           "value" : "1"
                        }
                     }
                  }
               },
               "type" : "cfg-pgbackrest",
               "value" : {
                  "config" : [
                     "[demo]",
                     "db-path=/var/lib/pgsql/9.5/data",
                     "",
                     "[global]",
                     "repo-cipher-pass=zWaf6XtpjIVZC5444yXB+cgFDFl7MxGlgkZSaoPvTGirhPygu4jOKOXf9LO4vjfO",
                     "repo-cipher-type=aes-256-cbc",
                     "repo-path=/var/lib/pgbackrest",
                     "retention-diff=1",
                     "retention-full=2",
                     "start-fast=y",
                     "stop-auto=y"
                  ]
               }
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres pgbackrest --stanza=demo --type=diff backup"
                  ],
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres ls -1 /var/lib/pgbackrest/backup/demo | tail -5 | head -1"
                  ],
                  "host" : "db-primary",
                  "output" : true
               },
               "type" : "exe",
               "value" : {
                  "output" : [
                     "20180705-220915F_20180705-220929D"
                  ]
               }
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres pgbackrest --stanza=demo --type=incr backup"
                  ],
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres pgbackrest --stanza=demo --type=diff \\",
                     "    --log-level-console=info backup"
                  ],
                  "highlight" : {
                     "filter" : true,
                     "filter-context" : 2,
                     "list" : [
                        "expire diff backup set: 20180705-220915F_20180705-220929D"
                     ]
                  },
                  "host" : "db-primary",
                  "output" : true
               },
               "type" : "exe",
               "value" : {
                  "output" : [
                     "       [filtered 10 lines of output]",
                     "P00   INFO: backup command end: completed successfully",
                     "P00   INFO: expire command begin 1.29: --log-level-console=info --log-level-stderr=off --no-log-timestamp --repo-cipher-pass=<redacted> --repo-cipher-type=aes-256-cbc --repo-path=/var/lib/pgbackrest --retention-archive=2 --retention-diff=1 --retention-full=2 --stanza=demo",
                     "P00   INFO: expire diff backup set: 20180705-220915F_20180705-220929D, 20180705-220915F_20180705-220934I",
                     "P00   INFO: remove expired backup 20180705-220915F_20180705-220934I",
                     "P00   INFO: remove expired backup 20180705-220915F_20180705-220929D"
                  ]
               }
            },
            {
               "key" : {
                  "file" : "/etc/pgbackrest.conf",
                  "host" : "db-primary",
                  "option" : {
                     "global" : {
                        "retention-diff" : {
                           "value" : "2"
                        }
                     }
                  }
               },
               "type" : "cfg-pgbackrest",
               "value" : {
                  "config" : [
                     "[demo]",
                     "db-path=/var/lib/pgsql/9.5/data",
                     "",
                     "[global]",
                     "repo-cipher-pass=zWaf6XtpjIVZC5444yXB+cgFDFl7MxGlgkZSaoPvTGirhPygu4jOKOXf9LO4vjfO",
                     "repo-cipher-type=aes-256-cbc",
                     "repo-path=/var/lib/pgbackrest",
                     "retention-diff=2",
                     "retention-full=2",
                     "start-fast=y",
                     "stop-auto=y"
                  ]
               }
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres ls -1 /var/lib/pgbackrest/backup/demo | tail -5 | head -1"
                  ],
                  "host" : "db-primary",
                  "output" : true
               },
               "type" : "exe",
               "value" : {
                  "output" : [
                     "20180705-220915F_20180705-220938D"
                  ]
               }
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres psql -c \" \\",
                     "    select pg_create_restore_point('generate WAL'); select pg_switch_xlog(); \\",
                     "    select pg_create_restore_point('generate WAL'); select pg_switch_xlog();\""
                  ],
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres pgbackrest --stanza=demo --type=diff \\",
                     "    --log-level-console=info backup"
                  ],
                  "highlight" : {
                     "filter" : true,
                     "filter-context" : 2,
                     "list" : [
                        "new backup label"
                     ]
                  },
                  "host" : "db-primary",
                  "output" : true
               },
               "type" : "exe",
               "value" : {
                  "output" : [
                     "       [filtered 8 lines of output]",
                     "P00   INFO: execute exclusive pg_stop_backup() and wait for all WAL segments to archive",
                     "P00   INFO: backup stop archive = 000000020000000000000011, lsn = 0/110000F8",
                     "P00   INFO: new backup label = 20180705-220915F_20180705-220943D",
                     "P00   INFO: backup command end: completed successfully",
                     "P00   INFO: expire command begin 1.29: --log-level-console=info --log-level-stderr=off --no-log-timestamp --repo-cipher-pass=<redacted> --repo-cipher-type=aes-256-cbc --repo-path=/var/lib/pgbackrest --retention-archive=2 --retention-diff=2 --retention-full=2 --stanza=demo"
                  ]
               }
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres ls -1 /var/lib/pgbackrest/backup/demo | tail -5 | head -1"
                  ],
                  "host" : "db-primary",
                  "output" : true
               },
               "type" : "exe",
               "value" : {
                  "output" : [
                     "20180705-220915F_20180705-220943D"
                  ]
               }
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres pgbackrest --stanza=demo --log-level-console=detail \\",
                     "    --retention-archive-type=diff --retention-archive=1 expire"
                  ],
                  "highlight" : {
                     "filter" : true,
                     "filter-context" : 2,
                     "list" : [
                        "archive retention on backup 20180705-220915F_20180705-220938D|remove archive"
                     ]
                  },
                  "host" : "db-primary",
                  "output" : true
               },
               "type" : "exe",
               "value" : {
                  "output" : [
                     "P00   INFO: expire command begin 1.29: --log-level-console=detail --log-level-stderr=off --no-log-timestamp --repo-cipher-pass=<redacted> --repo-cipher-type=aes-256-cbc --repo-path=/var/lib/pgbackrest --retention-archive=1 --retention-archive-type=diff --retention-diff=2 --retention-full=2 --stanza=demo",
                     "P00 DETAIL: archive retention on backup 20180705-220902F, archiveId = 9.5-1, start = 000000020000000000000009, stop = 000000020000000000000009",
                     "P00 DETAIL: archive retention on backup 20180705-220915F, archiveId = 9.5-1, start = 00000002000000000000000A, stop = 00000002000000000000000A",
                     "P00 DETAIL: archive retention on backup 20180705-220915F_20180705-220938D, archiveId = 9.5-1, start = 00000002000000000000000E, stop = 00000002000000000000000E",
                     "P00 DETAIL: archive retention on backup 20180705-220915F_20180705-220943D, archiveId = 9.5-1, start = 000000020000000000000011",
                     "P00 DETAIL: remove archive: archiveId = 9.5-1, start = 00000002000000000000000B, stop = 00000002000000000000000D",
                     "P00 DETAIL: remove archive: archiveId = 9.5-1, start = 00000002000000000000000F, stop = 000000020000000000000010",
                     "P00   INFO: expire command end: completed successfully"
                  ]
               }
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo service postgresql-9.5 stop"
                  ],
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres pgbackrest --stanza=demo --delta \\",
                     "    --log-level-console=detail restore"
                  ],
                  "highlight" : {
                     "filter" : true,
                     "filter-context" : 2,
                     "list" : [
                        "demo\\/PG_VERSION - exists and matches backup|check\\/clean db path|restore global\\/pg_control"
                     ]
                  },
                  "host" : "db-primary",
                  "output" : true
               },
               "type" : "exe",
               "value" : {
                  "output" : [
                     "       [filtered 878 lines of output]",
                     "P01 DETAIL: restore file /var/lib/pgsql/9.5/data/base/1/13080 - exists and is zero size (0B, 100%)",
                     "P00   INFO: write /var/lib/pgsql/9.5/data/recovery.conf",
                     "P00   INFO: restore global/pg_control (performed last to ensure aborted restores cannot be started)",
                     "P00   INFO: restore command end: completed successfully"
                  ]
               }
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo service postgresql-9.5 start"
                  ],
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres sleep 2"
                  ],
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres psql -c \"create database test1;\""
                  ],
                  "host" : "db-primary",
                  "output" : true
               },
               "type" : "exe",
               "value" : {
                  "output" : [
                     "CREATE DATABASE"
                  ]
               }
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres psql -c \"create database test2;\""
                  ],
                  "host" : "db-primary",
                  "output" : true
               },
               "type" : "exe",
               "value" : {
                  "output" : [
                     "CREATE DATABASE"
                  ]
               }
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres pgbackrest --stanza=demo --type=incr backup"
                  ],
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres psql -c \"create table test1_table (id int); \\",
                     "    insert into test1_table (id) values (1);\" test1"
                  ],
                  "host" : "db-primary",
                  "output" : true
               },
               "type" : "exe",
               "value" : {
                  "output" : [
                     "INSERT 0 1"
                  ]
               }
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres psql -c \"create table test2_table (id int); \\",
                     "    insert into test2_table (id) values (2);\" test2"
                  ],
                  "host" : "db-primary",
                  "output" : true
               },
               "type" : "exe",
               "value" : {
                  "output" : [
                     "INSERT 0 1"
                  ]
               }
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres du -sh /var/lib/pgsql/9.5/data/base/16384"
                  ],
                  "host" : "db-primary",
                  "output" : true
               },
               "type" : "exe",
               "value" : {
                  "output" : [
                     "7.1M\t/var/lib/pgsql/9.5/data/base/16384"
                  ]
               }
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo service postgresql-9.5 stop"
                  ],
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres pgbackrest --stanza=demo --delta \\",
                     "    --db-include=test2 restore"
                  ],
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo service postgresql-9.5 start"
                  ],
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres sleep 2"
                  ],
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres psql -c \"select * from test2_table;\" test2"
                  ],
                  "host" : "db-primary",
                  "output" : true
               },
               "type" : "exe",
               "value" : {
                  "output" : [
                     " id ",
                     "----",
                     "  2",
                     "(1 row)"
                  ]
               }
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres psql -c \"select * from test1_table;\" test1"
                  ],
                  "err-expect" : "2",
                  "highlight" : {
                     "filter" : false,
                     "filter-context" : 2,
                     "list" : [
                        "relation mapping file.*contains invalid data"
                     ]
                  },
                  "host" : "db-primary",
                  "output" : true
               },
               "type" : "exe",
               "value" : {
                  "output" : [
                     "psql: FATAL:  relation mapping file \"base/16384/pg_filenode.map\" contains invalid data"
                  ]
               }
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres du -sh /var/lib/pgsql/9.5/data/base/16384"
                  ],
                  "host" : "db-primary",
                  "output" : true
               },
               "type" : "exe",
               "value" : {
                  "output" : [
                     "160K\t/var/lib/pgsql/9.5/data/base/16384"
                  ]
               }
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres psql -c \"drop database test1;\""
                  ],
                  "host" : "db-primary",
                  "output" : true
               },
               "type" : "exe",
               "value" : {
                  "output" : [
                     "DROP DATABASE"
                  ]
               }
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres psql -c \"select oid, datname from pg_database order by oid;\""
                  ],
                  "highlight" : {
                     "filter" : false,
                     "filter-context" : 2,
                     "list" : [
                        "test2"
                     ]
                  },
                  "host" : "db-primary",
                  "output" : true
               },
               "type" : "exe",
               "value" : {
                  "output" : [
                     "  oid  |  datname  ",
                     "-------+-----------",
                     "     1 | template1",
                     " 13242 | template0",
                     " 13247 | postgres",
                     " 16385 | test2",
                     "(4 rows)"
                  ]
               }
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres pgbackrest --stanza=demo --type=diff backup"
                  ],
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres psql -c \"begin; \\",
                     "    create table important_table (message text); \\",
                     "    insert into important_table values ('Important Data'); \\",
                     "    commit; \\",
                     "    select * from important_table;\""
                  ],
                  "highlight" : {
                     "filter" : true,
                     "filter-context" : 2,
                     "list" : [
                        "Important Data"
                     ]
                  },
                  "host" : "db-primary",
                  "output" : true
               },
               "type" : "exe",
               "value" : {
                  "output" : [
                     "    message     ",
                     "----------------",
                     " Important Data",
                     "(1 row)"
                  ]
               }
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres psql -Atc \"select current_timestamp\""
                  ],
                  "host" : "db-primary",
                  "output" : true
               },
               "type" : "exe",
               "value" : {
                  "output" : [
                     "2018-07-05 22:10:24.216138+00"
                  ]
               }
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres psql -c \"begin; \\",
                     "    drop table important_table; \\",
                     "    commit; \\",
                     "    select * from important_table;\""
                  ],
                  "err-expect" : "1",
                  "highlight" : {
                     "filter" : true,
                     "filter-context" : 2,
                     "list" : [
                        "does not exist"
                     ]
                  },
                  "host" : "db-primary",
                  "output" : true
               },
               "type" : "exe",
               "value" : {
                  "output" : [
                     "ERROR:  relation \"important_table\" does not exist",
                     "LINE 1: ...le important_table;     commit;     select * from important_...",
                     "                                                             ^"
                  ]
               }
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo service postgresql-9.5 stop"
                  ],
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres pgbackrest --stanza=demo --delta \\",
                     "    --type=time \"--target=2018-07-05 22:10:24.216138+00\" restore"
                  ],
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo rm /var/lib/pgsql/9.5/data/pg_log/postgresql.log"
                  ],
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres cat /var/lib/pgsql/9.5/data/recovery.conf"
                  ],
                  "highlight" : {
                     "filter" : true,
                     "filter-context" : 2,
                     "list" : [
                        "recovery_target_time"
                     ]
                  },
                  "host" : "db-primary",
                  "output" : true
               },
               "type" : "exe",
               "value" : {
                  "output" : [
                     "restore_command = '/usr/bin/pgbackrest --stanza=demo archive-get %f \"%p\"'",
                     "recovery_target_time = '2018-07-05 22:10:24.216138+00'"
                  ]
               }
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo service postgresql-9.5 start"
                  ],
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres sleep 2"
                  ],
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres psql -c \"select * from important_table\""
                  ],
                  "highlight" : {
                     "filter" : true,
                     "filter-context" : 2,
                     "list" : [
                        "Important Data"
                     ]
                  },
                  "host" : "db-primary",
                  "output" : true
               },
               "type" : "exe",
               "value" : {
                  "output" : [
                     "    message     ",
                     "----------------",
                     " Important Data",
                     "(1 row)"
                  ]
               }
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres cat /var/lib/pgsql/9.5/data/pg_log/postgresql.log"
                  ],
                  "highlight" : {
                     "filter" : true,
                     "filter-context" : 2,
                     "list" : [
                        "recovery stopping before|last completed transaction|starting point-in-time recovery"
                     ]
                  },
                  "host" : "db-primary",
                  "output" : true
               },
               "type" : "exe",
               "value" : {
                  "output" : [
                     "LOG:  database system was interrupted; last known up at 2018-07-05 22:10:17 UTC",
                     "LOG:  starting point-in-time recovery to 2018-07-05 22:10:24.216138+00",
                     "LOG:  restored log file \"00000004.history\" from archive",
                     "LOG:  restored log file \"000000040000000000000016\" from archive",
                     "LOG:  redo starts at 0/16000028",
                     "LOG:  consistent recovery state reached at 0/160000F8",
                     "LOG:  restored log file \"000000040000000000000017\" from archive",
                     "LOG:  recovery stopping before commit of transaction 1763, time 2018-07-05 22:10:24.381628+00",
                     "LOG:  redo done at 0/1701CF08",
                     "LOG:  last completed transaction was at log time 2018-07-05 22:10:24.015364+00",
                     "LOG:  selected new timeline ID: 5",
                     "LOG:  restored log file \"00000004.history\" from archive",
                     "       [filtered 3 lines of output]"
                  ]
               }
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres psql -c \"begin; \\",
                     "    drop table important_table; \\",
                     "    commit; \\",
                     "    select * from important_table;\""
                  ],
                  "err-expect" : "1",
                  "highlight" : {
                     "filter" : true,
                     "filter-context" : 2,
                     "list" : [
                        "does not exist"
                     ]
                  },
                  "host" : "db-primary",
                  "output" : true
               },
               "type" : "exe",
               "value" : {
                  "output" : [
                     "ERROR:  relation \"important_table\" does not exist",
                     "LINE 1: ...le important_table;     commit;     select * from important_...",
                     "                                                             ^"
                  ]
               }
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres ls -1 /var/lib/pgbackrest/backup/demo | tail -5 | head -1"
                  ],
                  "host" : "db-primary",
                  "output" : true
               },
               "type" : "exe",
               "value" : {
                  "output" : [
                     "20180705-220915F_20180705-221016D"
                  ]
               }
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres pgbackrest --stanza=demo --type=incr backup"
                  ],
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo service postgresql-9.5 stop"
                  ],
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres pgbackrest --stanza=demo --delta \\",
                     "    --type=time \"--target=2018-07-05 22:10:24.216138+00\" restore"
                  ],
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo rm /var/lib/pgsql/9.5/data/pg_log/postgresql.log"
                  ],
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo service postgresql-9.5 start"
                  ],
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres sleep 2"
                  ],
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres psql -c \"select * from important_table\""
                  ],
                  "err-expect" : "1",
                  "highlight" : {
                     "filter" : true,
                     "filter-context" : 2,
                     "list" : [
                        "does not exist"
                     ]
                  },
                  "host" : "db-primary",
                  "output" : true
               },
               "type" : "exe",
               "value" : {
                  "output" : [
                     "ERROR:  relation \"important_table\" does not exist",
                     "LINE 1: select * from important_table",
                     "                      ^"
                  ]
               }
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres cat /var/lib/pgsql/9.5/data/pg_log/postgresql.log"
                  ],
                  "highlight" : {
                     "filter" : true,
                     "filter-context" : 2,
                     "list" : [
                        "starting point-in-time recovery|consistent recovery state reached"
                     ]
                  },
                  "host" : "db-primary",
                  "output" : true
               },
               "type" : "exe",
               "value" : {
                  "output" : [
                     "LOG:  database system was interrupted; last known up at 2018-07-05 22:10:34 UTC",
                     "LOG:  starting point-in-time recovery to 2018-07-05 22:10:24.216138+00",
                     "LOG:  restored log file \"00000005.history\" from archive",
                     "LOG:  restored log file \"000000050000000000000018\" from archive",
                     "LOG:  redo starts at 0/18000028",
                     "LOG:  consistent recovery state reached at 0/180000F8",
                     "LOG:  redo done at 0/180000F8",
                     "LOG:  restored log file \"000000050000000000000018\" from archive",
                     "       [filtered 7 lines of output]"
                  ]
               }
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres pgbackrest info"
                  ],
                  "highlight" : {
                     "filter" : false,
                     "filter-context" : 2,
                     "list" : [
                        "20180705-220915F_20180705-221016D"
                     ]
                  },
                  "host" : "db-primary",
                  "output" : true
               },
               "type" : "exe",
               "value" : {
                  "output" : [
                     "stanza: demo",
                     "    status: ok",
                     "",
                     "    db (current)",
                     "        wal archive min/max (9.5-1): 000000020000000000000009 / 000000050000000000000018",
                     "",
                     "        full backup: 20180705-220902F",
                     "            timestamp start/stop: 2018-07-05 22:09:02 / 2018-07-05 22:09:15",
                     "            wal start/stop: 000000020000000000000009 / 000000020000000000000009",
                     "            database size: 21.3MB, backup size: 21.3MB",
                     "            repository size: 2.4MB, repository backup size: 2.4MB",
                     "",
                     "        full backup: 20180705-220915F",
                     "            timestamp start/stop: 2018-07-05 22:09:15 / 2018-07-05 22:09:28",
                     "            wal start/stop: 00000002000000000000000A / 00000002000000000000000A",
                     "            database size: 21.3MB, backup size: 21.3MB",
                     "            repository size: 2.4MB, repository backup size: 2.4MB",
                     "",
                     "        diff backup: 20180705-220915F_20180705-220943D",
                     "            timestamp start/stop: 2018-07-05 22:09:43 / 2018-07-05 22:09:46",
                     "            wal start/stop: 000000020000000000000011 / 000000020000000000000011",
                     "            database size: 21.3MB, backup size: 9.8KB",
                     "            repository size: 2.4MB, repository backup size: 1KB",
                     "            backup reference list: 20180705-220915F",
                     "",
                     "        incr backup: 20180705-220915F_20180705-220956I",
                     "            timestamp start/stop: 2018-07-05 22:09:56 / 2018-07-05 22:10:06",
                     "            wal start/stop: 000000030000000000000013 / 000000030000000000000013",
                     "            database size: 35.2MB, backup size: 13.9MB",
                     "            repository size: 4.1MB, repository backup size: 1.6MB",
                     "            backup reference list: 20180705-220915F",
                     "",
                     "        diff backup: 20180705-220915F_20180705-221016D",
                     "            timestamp start/stop: 2018-07-05 22:10:16 / 2018-07-05 22:10:23",
                     "            wal start/stop: 000000040000000000000016 / 000000040000000000000016",
                     "            database size: 28.3MB, backup size: 7MB",
                     "            repository size: 3.3MB, repository backup size: 845.8KB",
                     "            backup reference list: 20180705-220915F",
                     "",
                     "        incr backup: 20180705-220915F_20180705-221033I",
                     "            timestamp start/stop: 2018-07-05 22:10:33 / 2018-07-05 22:10:38",
                     "            wal start/stop: 000000050000000000000018 / 000000050000000000000018",
                     "            database size: 28.3MB, backup size: 2MB",
                     "            repository size: 3.3MB, repository backup size: 208.5KB",
                     "            backup reference list: 20180705-220915F, 20180705-220915F_20180705-221016D"
                  ]
               }
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo service postgresql-9.5 stop"
                  ],
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres pgbackrest --stanza=demo --delta \\",
                     "    --type=time \"--target=2018-07-05 22:10:24.216138+00\" \\",
                     "    --set=20180705-220915F_20180705-221016D restore"
                  ],
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo rm /var/lib/pgsql/9.5/data/pg_log/postgresql.log"
                  ],
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo service postgresql-9.5 start"
                  ],
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres sleep 2"
                  ],
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres psql -c \"select * from important_table\""
                  ],
                  "highlight" : {
                     "filter" : true,
                     "filter-context" : 2,
                     "list" : [
                        "Important Data"
                     ]
                  },
                  "host" : "db-primary",
                  "output" : true
               },
               "type" : "exe",
               "value" : {
                  "output" : [
                     "    message     ",
                     "----------------",
                     " Important Data",
                     "(1 row)"
                  ]
               }
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres cat /var/lib/pgsql/9.5/data/pg_log/postgresql.log"
                  ],
                  "highlight" : {
                     "filter" : true,
                     "filter-context" : 2,
                     "list" : [
                        "recovery stopping before|last completed transaction|starting point-in-time recovery"
                     ]
                  },
                  "host" : "db-primary",
                  "output" : true
               },
               "type" : "exe",
               "value" : {
                  "output" : [
                     "LOG:  database system was interrupted; last known up at 2018-07-05 22:10:17 UTC",
                     "LOG:  starting point-in-time recovery to 2018-07-05 22:10:24.216138+00",
                     "LOG:  restored log file \"00000004.history\" from archive",
                     "LOG:  restored log file \"000000040000000000000016\" from archive",
                     "LOG:  redo starts at 0/16000028",
                     "LOG:  consistent recovery state reached at 0/160000F8",
                     "LOG:  restored log file \"000000040000000000000017\" from archive",
                     "LOG:  recovery stopping before commit of transaction 1763, time 2018-07-05 22:10:24.381628+00",
                     "LOG:  redo done at 0/1701CF08",
                     "LOG:  last completed transaction was at log time 2018-07-05 22:10:24.015364+00",
                     "LOG:  restored log file \"00000005.history\" from archive",
                     "LOG:  restored log file \"00000006.history\" from archive",
                     "       [filtered 5 lines of output]"
                  ]
               }
            },
            {
               "key" : {
                  "file" : "/etc/pgbackrest.conf",
                  "host" : "db-primary",
                  "option" : {
                     "global" : {
                        "repo-cipher-pass" : {},
                        "repo-cipher-type" : {
                           "value" : "none"
                        }
                     }
                  }
               },
               "type" : "cfg-pgbackrest",
               "value" : {
                  "config" : [
                     "[demo]",
                     "db-path=/var/lib/pgsql/9.5/data",
                     "",
                     "[global]",
                     "repo-cipher-type=none",
                     "repo-path=/var/lib/pgbackrest",
                     "retention-diff=2",
                     "retention-full=2",
                     "start-fast=y",
                     "stop-auto=y"
                  ]
               }
            },
            {
               "key" : {
                  "file" : "/etc/pgbackrest.conf",
                  "host" : "db-primary",
                  "option" : {
                     "global" : {
                        "process-max" : {
                           "value" : "4"
                        },
                        "repo-path" : {
                           "value" : "/"
                        },
                        "repo-s3-bucket" : {
                           "value" : "demo-bucket"
                        },
                        "repo-s3-endpoint" : {
                           "value" : "s3.amazonaws.com"
                        },
                        "repo-s3-key" : {
                           "value" : "accessKey1"
                        },
                        "repo-s3-key-secret" : {
                           "value" : "verySecretKey1"
                        },
                        "repo-s3-region" : {
                           "value" : "us-east-1"
                        },
                        "repo-s3-verify-ssl" : {
                           "value" : "n"
                        },
                        "repo-type" : {
                           "value" : "s3"
                        }
                     }
                  }
               },
               "type" : "cfg-pgbackrest",
               "value" : {
                  "config" : [
                     "[demo]",
                     "db-path=/var/lib/pgsql/9.5/data",
                     "",
                     "[global]",
                     "process-max=4",
                     "repo-cipher-type=none",
                     "repo-path=/",
                     "repo-s3-bucket=demo-bucket",
                     "repo-s3-endpoint=s3.amazonaws.com",
                     "repo-s3-key=accessKey1",
                     "repo-s3-key-secret=verySecretKey1",
                     "repo-s3-region=us-east-1",
                     "repo-type=s3",
                     "retention-diff=2",
                     "retention-full=2",
                     "start-fast=y",
                     "stop-auto=y"
                  ]
               }
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo echo \"172.17.0.2 demo-bucket.s3.amazonaws.com s3.amazonaws.com\" | \\",
                     "    sudo tee -a /etc/hosts"
                  ],
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "aws s3 --no-verify-ssl mb s3://demo-bucket 2>&1"
                  ],
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres pgbackrest --stanza=demo --log-level-console=info stanza-create"
                  ],
                  "highlight" : {
                     "filter" : true,
                     "filter-context" : 2,
                     "list" : [
                        "completed successfully"
                     ]
                  },
                  "host" : "db-primary",
                  "output" : true
               },
               "type" : "exe",
               "value" : {
                  "output" : [
                     "P00   INFO: stanza-create command begin 1.29: --db1-path=/var/lib/pgsql/9.5/data --log-level-console=info --log-level-stderr=off --no-log-timestamp --repo-cipher-type=none --repo-path=/ --repo-s3-bucket=demo-bucket --repo-s3-endpoint=s3.amazonaws.com --repo-s3-key=<redacted> --repo-s3-key-secret=<redacted> --repo-s3-region=us-east-1 --no-repo-s3-verify-ssl --repo-type=s3 --stanza=demo",
                     "P00   INFO: stanza-create command end: completed successfully"
                  ]
               }
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres pgbackrest --stanza=demo \\",
                     "    --log-level-console=info backup"
                  ],
                  "highlight" : {
                     "filter" : true,
                     "filter-context" : 2,
                     "list" : [
                        "no prior backup exists|full backup size"
                     ]
                  },
                  "host" : "db-primary",
                  "output" : true
               },
               "type" : "exe",
               "value" : {
                  "output" : [
                     "P00   INFO: backup command begin 1.29: --db1-path=/var/lib/pgsql/9.5/data --log-level-console=info --log-level-stderr=off --no-log-timestamp --process-max=4 --repo-cipher-type=none --repo-path=/ --repo-s3-bucket=demo-bucket --repo-s3-endpoint=s3.amazonaws.com --repo-s3-key=<redacted> --repo-s3-key-secret=<redacted> --repo-s3-region=us-east-1 --no-repo-s3-verify-ssl --repo-type=s3 --retention-diff=2 --retention-full=2 --stanza=demo --start-fast --stop-auto",
                     "P00   WARN: no prior backup exists, incr backup has been changed to full",
                     "P00   INFO: execute exclusive pg_start_backup() with label \"pgBackRest backup started at 2018-07-05 22:10:59\": backup begins after the requested immediate checkpoint completes",
                     "P00   INFO: backup start archive = 000000070000000000000018, lsn = 0/18000028",
                     "       [filtered 1119 lines of output]",
                     "P02   INFO: backup file /var/lib/pgsql/9.5/data/base/1/13080 (0B, 100%)",
                     "P03   INFO: backup file /var/lib/pgsql/9.5/data/base/1/13085 (0B, 100%)",
                     "P00   INFO: full backup size = 28.3MB",
                     "P00   INFO: execute exclusive pg_stop_backup() and wait for all WAL segments to archive",
                     "P00   INFO: backup stop archive = 000000070000000000000018, lsn = 0/18000130",
                     "       [filtered 4 lines of output]"
                  ]
               }
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo service postgresql-9.5 stop"
                  ],
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres pgbackrest --stanza=demo --log-level-console=info stop"
                  ],
                  "highlight" : {
                     "filter" : true,
                     "filter-context" : 2,
                     "list" : [
                        "completed successfully"
                     ]
                  },
                  "host" : "db-primary",
                  "output" : true
               },
               "type" : "exe",
               "value" : {
                  "output" : [
                     "P00   INFO: stop command begin 1.29: --log-level-console=info --log-level-stderr=off --no-log-timestamp --repo-cipher-type=none --repo-path=/ --repo-s3-bucket=demo-bucket --repo-s3-endpoint=s3.amazonaws.com --repo-s3-key=<redacted> --repo-s3-key-secret=<redacted> --repo-s3-region=us-east-1 --no-repo-s3-verify-ssl --repo-type=s3 --stanza=demo",
                     "P00   INFO: stop command end: completed successfully"
                  ]
               }
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres pgbackrest --stanza=demo --log-level-console=info stanza-delete"
                  ],
                  "highlight" : {
                     "filter" : true,
                     "filter-context" : 2,
                     "list" : [
                        "completed successfully"
                     ]
                  },
                  "host" : "db-primary",
                  "output" : true
               },
               "type" : "exe",
               "value" : {
                  "output" : [
                     "P00   INFO: stanza-delete command begin 1.29: --db1-path=/var/lib/pgsql/9.5/data --log-level-console=info --log-level-stderr=off --no-log-timestamp --repo-cipher-type=none --repo-path=/ --repo-s3-bucket=demo-bucket --repo-s3-endpoint=s3.amazonaws.com --repo-s3-key=<redacted> --repo-s3-key-secret=<redacted> --repo-s3-region=us-east-1 --no-repo-s3-verify-ssl --repo-type=s3 --stanza=demo",
                     "P00   INFO: stanza-delete command end: completed successfully"
                  ]
               }
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo service postgresql-9.5 start"
                  ],
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "image" : "pgbackrest/test:co6-base",
                  "name" : "backup",
                  "os" : "co6"
               },
               "type" : "host",
               "value" : {
                  "ip" : "172.17.0.4"
               }
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo groupadd backrest"
                  ],
                  "host" : "backup",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo adduser -gbackrest -n backrest"
                  ],
                  "host" : "backup",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo yum install perl perl-Time-HiRes perl-parent perl-JSON \\",
                     "    perl-Digest-SHA perl-DBD-Pg perl-XML-LibXML perl-IO-Socket-SSL"
                  ],
                  "cmd-extra" : "-y",
                  "host" : "backup",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo mkdir /root/pgbackrest-release-1.29"
                  ],
                  "host" : "backup",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo cp -r /backrest/bin /root/pgbackrest-release-1.29"
                  ],
                  "host" : "backup",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo cp -r /backrest/build /root/pgbackrest-release-1.29"
                  ],
                  "host" : "backup",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo cp -r /backrest/lib /root/pgbackrest-release-1.29"
                  ],
                  "host" : "backup",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo cp -r /backrest/libc /root/pgbackrest-release-1.29"
                  ],
                  "host" : "backup",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo cp -r /backrest/src /root/pgbackrest-release-1.29"
                  ],
                  "host" : "backup",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo cp -r /root/pgbackrest-release-1.29/lib/pgBackRest \\",
                     "    /usr/share/perl5"
                  ],
                  "host" : "backup",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo find /usr/share/perl5/pgBackRest -type f -exec chmod 644 {} +"
                  ],
                  "host" : "backup",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo find /usr/share/perl5/pgBackRest -type d -exec chmod 755 {} +"
                  ],
                  "host" : "backup",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo cp /root/pgbackrest-release-1.29/bin/pgbackrest /usr/bin/pgbackrest"
                  ],
                  "host" : "backup",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo chmod 755 /usr/bin/pgbackrest"
                  ],
                  "host" : "backup",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo mkdir -m 770 /var/log/pgbackrest"
                  ],
                  "host" : "backup",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo chown backrest:backrest /var/log/pgbackrest"
                  ],
                  "host" : "backup",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo touch /etc/pgbackrest.conf"
                  ],
                  "host" : "backup",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo chmod 640 /etc/pgbackrest.conf"
                  ],
                  "host" : "backup",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo chown backrest:backrest /etc/pgbackrest.conf"
                  ],
                  "host" : "backup",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo sh -c 'cd /root/pgbackrest-release-1.29/libc && \\",
                     "    perl Makefile.PL INSTALLMAN1DIR=none INSTALLMAN3DIR=none'"
                  ],
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo make -C /root/pgbackrest-release-1.29/libc test"
                  ],
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo make -C /root/pgbackrest-release-1.29/libc install"
                  ],
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo mkdir /var/lib/pgbackrest"
                  ],
                  "host" : "backup",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo chmod 750 /var/lib/pgbackrest"
                  ],
                  "host" : "backup",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo chown backrest:backrest /var/lib/pgbackrest"
                  ],
                  "host" : "backup",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u backrest mkdir -m 750 /home/backrest/.ssh"
                  ],
                  "host" : "backup",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u backrest ssh-keygen -f /home/backrest/.ssh/id_rsa -t rsa -b 4096 -N \"\""
                  ],
                  "host" : "backup",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres mkdir -m 750 -p /home/postgres/.ssh"
                  ],
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres ssh-keygen -f /home/postgres/.ssh/id_rsa -t rsa -b 4096 -N \"\""
                  ],
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo ssh root@db-primary cat /home/postgres/.ssh/id_rsa.pub | \\",
                     "    sudo -u backrest tee -a /home/backrest/.ssh/authorized_keys"
                  ],
                  "host" : "backup",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo ssh root@backup cat /home/backrest/.ssh/id_rsa.pub | \\",
                     "    sudo -u postgres tee -a /home/postgres/.ssh/authorized_keys"
                  ],
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u backrest ssh postgres@db-primary"
                  ],
                  "cmd-extra" : "-o StrictHostKeyChecking=no ls",
                  "host" : "backup",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres ssh backrest@backup"
                  ],
                  "cmd-extra" : "-o StrictHostKeyChecking=no ls",
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "file" : "/etc/pgbackrest.conf",
                  "host" : "backup",
                  "option" : {
                     "global" : {
                        "repo-path" : {
                           "value" : "/var/lib/pgbackrest"
                        }
                     }
                  }
               },
               "type" : "cfg-pgbackrest",
               "value" : {
                  "config" : [
                     "[global]",
                     "repo-path=/var/lib/pgbackrest"
                  ]
               }
            },
            {
               "key" : {
                  "file" : "/etc/pgbackrest.conf",
                  "host" : "backup",
                  "option" : {
                     "demo" : {
                        "db1-host" : {
                           "value" : "db-primary"
                        },
                        "db1-path" : {
                           "value" : "/var/lib/pgsql/9.5/data"
                        },
                        "db1-user" : {
                           "value" : "postgres"
                        }
                     },
                     "global" : {
                        "log-level-stderr" : {
                           "value" : "off"
                        },
                        "log-timestamp" : {
                           "value" : "n"
                        },
                        "retention-full" : {
                           "value" : "2"
                        },
                        "start-fast" : {
                           "value" : "y"
                        }
                     }
                  }
               },
               "type" : "cfg-pgbackrest",
               "value" : {
                  "config" : [
                     "[demo]",
                     "db1-host=db-primary",
                     "db1-path=/var/lib/pgsql/9.5/data",
                     "db1-user=postgres",
                     "",
                     "[global]",
                     "repo-path=/var/lib/pgbackrest",
                     "retention-full=2",
                     "start-fast=y"
                  ]
               }
            },
            {
               "key" : {
                  "file" : "/etc/pgbackrest.conf",
                  "host" : "db-primary",
                  "option" : {
                     "demo" : {
                        "db-path" : {
                           "value" : "/var/lib/pgsql/9.5/data"
                        }
                     },
                     "global" : {
                        "backup-host" : {
                           "value" : "backup"
                        },
                        "backup-user" : {
                           "value" : "backrest"
                        },
                        "log-level-file" : {
                           "value" : "detail"
                        },
                        "log-level-stderr" : {
                           "value" : "off"
                        },
                        "log-timestamp" : {
                           "value" : "n"
                        }
                     }
                  },
                  "reset" : true
               },
               "type" : "cfg-pgbackrest",
               "value" : {
                  "config" : [
                     "[demo]",
                     "db-path=/var/lib/pgsql/9.5/data",
                     "",
                     "[global]",
                     "backup-host=backup",
                     "backup-user=backrest",
                     "log-level-file=detail"
                  ]
               }
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u backrest pgbackrest --stanza=demo stanza-create"
                  ],
                  "host" : "backup",
                  "output" : true
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres pgbackrest --stanza=demo check"
                  ],
                  "host" : "db-primary",
                  "output" : true
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u backrest pgbackrest --stanza=demo check"
                  ],
                  "host" : "backup",
                  "output" : true
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u backrest pgbackrest --stanza=demo backup"
                  ],
                  "host" : "backup",
                  "output" : true
               },
               "type" : "exe",
               "value" : {
                  "output" : [
                     "P00   WARN: no prior backup exists, incr backup has been changed to full"
                  ]
               }
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo service postgresql-9.5 stop"
                  ],
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres pgbackrest --stanza=demo --delta restore"
                  ],
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo service postgresql-9.5 start"
                  ],
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres sleep 2"
                  ],
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u backrest pgbackrest --stanza=demo backup"
                  ],
                  "host" : "backup",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo mkdir -m 750 /var/spool/pgbackrest"
                  ],
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo chown postgres:postgres /var/spool/pgbackrest"
                  ],
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "file" : "/etc/pgbackrest.conf",
                  "host" : "db-primary",
                  "option" : {
                     "global" : {
                        "archive-async" : {
                           "value" : "y"
                        },
                        "spool-path" : {
                           "value" : "/var/spool/pgbackrest"
                        }
                     },
                     "global:archive-push" : {
                        "process-max" : {
                           "value" : "2"
                        }
                     }
                  }
               },
               "type" : "cfg-pgbackrest",
               "value" : {
                  "config" : [
                     "[demo]",
                     "db-path=/var/lib/pgsql/9.5/data",
                     "",
                     "[global]",
                     "archive-async=y",
                     "backup-host=backup",
                     "backup-user=backrest",
                     "log-level-file=detail",
                     "spool-path=/var/spool/pgbackrest",
                     "",
                     "[global:archive-push]",
                     "process-max=2"
                  ]
               }
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres rm -f /var/log/pgbackrest/demo-archive-async.log"
                  ],
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres psql -c \" \\",
                     "    select pg_create_restore_point('test async push'); select pg_switch_xlog(); \\",
                     "    select pg_create_restore_point('test async push'); select pg_switch_xlog(); \\",
                     "    select pg_create_restore_point('test async push'); select pg_switch_xlog(); \\",
                     "    select pg_create_restore_point('test async push'); select pg_switch_xlog(); \\",
                     "    select pg_create_restore_point('test async push'); select pg_switch_xlog();\""
                  ],
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres pgbackrest --stanza=demo --log-level-console=info check"
                  ],
                  "highlight" : {
                     "filter" : true,
                     "filter-context" : 2,
                     "list" : [
                        "WAL segment"
                     ]
                  },
                  "host" : "db-primary",
                  "output" : true
               },
               "type" : "exe",
               "value" : {
                  "output" : [
                     "P00   INFO: check command begin 1.29: --backup-host=backup --backup-user=backrest --db1-path=/var/lib/pgsql/9.5/data --log-level-console=info --log-level-file=detail --log-level-stderr=off --no-log-timestamp --stanza=demo",
                     "P00   INFO: WAL segment 000000080000000000000024 successfully stored in the archive at '/var/lib/pgbackrest/archive/demo/9.5-1/0000000800000000/000000080000000000000024-e6513bb95609a63d760a45e8ec464ebf0726739c.gz'",
                     "P00   INFO: check command end: completed successfully"
                  ]
               }
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres cat /var/log/pgbackrest/demo-archive-async.log"
                  ],
                  "highlight" : {
                     "filter" : true,
                     "filter-context" : 2,
                     "list" : [
                        " WAL file\\(s\\) to archive|pushed WAL file 0000000"
                     ]
                  },
                  "host" : "db-primary",
                  "output" : true
               },
               "type" : "exe",
               "value" : {
                  "output" : [
                     "-------------------PROCESS START-------------------",
                     "P00   INFO: archive-push command begin 1.29: --archive-async --backup-host=backup --backup-user=backrest --db1-path=/var/lib/pgsql/9.5/data --log-level-file=detail --log-level-stderr=off --no-log-timestamp --process-max=2 --spool-path=/var/spool/pgbackrest --stanza=demo",
                     "P00   INFO: push 2 WAL file(s) to archive: 00000008000000000000001F...000000080000000000000020",
                     "P01 DETAIL: pushed WAL file 00000008000000000000001F to archive",
                     "P02 DETAIL: pushed WAL file 000000080000000000000020 to archive",
                     "P00   INFO: archive-push command end: completed successfully",
                     "",
                     "-------------------PROCESS START-------------------",
                     "P00   INFO: archive-push command begin 1.29: --archive-async --backup-host=backup --backup-user=backrest --db1-path=/var/lib/pgsql/9.5/data --log-level-file=detail --log-level-stderr=off --no-log-timestamp --process-max=2 --spool-path=/var/spool/pgbackrest --stanza=demo",
                     "P00   INFO: push 3 WAL file(s) to archive: 000000080000000000000021...000000080000000000000023",
                     "P01 DETAIL: pushed WAL file 000000080000000000000021 to archive",
                     "P02 DETAIL: pushed WAL file 000000080000000000000022 to archive",
                     "P01 DETAIL: pushed WAL file 000000080000000000000023 to archive",
                     "P00   INFO: archive-push command end: completed successfully",
                     "",
                     "-------------------PROCESS START-------------------",
                     "P00   INFO: archive-push command begin 1.29: --archive-async --backup-host=backup --backup-user=backrest --db1-path=/var/lib/pgsql/9.5/data --log-level-file=detail --log-level-stderr=off --no-log-timestamp --process-max=2 --spool-path=/var/spool/pgbackrest --stanza=demo",
                     "P00   INFO: push 1 WAL file(s) to archive: 000000080000000000000024",
                     "P01 DETAIL: pushed WAL file 000000080000000000000024 to archive",
                     "P00   INFO: archive-push command end: completed successfully"
                  ]
               }
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u backrest pgbackrest --stanza=demo --type=full backup"
                  ],
                  "host" : "backup",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "file" : "/etc/pgbackrest.conf",
                  "host" : "backup",
                  "option" : {
                     "global" : {
                        "process-max" : {
                           "value" : "3"
                        }
                     }
                  }
               },
               "type" : "cfg-pgbackrest",
               "value" : {
                  "config" : [
                     "[demo]",
                     "db1-host=db-primary",
                     "db1-path=/var/lib/pgsql/9.5/data",
                     "db1-user=postgres",
                     "",
                     "[global]",
                     "process-max=3",
                     "repo-path=/var/lib/pgbackrest",
                     "retention-full=2",
                     "start-fast=y"
                  ]
               }
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u backrest pgbackrest --stanza=demo --type=full backup"
                  ],
                  "host" : "backup",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u backrest pgbackrest info"
                  ],
                  "highlight" : {
                     "filter" : false,
                     "filter-context" : 2,
                     "list" : [
                        "timestamp start/stop"
                     ]
                  },
                  "host" : "backup",
                  "output" : true
               },
               "type" : "exe",
               "value" : {
                  "output" : [
                     "stanza: demo",
                     "    status: ok",
                     "",
                     "    db (current)",
                     "        wal archive min/max (9.5-1): 000000080000000000000025 / 000000080000000000000027",
                     "",
                     "        full backup: 20180705-221240F",
                     "            timestamp start/stop: 2018-07-05 22:12:40 / 2018-07-05 22:12:57",
                     "            wal start/stop: 000000080000000000000025 / 000000080000000000000025",
                     "            database size: 28.3MB, backup size: 28.3MB",
                     "            repository size: 3.2MB, repository backup size: 3.2MB",
                     "",
                     "        full backup: 20180705-221258F",
                     "            timestamp start/stop: 2018-07-05 22:12:58 / 2018-07-05 22:13:07",
                     "            wal start/stop: 000000080000000000000027 / 000000080000000000000027",
                     "            database size: 28.3MB, backup size: 28.3MB",
                     "            repository size: 3.2MB, repository backup size: 3.2MB"
                  ]
               }
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres pgbackrest stop"
                  ],
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u backrest pgbackrest --stanza=demo backup"
                  ],
                  "err-expect" : "62",
                  "highlight" : {
                     "filter" : true,
                     "filter-context" : 2,
                     "list" : [
                        "\\: stop file exists for all stanzas"
                     ]
                  },
                  "host" : "backup",
                  "output" : true
               },
               "type" : "exe",
               "value" : {
                  "output" : [
                     "P00  ERROR: [062]: raised from remote process on 'db-primary': stop file exists for all stanzas"
                  ]
               }
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres pgbackrest stop"
                  ],
                  "host" : "db-primary",
                  "output" : true
               },
               "type" : "exe",
               "value" : {
                  "output" : [
                     "P00   WARN: stop file already exists for all stanzas"
                  ]
               }
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres pgbackrest start"
                  ],
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres pgbackrest --stanza=demo stop"
                  ],
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u backrest pgbackrest --stanza=demo backup"
                  ],
                  "err-expect" : "62",
                  "highlight" : {
                     "filter" : true,
                     "filter-context" : 2,
                     "list" : [
                        "\\: stop file exists for stanza demo"
                     ]
                  },
                  "host" : "backup",
                  "output" : true
               },
               "type" : "exe",
               "value" : {
                  "output" : [
                     "P00  ERROR: [062]: raised from remote process on 'db-primary': stop file exists for stanza demo"
                  ]
               }
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres pgbackrest --stanza=demo start"
                  ],
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "image" : "pgbackrest/test:co6-base",
                  "name" : "db-standby",
                  "os" : "co6"
               },
               "type" : "host",
               "value" : {
                  "ip" : "172.17.0.5"
               }
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo yum install perl perl-Time-HiRes perl-parent perl-JSON \\",
                     "    perl-Digest-SHA perl-DBD-Pg perl-XML-LibXML perl-IO-Socket-SSL"
                  ],
                  "cmd-extra" : "-y",
                  "host" : "db-standby",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo mkdir /root/pgbackrest-release-1.29"
                  ],
                  "host" : "db-standby",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo cp -r /backrest/bin /root/pgbackrest-release-1.29"
                  ],
                  "host" : "db-standby",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo cp -r /backrest/build /root/pgbackrest-release-1.29"
                  ],
                  "host" : "db-standby",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo cp -r /backrest/lib /root/pgbackrest-release-1.29"
                  ],
                  "host" : "db-standby",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo cp -r /backrest/libc /root/pgbackrest-release-1.29"
                  ],
                  "host" : "db-standby",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo cp -r /backrest/src /root/pgbackrest-release-1.29"
                  ],
                  "host" : "db-standby",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo cp -r /root/pgbackrest-release-1.29/lib/pgBackRest \\",
                     "    /usr/share/perl5"
                  ],
                  "host" : "db-standby",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo find /usr/share/perl5/pgBackRest -type f -exec chmod 644 {} +"
                  ],
                  "host" : "db-standby",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo find /usr/share/perl5/pgBackRest -type d -exec chmod 755 {} +"
                  ],
                  "host" : "db-standby",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo cp /root/pgbackrest-release-1.29/bin/pgbackrest /usr/bin/pgbackrest"
                  ],
                  "host" : "db-standby",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo chmod 755 /usr/bin/pgbackrest"
                  ],
                  "host" : "db-standby",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo mkdir -m 770 /var/log/pgbackrest"
                  ],
                  "host" : "db-standby",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo chown postgres:postgres /var/log/pgbackrest"
                  ],
                  "host" : "db-standby",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo touch /etc/pgbackrest.conf"
                  ],
                  "host" : "db-standby",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo chmod 640 /etc/pgbackrest.conf"
                  ],
                  "host" : "db-standby",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo chown postgres:postgres /etc/pgbackrest.conf"
                  ],
                  "host" : "db-standby",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo sh -c 'cd /root/pgbackrest-release-1.29/libc && \\",
                     "    perl Makefile.PL INSTALLMAN1DIR=none INSTALLMAN3DIR=none'"
                  ],
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo make -C /root/pgbackrest-release-1.29/libc test"
                  ],
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo make -C /root/pgbackrest-release-1.29/libc install"
                  ],
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo service postgresql-9.5 initdb"
                  ],
                  "host" : "db-standby",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres mkdir -m 750 -p /home/postgres/.ssh"
                  ],
                  "host" : "db-standby",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres ssh-keygen -f /home/postgres/.ssh/id_rsa -t rsa -b 4096 -N \"\""
                  ],
                  "host" : "db-standby",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo ssh root@db-standby cat /home/postgres/.ssh/id_rsa.pub | \\",
                     "    sudo -u backrest tee -a /home/backrest/.ssh/authorized_keys"
                  ],
                  "host" : "backup",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo ssh root@backup cat /home/backrest/.ssh/id_rsa.pub | \\",
                     "    sudo -u postgres tee -a /home/postgres/.ssh/authorized_keys"
                  ],
                  "host" : "db-standby",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u backrest ssh postgres@db-standby"
                  ],
                  "cmd-extra" : "-o StrictHostKeyChecking=no ls",
                  "host" : "backup",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres ssh backrest@backup"
                  ],
                  "cmd-extra" : "-o StrictHostKeyChecking=no ls",
                  "host" : "db-standby",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "file" : "/etc/pgbackrest.conf",
                  "host" : "db-standby",
                  "option" : {
                     "demo" : {
                        "db-path" : {
                           "value" : "/var/lib/pgsql/9.5/data"
                        },
                        "recovery-option" : {
                           "value" : "standby_mode=on"
                        }
                     },
                     "global" : {
                        "backup-host" : {
                           "value" : "backup"
                        },
                        "log-level-stderr" : {
                           "value" : "off"
                        },
                        "log-timestamp" : {
                           "value" : "n"
                        }
                     }
                  }
               },
               "type" : "cfg-pgbackrest",
               "value" : {
                  "config" : [
                     "[demo]",
                     "db-path=/var/lib/pgsql/9.5/data",
                     "recovery-option=standby_mode=on",
                     "",
                     "[global]",
                     "backup-host=backup"
                  ]
               }
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres pgbackrest --stanza=demo --delta restore"
                  ],
                  "host" : "db-standby",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres cat /var/lib/pgsql/9.5/data/recovery.conf"
                  ],
                  "host" : "db-standby",
                  "output" : true
               },
               "type" : "exe",
               "value" : {
                  "output" : [
                     "standby_mode = 'on'",
                     "restore_command = '/usr/bin/pgbackrest --stanza=demo archive-get %f \"%p\"'"
                  ]
               }
            },
            {
               "key" : {
                  "file" : "/var/lib/pgsql/9.5/data/postgresql.conf",
                  "host" : "db-standby",
                  "option" : {
                     "hot_standby" : {
                        "value" : "on"
                     }
                  }
               },
               "type" : "cfg-postgresql",
               "value" : {
                  "config" : [
                     "hot_standby = on"
                  ]
               }
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo rm /var/lib/pgsql/9.5/data/pg_log/postgresql.log"
                  ],
                  "host" : "db-standby",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo service postgresql-9.5 start"
                  ],
                  "host" : "db-standby",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres sleep 2"
                  ],
                  "host" : "db-standby",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres cat /var/lib/pgsql/9.5/data/pg_log/postgresql.log"
                  ],
                  "highlight" : {
                     "filter" : true,
                     "filter-context" : 2,
                     "list" : [
                        "entering standby mode|database system is ready to accept read only connections"
                     ]
                  },
                  "host" : "db-standby",
                  "output" : true
               },
               "type" : "exe",
               "value" : {
                  "output" : [
                     "LOG:  database system was interrupted; last known up at 2018-07-05 22:12:59 UTC",
                     "LOG:  entering standby mode",
                     "LOG:  restored log file \"00000008.history\" from archive",
                     "LOG:  restored log file \"000000080000000000000027\" from archive",
                     "LOG:  redo starts at 0/27000028",
                     "LOG:  consistent recovery state reached at 0/270000F8",
                     "LOG:  database system is ready to accept read only connections"
                  ]
               }
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres psql -c \" \\",
                     "    begin; \\",
                     "    create table replicated_table (message text); \\",
                     "    insert into replicated_table values ('Important Data'); \\",
                     "    commit; \\",
                     "    select * from replicated_table\";"
                  ],
                  "highlight" : {
                     "filter" : true,
                     "filter-context" : 2,
                     "list" : [
                        "Important Data"
                     ]
                  },
                  "host" : "db-primary",
                  "output" : true
               },
               "type" : "exe",
               "value" : {
                  "output" : [
                     "    message     ",
                     "----------------",
                     " Important Data",
                     "(1 row)"
                  ]
               }
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres psql -c \"select * from replicated_table;\""
                  ],
                  "err-expect" : "1",
                  "highlight" : {
                     "filter" : true,
                     "filter-context" : 2,
                     "list" : [
                        "does not exist"
                     ]
                  },
                  "host" : "db-standby",
                  "output" : true
               },
               "type" : "exe",
               "value" : {
                  "output" : [
                     "ERROR:  relation \"replicated_table\" does not exist",
                     "LINE 1: select * from replicated_table;",
                     "                      ^"
                  ]
               }
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres psql -c \"select *, current_timestamp from pg_switch_xlog()\";"
                  ],
                  "host" : "db-primary",
                  "output" : true
               },
               "type" : "exe",
               "value" : {
                  "output" : [
                     " pg_switch_xlog |              now              ",
                     "----------------+-------------------------------",
                     " 0/2801CDA8     | 2018-07-05 22:13:33.985121+00",
                     "(1 row)"
                  ]
               }
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres psql -c \" \\",
                     "    select *, current_timestamp from replicated_table\""
                  ],
                  "highlight" : {
                     "filter" : false,
                     "filter-context" : 2,
                     "list" : [
                        "Important Data"
                     ]
                  },
                  "host" : "db-standby",
                  "output" : true
               },
               "type" : "exe",
               "value" : {
                  "output" : [
                     "    message     |              now              ",
                     "----------------+-------------------------------",
                     " Important Data | 2018-07-05 22:13:35.887026+00",
                     "(1 row)"
                  ]
               }
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres pgbackrest --stanza=demo --log-level-console=info check"
                  ],
                  "highlight" : {
                     "filter" : true,
                     "filter-context" : 2,
                     "list" : [
                        "all other checks passed"
                     ]
                  },
                  "host" : "db-standby",
                  "output" : true
               },
               "type" : "exe",
               "value" : {
                  "output" : [
                     "P00   INFO: check command begin 1.29: --backup-host=backup --db1-path=/var/lib/pgsql/9.5/data --log-level-console=info --log-level-stderr=off --no-log-timestamp --stanza=demo",
                     "P00   INFO: switch xlog cannot be performed on the standby, all other checks passed successfully",
                     "P00   INFO: check command end: completed successfully"
                  ]
               }
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres psql -c \" \\",
                     "    create user replicator password 'jw8s0F4' replication\";"
                  ],
                  "host" : "db-primary",
                  "output" : true
               },
               "type" : "exe",
               "value" : {
                  "output" : [
                     "CREATE ROLE"
                  ]
               }
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres sh -c 'echo \\",
                     "    \"host    replication     replicator      172.17.0.5/32           md5\" \\",
                     "    >> /var/lib/pgsql/9.5/data/pg_hba.conf'"
                  ],
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo service postgresql-9.5 reload"
                  ],
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "file" : "/etc/pgbackrest.conf",
                  "host" : "db-standby",
                  "option" : {
                     "demo" : {
                        "recovery-option" : {
                           "value" : "primary_conninfo=host=172.17.0.3 port=5432 user=replicator"
                        }
                     }
                  }
               },
               "type" : "cfg-pgbackrest",
               "value" : {
                  "config" : [
                     "[demo]",
                     "db-path=/var/lib/pgsql/9.5/data",
                     "recovery-option=standby_mode=on",
                     "recovery-option=primary_conninfo=host=172.17.0.3 port=5432 user=replicator",
                     "",
                     "[global]",
                     "backup-host=backup"
                  ]
               }
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres sh -c 'echo \\",
                     "    \"172.17.0.3:*:replication:replicator:jw8s0F4\" \\",
                     "    >> /home/postgres/.pgpass'"
                  ],
                  "host" : "db-standby",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres chmod 600 /home/postgres/.pgpass"
                  ],
                  "host" : "db-standby",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo service postgresql-9.5 stop"
                  ],
                  "host" : "db-standby",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres pgbackrest --stanza=demo --delta restore"
                  ],
                  "host" : "db-standby",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres cat /var/lib/pgsql/9.5/data/recovery.conf"
                  ],
                  "host" : "db-standby",
                  "output" : true
               },
               "type" : "exe",
               "value" : {
                  "output" : [
                     "primary_conninfo = 'host=172.17.0.3 port=5432 user=replicator'",
                     "standby_mode = 'on'",
                     "restore_command = '/usr/bin/pgbackrest --stanza=demo archive-get %f \"%p\"'"
                  ]
               }
            },
            {
               "key" : {
                  "file" : "/var/lib/pgsql/9.5/data/postgresql.conf",
                  "host" : "db-standby",
                  "option" : {
                     "hot_standby" : {
                        "value" : "on"
                     }
                  }
               },
               "type" : "cfg-postgresql",
               "value" : {
                  "config" : [
                     "hot_standby = on"
                  ]
               }
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo rm /var/lib/pgsql/9.5/data/pg_log/postgresql.log"
                  ],
                  "host" : "db-standby",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo service postgresql-9.5 start"
                  ],
                  "host" : "db-standby",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres sleep 2"
                  ],
                  "host" : "db-standby",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres cat /var/lib/pgsql/9.5/data/pg_log/postgresql.log"
                  ],
                  "highlight" : {
                     "filter" : true,
                     "filter-context" : 2,
                     "list" : [
                        "started streaming WAL from primary"
                     ]
                  },
                  "host" : "db-standby",
                  "output" : true
               },
               "type" : "exe",
               "value" : {
                  "output" : [
                     "       [filtered 6 lines of output]",
                     "LOG:  database system is ready to accept read only connections",
                     "LOG:  restored log file \"000000080000000000000028\" from archive",
                     "LOG:  started streaming WAL from primary at 0/29000000 on timeline 8"
                  ]
               }
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres psql -c \" \\",
                     "    begin; \\",
                     "    create table stream_table (message text); \\",
                     "    insert into stream_table values ('Important Data'); \\",
                     "    commit; \\",
                     "    select *, current_timestamp from stream_table\";"
                  ],
                  "highlight" : {
                     "filter" : true,
                     "filter-context" : 2,
                     "list" : [
                        "Important Data"
                     ]
                  },
                  "host" : "db-primary",
                  "output" : true
               },
               "type" : "exe",
               "value" : {
                  "output" : [
                     "    message     |              now              ",
                     "----------------+-------------------------------",
                     " Important Data | 2018-07-05 22:13:48.092903+00",
                     "(1 row)"
                  ]
               }
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres psql -c \" \\",
                     "    select *, current_timestamp from stream_table\""
                  ],
                  "highlight" : {
                     "filter" : false,
                     "filter-context" : 2,
                     "list" : [
                        "Important Data"
                     ]
                  },
                  "host" : "db-standby",
                  "output" : true
               },
               "type" : "exe",
               "value" : {
                  "output" : [
                     "    message     |              now              ",
                     "----------------+-------------------------------",
                     " Important Data | 2018-07-05 22:13:48.317195+00",
                     "(1 row)"
                  ]
               }
            },
            {
               "key" : {
                  "file" : "/etc/pgbackrest.conf",
                  "host" : "backup",
                  "option" : {
                     "demo" : {
                        "db2-host" : {
                           "value" : "db-standby"
                        },
                        "db2-path" : {
                           "value" : "/var/lib/pgsql/9.5/data"
                        },
                        "db2-user" : {
                           "value" : "postgres"
                        }
                     },
                     "global" : {
                        "backup-standby" : {
                           "value" : "y"
                        }
                     }
                  }
               },
               "type" : "cfg-pgbackrest",
               "value" : {
                  "config" : [
                     "[demo]",
                     "db1-host=db-primary",
                     "db1-path=/var/lib/pgsql/9.5/data",
                     "db1-user=postgres",
                     "db2-host=db-standby",
                     "db2-path=/var/lib/pgsql/9.5/data",
                     "db2-user=postgres",
                     "",
                     "[global]",
                     "backup-standby=y",
                     "process-max=3",
                     "repo-path=/var/lib/pgbackrest",
                     "retention-full=2",
                     "start-fast=y"
                  ]
               }
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u backrest pgbackrest --stanza=demo --log-level-console=detail backup"
                  ],
                  "highlight" : {
                     "filter" : true,
                     "filter-context" : 2,
                     "list" : [
                        "backup file db-primary|replay on the standby"
                     ]
                  },
                  "host" : "backup",
                  "output" : true
               },
               "type" : "exe",
               "value" : {
                  "output" : [
                     "       [filtered 2 lines of output]",
                     "P00   INFO: execute exclusive pg_start_backup() with label \"pgBackRest backup started at 2018-07-05 22:13:49\": backup begins after the requested immediate checkpoint completes",
                     "P00   INFO: backup start archive = 00000008000000000000002A, lsn = 0/2A000028",
                     "P00   INFO: wait for replay on the standby to reach 0/2A000028",
                     "P00   INFO: replay on the standby reached 0/2A0000D0",
                     "P01   INFO: backup file db-primary:/var/lib/pgsql/9.5/data/global/pg_control (8KB, 0%) checksum 2957acfd8b8aca53d14ef3e47ee791307fe88537",
                     "P01   INFO: backup file db-primary:/var/lib/pgsql/9.5/data/pg_log/postgresql.log (4.6KB, 0%) checksum de06b50939c7b61de6e8498a1da88980de6616e8",
                     "P01   INFO: backup file db-primary:/var/lib/pgsql/9.5/data/pg_hba.conf (4.1KB, 0%) checksum dbda288edbce6486fab7ca9f9db0864316754bee",
                     "P01   INFO: backup file db-primary:/var/lib/pgsql/9.5/data/backup_label (238B, 0%) checksum 4b59decbcdce225bb986b85e51bfac160189dac3",
                     "P03   INFO: backup file db-standby:/var/lib/pgsql/9.5/data/base/13247/2674 (360KB, 17%) checksum 3d12b96846b35adeb8d3349da85d1945304c11be",
                     "P04   INFO: backup file db-standby:/var/lib/pgsql/9.5/data/base/13247/1249 (360KB, 33%) checksum 8b60de66e09cc4810212dc82a9cd56dae78aa702",
                     "       [filtered 36 lines of output]"
                  ]
               }
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo yum install postgresql96-server"
                  ],
                  "cmd-extra" : "-y",
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo service postgresql-9.6 initdb"
                  ],
                  "host" : "db-primary",
                  "output" : true
               },
               "type" : "exe",
               "value" : {
                  "output" : [
                     "Initializing database: [  OK  ]\r"
                  ]
               }
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo service postgresql-9.5 stop"
                  ],
                  "host" : "db-standby",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo yum install postgresql96-server"
                  ],
                  "cmd-extra" : "-y",
                  "host" : "db-standby",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo service postgresql-9.5 stop"
                  ],
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres sh -c 'cd /var/lib/pgsql && \\",
                     "    /usr/pgsql-9.6/bin/pg_upgrade \\",
                     "    --old-bindir=/usr/pgsql-9.5/bin \\",
                     "    --new-bindir=/usr/pgsql-9.6/bin \\",
                     "    --old-datadir=/var/lib/pgsql/9.5/data \\",
                     "    --new-datadir=/var/lib/pgsql/9.6/data \\",
                     "    --old-options=\" -c config_file=/var/lib/pgsql/9.5/data/postgresql.conf\" \\",
                     "    --new-options=\" -c config_file=/var/lib/pgsql/9.6/data/postgresql.conf\"'"
                  ],
                  "highlight" : {
                     "filter" : true,
                     "filter-context" : 2,
                     "list" : [
                        "Upgrade Complete"
                     ]
                  },
                  "host" : "db-primary",
                  "output" : true
               },
               "type" : "exe",
               "value" : {
                  "output" : [
                     "       [filtered 69 lines of output]",
                     "Creating script to delete old cluster                       ok",
                     "",
                     "Upgrade Complete",
                     "----------------",
                     "Optimizer statistics are not transferred by pg_upgrade so,",
                     "       [filtered 4 lines of output]"
                  ]
               }
            },
            {
               "key" : {
                  "file" : "/var/lib/pgsql/9.6/data/postgresql.conf",
                  "host" : "db-primary",
                  "option" : {
                     "archive_command" : {
                        "value" : "'pgbackrest --stanza=demo archive-push %p'"
                     },
                     "archive_mode" : {
                        "value" : "on"
                     },
                     "listen_addresses" : {
                        "value" : "'*'"
                     },
                     "log_line_prefix" : {
                        "value" : "''"
                     },
                     "max_wal_senders" : {
                        "value" : "3"
                     },
                     "port" : {
                        "value" : "5432"
                     },
                     "wal_level" : {
                        "value" : "hot_standby"
                     }
                  }
               },
               "type" : "cfg-postgresql",
               "value" : {
                  "config" : [
                     "archive_command = 'pgbackrest --stanza=demo archive-push %p'",
                     "archive_mode = on",
                     "listen_addresses = '*'",
                     "log_line_prefix = ''",
                     "max_wal_senders = 3",
                     "port = 5432",
                     "wal_level = hot_standby"
                  ]
               }
            },
            {
               "key" : {
                  "file" : "/etc/pgbackrest.conf",
                  "host" : "db-primary",
                  "option" : {
                     "demo" : {
                        "db-path" : {
                           "value" : "/var/lib/pgsql/9.6/data"
                        }
                     }
                  }
               },
               "type" : "cfg-pgbackrest",
               "value" : {
                  "config" : [
                     "[demo]",
                     "db-path=/var/lib/pgsql/9.6/data",
                     "",
                     "[global]",
                     "archive-async=y",
                     "backup-host=backup",
                     "backup-user=backrest",
                     "log-level-file=detail",
                     "spool-path=/var/spool/pgbackrest",
                     "",
                     "[global:archive-push]",
                     "process-max=2"
                  ]
               }
            },
            {
               "key" : {
                  "file" : "/etc/pgbackrest.conf",
                  "host" : "db-standby",
                  "option" : {
                     "demo" : {
                        "db-path" : {
                           "value" : "/var/lib/pgsql/9.6/data"
                        }
                     }
                  }
               },
               "type" : "cfg-pgbackrest",
               "value" : {
                  "config" : [
                     "[demo]",
                     "db-path=/var/lib/pgsql/9.6/data",
                     "recovery-option=standby_mode=on",
                     "recovery-option=primary_conninfo=host=172.17.0.3 port=5432 user=replicator",
                     "",
                     "[global]",
                     "backup-host=backup"
                  ]
               }
            },
            {
               "key" : {
                  "file" : "/etc/pgbackrest.conf",
                  "host" : "backup",
                  "option" : {
                     "demo" : {
                        "db1-path" : {
                           "value" : "/var/lib/pgsql/9.6/data"
                        },
                        "db2-path" : {
                           "value" : "/var/lib/pgsql/9.6/data"
                        }
                     },
                     "global" : {
                        "backup-standby" : {
                           "value" : "n"
                        }
                     }
                  }
               },
               "type" : "cfg-pgbackrest",
               "value" : {
                  "config" : [
                     "[demo]",
                     "db1-host=db-primary",
                     "db1-path=/var/lib/pgsql/9.6/data",
                     "db1-user=postgres",
                     "db2-host=db-standby",
                     "db2-path=/var/lib/pgsql/9.6/data",
                     "db2-user=postgres",
                     "",
                     "[global]",
                     "backup-standby=n",
                     "process-max=3",
                     "repo-path=/var/lib/pgbackrest",
                     "retention-full=2",
                     "start-fast=y"
                  ]
               }
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo cp /var/lib/pgsql/9.5/data/pg_hba.conf \\",
                     "    /var/lib/pgsql/9.6/data/pg_hba.conf"
                  ],
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u backrest pgbackrest --stanza=demo --no-online \\",
                     "    --log-level-console=info stanza-upgrade"
                  ],
                  "highlight" : {
                     "filter" : true,
                     "filter-context" : 2,
                     "list" : [
                        "completed successfully"
                     ]
                  },
                  "host" : "backup",
                  "output" : true
               },
               "type" : "exe",
               "value" : {
                  "output" : [
                     "P00   INFO: stanza-upgrade command begin 1.29: --no-backup-standby --db1-host=db-primary --db1-path=/var/lib/pgsql/9.6/data --db1-user=postgres --db2-host=db-standby --db2-path=/var/lib/pgsql/9.6/data --db2-user=postgres --log-level-console=info --log-level-stderr=off --no-log-timestamp --no-online --repo-path=/var/lib/pgbackrest --stanza=demo",
                     "P00   INFO: stanza-upgrade command end: completed successfully"
                  ]
               }
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo service postgresql-9.6 start"
                  ],
                  "host" : "db-primary",
                  "output" : true
               },
               "type" : "exe",
               "value" : {
                  "output" : [
                     "Starting postgresql-9.6 service: [  OK  ]\r"
                  ]
               }
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres service postgresql-9.6 status"
                  ],
                  "host" : "db-primary",
                  "output" : true
               },
               "type" : "exe",
               "value" : {
                  "output" : [
                     "postgresql-9.6 (pid  5448) is running..."
                  ]
               }
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres pgbackrest --stanza=demo check"
                  ],
                  "host" : "db-primary",
                  "output" : true
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u backrest pgbackrest --stanza=demo check"
                  ],
                  "host" : "backup",
                  "output" : true
               },
               "type" : "exe",
               "value" : {
                  "output" : [
                     "P00   WARN: [056]: raised from remote process on 'db-standby': could not connect to server: No such file or directory",
                     "            \tIs the server running locally and accepting",
                     "            \tconnections on Unix domain socket \"/var/run/postgresql/.s.PGSQL.5432\"?"
                  ]
               }
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo rm -rf /var/lib/pgsql/9.5/data"
                  ],
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u backrest pgbackrest --stanza=demo --type=full backup"
                  ],
                  "host" : "backup",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo rm -rf /var/lib/pgsql/9.5/data"
                  ],
                  "host" : "db-standby",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo service postgresql-9.6 initdb"
                  ],
                  "host" : "db-standby",
                  "output" : true
               },
               "type" : "exe",
               "value" : {
                  "output" : [
                     "Initializing database: [  OK  ]\r"
                  ]
               }
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres pgbackrest --stanza=demo --delta restore"
                  ],
                  "host" : "db-standby",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "file" : "/var/lib/pgsql/9.6/data/postgresql.conf",
                  "host" : "db-standby",
                  "option" : {
                     "hot_standby" : {
                        "value" : "on"
                     }
                  }
               },
               "type" : "cfg-postgresql",
               "value" : {
                  "config" : [
                     "hot_standby = on"
                  ]
               }
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo service postgresql-9.6 start"
                  ],
                  "host" : "db-standby",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres sleep 2"
                  ],
                  "host" : "db-standby",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "file" : "/etc/pgbackrest.conf",
                  "host" : "backup",
                  "option" : {
                     "global" : {
                        "backup-standby" : {
                           "value" : "y"
                        }
                     }
                  }
               },
               "type" : "cfg-pgbackrest",
               "value" : {
                  "config" : [
                     "[demo]",
                     "db1-host=db-primary",
                     "db1-path=/var/lib/pgsql/9.6/data",
                     "db1-user=postgres",
                     "db2-host=db-standby",
                     "db2-path=/var/lib/pgsql/9.6/data",
                     "db2-user=postgres",
                     "",
                     "[global]",
                     "backup-standby=y",
                     "process-max=3",
                     "repo-path=/var/lib/pgbackrest",
                     "retention-full=2",
                     "start-fast=y"
                  ]
               }
            }
         ]
      }
   },
   "default" : {
      "all" : {
         "user-guide" : [
            {
               "key" : {
                  "image" : "pgbackrest/test:u16-s3-server",
                  "name" : "s3-server",
                  "os" : "u16"
               },
               "type" : "host",
               "value" : {
                  "ip" : "172.17.0.2"
               }
            },
            {
               "key" : {
                  "image" : "pgbackrest/test:u16-base",
                  "name" : "db-primary",
                  "os" : "u16"
               },
               "type" : "host",
               "value" : {
                  "ip" : "172.17.0.3"
               }
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres perl -V | grep USE_64_BIT_INT"
                  ],
                  "host" : "db-primary",
                  "output" : true
               },
               "type" : "exe",
               "value" : {
                  "output" : [
                     "                        USE_64_BIT_ALL USE_64_BIT_INT USE_ITHREADS"
                  ]
               }
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo rm -f /usr/bin/pgbackrest"
                  ],
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo rm -f /usr/bin/pg_backrest"
                  ],
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo rm -rf /usr/lib/perl5/BackRest"
                  ],
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo rm -rf /usr/share/perl5/BackRest"
                  ],
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo rm -rf /usr/lib/perl5/pgBackRest"
                  ],
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo rm -rf /usr/share/perl5/pgBackRest"
                  ],
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo apt-get install libdbd-pg-perl libio-socket-ssl-perl libxml-libxml-perl"
                  ],
                  "cmd-extra" : "-y 2>&1",
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo mkdir /root/pgbackrest-release-1.29"
                  ],
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo cp -r /backrest/bin /root/pgbackrest-release-1.29"
                  ],
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo cp -r /backrest/build /root/pgbackrest-release-1.29"
                  ],
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo cp -r /backrest/lib /root/pgbackrest-release-1.29"
                  ],
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo cp -r /backrest/libc /root/pgbackrest-release-1.29"
                  ],
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo cp -r /backrest/src /root/pgbackrest-release-1.29"
                  ],
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo cp -r /root/pgbackrest-release-1.29/lib/pgBackRest \\",
                     "    /usr/share/perl5"
                  ],
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo find /usr/share/perl5/pgBackRest -type f -exec chmod 644 {} +"
                  ],
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo find /usr/share/perl5/pgBackRest -type d -exec chmod 755 {} +"
                  ],
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo cp /root/pgbackrest-release-1.29/bin/pgbackrest /usr/bin/pgbackrest"
                  ],
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo chmod 755 /usr/bin/pgbackrest"
                  ],
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo mkdir -m 770 /var/log/pgbackrest"
                  ],
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo chown postgres:postgres /var/log/pgbackrest"
                  ],
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo touch /etc/pgbackrest.conf"
                  ],
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo chmod 640 /etc/pgbackrest.conf"
                  ],
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo chown postgres:postgres /etc/pgbackrest.conf"
                  ],
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo sh -c 'cd /root/pgbackrest-release-1.29/libc && \\",
                     "    perl Makefile.PL INSTALLMAN1DIR=none INSTALLMAN3DIR=none'"
                  ],
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo make -C /root/pgbackrest-release-1.29/libc test"
                  ],
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo make -C /root/pgbackrest-release-1.29/libc install"
                  ],
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres pgbackrest"
                  ],
                  "host" : "db-primary",
                  "output" : true
               },
               "type" : "exe",
               "value" : {
                  "output" : [
                     "pgBackRest 1.29 - General help",
                     "",
                     "Usage:",
                     "    pgbackrest [options] [command]",
                     "",
                     "Commands:",
                     "    archive-get     Get a WAL segment from the archive.",
                     "    archive-push    Push a WAL segment to the archive.",
                     "    backup          Backup a database cluster.",
                     "    check           Check the configuration.",
                     "    expire          Expire backups that exceed retention.",
                     "    help            Get help.",
                     "    info            Retrieve information about backups.",
                     "    restore         Restore a database cluster.",
                     "    stanza-create   Create the required stanza data.",
                     "    stanza-delete   Delete a stanza.",
                     "    stanza-upgrade  Upgrade a stanza.",
                     "    start           Allow pgBackRest processes to run.",
                     "    stop            Stop pgBackRest processes from running.",
                     "    version         Get version.",
                     "",
                     "Use 'pgbackrest help [command]' for more information."
                  ]
               }
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres /usr/lib/postgresql/9.4/bin/initdb \\",
                     "    -D /var/lib/postgresql/9.4/demo -k -A peer"
                  ],
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo pg_createcluster 9.4 demo"
                  ],
                  "host" : "db-primary",
                  "output" : true
               },
               "type" : "exe",
               "value" : {
                  "output" : [
                     "Configuring already existing cluster (configuration: /etc/postgresql/9.4/demo, data: /var/lib/postgresql/9.4/demo, owner: 5000:5000)",
                     "Ver Cluster Port Status Owner    Data directory               Log file",
                     "9.4 demo    5432 down   postgres /var/lib/postgresql/9.4/demo /var/log/postgresql/postgresql-9.4-demo.log"
                  ]
               }
            },
            {
               "key" : {
                  "file" : "/etc/postgresql/9.4/demo/postgresql.conf",
                  "host" : "db-primary",
                  "option" : {
                     "listen_addresses" : {
                        "value" : "'*'"
                     }
                  }
               },
               "type" : "cfg-postgresql",
               "value" : {
                  "config" : [
                     "listen_addresses = '*'"
                  ]
               }
            },
            {
               "key" : {
                  "file" : "/etc/postgresql/9.4/demo/postgresql.conf",
                  "host" : "db-primary",
                  "option" : {
                     "log_line_prefix" : {
                        "value" : "''"
                     }
                  }
               },
               "type" : "cfg-postgresql",
               "value" : {
                  "config" : [
                     "listen_addresses = '*'",
                     "log_line_prefix = ''"
                  ]
               }
            },
            {
               "key" : {
                  "file" : "/etc/pgbackrest.conf",
                  "host" : "db-primary",
                  "option" : {
                     "demo" : {
                        "db-path" : {
                           "value" : "/var/lib/postgresql/9.4/demo"
                        }
                     },
                     "global" : {
                        "log-level-stderr" : {
                           "value" : "off"
                        },
                        "log-timestamp" : {
                           "value" : "n"
                        }
                     }
                  }
               },
               "type" : "cfg-pgbackrest",
               "value" : {
                  "config" : [
                     "[demo]",
                     "db-path=/var/lib/postgresql/9.4/demo"
                  ]
               }
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo mkdir /var/lib/pgbackrest"
                  ],
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo chmod 750 /var/lib/pgbackrest"
                  ],
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo chown postgres:postgres /var/lib/pgbackrest"
                  ],
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "file" : "/etc/pgbackrest.conf",
                  "host" : "db-primary",
                  "option" : {
                     "global" : {
                        "repo-path" : {
                           "value" : "/var/lib/pgbackrest"
                        }
                     }
                  }
               },
               "type" : "cfg-pgbackrest",
               "value" : {
                  "config" : [
                     "[demo]",
                     "db-path=/var/lib/postgresql/9.4/demo",
                     "",
                     "[global]",
                     "repo-path=/var/lib/pgbackrest"
                  ]
               }
            },
            {
               "key" : {
                  "file" : "/etc/postgresql/9.4/demo/postgresql.conf",
                  "host" : "db-primary",
                  "option" : {
                     "archive_command" : {
                        "value" : "'pgbackrest --stanza=demo archive-push %p'"
                     },
                     "archive_mode" : {
                        "value" : "on"
                     },
                     "max_wal_senders" : {
                        "value" : "3"
                     },
                     "wal_level" : {
                        "value" : "hot_standby"
                     }
                  }
               },
               "type" : "cfg-postgresql",
               "value" : {
                  "config" : [
                     "archive_command = 'pgbackrest --stanza=demo archive-push %p'",
                     "archive_mode = on",
                     "listen_addresses = '*'",
                     "log_line_prefix = ''",
                     "max_wal_senders = 3",
                     "wal_level = hot_standby"
                  ]
               }
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo pg_ctlcluster 9.4 demo restart"
                  ],
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres sleep 2"
                  ],
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "file" : "/etc/pgbackrest.conf",
                  "host" : "db-primary",
                  "option" : {
                     "global" : {
                        "retention-full" : {
                           "value" : "2"
                        }
                     }
                  }
               },
               "type" : "cfg-pgbackrest",
               "value" : {
                  "config" : [
                     "[demo]",
                     "db-path=/var/lib/postgresql/9.4/demo",
                     "",
                     "[global]",
                     "repo-path=/var/lib/pgbackrest",
                     "retention-full=2"
                  ]
               }
            },
            {
               "key" : {
                  "file" : "/etc/pgbackrest.conf",
                  "host" : "db-primary",
                  "option" : {
                     "global" : {
                        "repo-cipher-pass" : {
                           "value" : "zWaf6XtpjIVZC5444yXB+cgFDFl7MxGlgkZSaoPvTGirhPygu4jOKOXf9LO4vjfO"
                        },
                        "repo-cipher-type" : {
                           "value" : "aes-256-cbc"
                        }
                     }
                  }
               },
               "type" : "cfg-pgbackrest",
               "value" : {
                  "config" : [
                     "[demo]",
                     "db-path=/var/lib/postgresql/9.4/demo",
                     "",
                     "[global]",
                     "repo-cipher-pass=zWaf6XtpjIVZC5444yXB+cgFDFl7MxGlgkZSaoPvTGirhPygu4jOKOXf9LO4vjfO",
                     "repo-cipher-type=aes-256-cbc",
                     "repo-path=/var/lib/pgbackrest",
                     "retention-full=2"
                  ]
               }
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres pgbackrest --stanza=demo --log-level-console=info stanza-create"
                  ],
                  "highlight" : {
                     "filter" : true,
                     "filter-context" : 2,
                     "list" : [
                        "completed successfully"
                     ]
                  },
                  "host" : "db-primary",
                  "output" : true
               },
               "type" : "exe",
               "value" : {
                  "output" : [
                     "P00   INFO: stanza-create command begin 1.29: --db1-path=/var/lib/postgresql/9.4/demo --log-level-console=info --log-level-stderr=off --no-log-timestamp --repo-cipher-pass=<redacted> --repo-cipher-type=aes-256-cbc --repo-path=/var/lib/pgbackrest --stanza=demo",
                     "P00   INFO: stanza-create command end: completed successfully"
                  ]
               }
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres pgbackrest --stanza=demo --log-level-console=info check"
                  ],
                  "highlight" : {
                     "filter" : true,
                     "filter-context" : 2,
                     "list" : [
                        " successfully stored in the archive at "
                     ]
                  },
                  "host" : "db-primary",
                  "output" : true
               },
               "type" : "exe",
               "value" : {
                  "output" : [
                     "P00   INFO: check command begin 1.29: --db1-path=/var/lib/postgresql/9.4/demo --log-level-console=info --log-level-stderr=off --no-log-timestamp --repo-cipher-pass=<redacted> --repo-cipher-type=aes-256-cbc --repo-path=/var/lib/pgbackrest --stanza=demo",
                     "P00   INFO: WAL segment 000000010000000000000001 successfully stored in the archive at '/var/lib/pgbackrest/archive/demo/9.4-1/0000000100000000/000000010000000000000001-a2cb0209004f0a7872bdf06c8515baf435beb1ab.gz'",
                     "P00   INFO: check command end: completed successfully"
                  ]
               }
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres pgbackrest --stanza=demo \\",
                     "    --log-level-console=info backup"
                  ],
                  "highlight" : {
                     "filter" : true,
                     "filter-context" : 2,
                     "list" : [
                        "no prior backup exists|full backup size"
                     ]
                  },
                  "host" : "db-primary",
                  "output" : true
               },
               "type" : "exe",
               "value" : {
                  "output" : [
                     "P00   INFO: backup command begin 1.29: --db1-path=/var/lib/postgresql/9.4/demo --log-level-console=info --log-level-stderr=off --no-log-timestamp --repo-cipher-pass=<redacted> --repo-cipher-type=aes-256-cbc --repo-path=/var/lib/pgbackrest --retention-full=2 --stanza=demo",
                     "P00   WARN: no prior backup exists, incr backup has been changed to full",
                     "P00   INFO: execute exclusive pg_start_backup() with label \"pgBackRest backup started at 2018-07-05 22:15:23\": backup begins after the next regular checkpoint completes",
                     "P00   INFO: backup start archive = 000000010000000000000002, lsn = 0/2000028",
                     "       [filtered 754 lines of output]",
                     "P01   INFO: backup file /var/lib/postgresql/9.4/demo/base/1/11895 (0B, 100%)",
                     "P01   INFO: backup file /var/lib/postgresql/9.4/demo/base/1/11885 (0B, 100%)",
                     "P00   INFO: full backup size = 19.2MB",
                     "P00   INFO: execute exclusive pg_stop_backup() and wait for all WAL segments to archive",
                     "P00   INFO: backup stop archive = 000000010000000000000002, lsn = 0/2000128",
                     "       [filtered 4 lines of output]"
                  ]
               }
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres ls -1 /var/lib/pgbackrest/backup/demo | tail -5 | head -1"
                  ],
                  "host" : "db-primary",
                  "output" : true
               },
               "type" : "exe",
               "value" : {
                  "output" : [
                     "20180705-221523F"
                  ]
               }
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres pgbackrest --stanza=demo --type=diff \\",
                     "    --log-level-console=info backup"
                  ],
                  "highlight" : {
                     "filter" : true,
                     "filter-context" : 2,
                     "list" : [
                        "diff backup size"
                     ]
                  },
                  "host" : "db-primary",
                  "output" : true
               },
               "type" : "exe",
               "value" : {
                  "output" : [
                     "       [filtered 4 lines of output]",
                     "P01   INFO: backup file /var/lib/postgresql/9.4/demo/global/pg_control (8KB, 97%) checksum a2b990954b573ece4f51abf6fc7078d7c115cd47",
                     "P01   INFO: backup file /var/lib/postgresql/9.4/demo/backup_label (236B, 100%) checksum b619ed4bdc754eef7642fae8ecae479b6581a060",
                     "P00   INFO: diff backup size = 8.2KB",
                     "P00   INFO: execute exclusive pg_stop_backup() and wait for all WAL segments to archive",
                     "P00   INFO: backup stop archive = 000000010000000000000003, lsn = 0/30000F0",
                     "       [filtered 4 lines of output]"
                  ]
               }
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres pgbackrest info"
                  ],
                  "highlight" : {
                     "filter" : false,
                     "filter-context" : 2,
                     "list" : [
                        "(full|incr|diff) backup"
                     ]
                  },
                  "host" : "db-primary",
                  "output" : true
               },
               "type" : "exe",
               "value" : {
                  "output" : [
                     "stanza: demo",
                     "    status: ok",
                     "",
                     "    db (current)",
                     "        wal archive min/max (9.4-1): 000000010000000000000002 / 000000010000000000000003",
                     "",
                     "        full backup: 20180705-221523F",
                     "            timestamp start/stop: 2018-07-05 22:15:23 / 2018-07-05 22:15:34",
                     "            wal start/stop: 000000010000000000000002 / 000000010000000000000002",
                     "            database size: 19.2MB, backup size: 19.2MB",
                     "            repository size: 2.2MB, repository backup size: 2.2MB",
                     "",
                     "        diff backup: 20180705-221523F_20180705-221534D",
                     "            timestamp start/stop: 2018-07-05 22:15:34 / 2018-07-05 22:15:37",
                     "            wal start/stop: 000000010000000000000003 / 000000010000000000000003",
                     "            database size: 19.2MB, backup size: 8.2KB",
                     "            repository size: 2.2MB, repository backup size: 400B",
                     "            backup reference list: 20180705-221523F"
                  ]
               }
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo pg_ctlcluster 9.4 demo stop"
                  ],
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres rm /var/lib/postgresql/9.4/demo/global/pg_control"
                  ],
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo pg_ctlcluster 9.4 demo start"
                  ],
                  "err-expect" : "1",
                  "highlight" : {
                     "filter" : true,
                     "filter-context" : 2,
                     "list" : [
                        "could not find the database system"
                     ]
                  },
                  "host" : "db-primary",
                  "output" : true
               },
               "type" : "exe",
               "value" : {
                  "output" : [
                     "The PostgreSQL server failed to start. Please check the log output:",
                     "postgres: could not find the database system",
                     "Expected to find it in the directory \"/var/lib/postgresql/9.4/demo\",",
                     "but could not open file \"/var/lib/postgresql/9.4/demo/global/pg_control\": No such file or directory"
                  ]
               }
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres sleep 2"
                  ],
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres find /var/lib/postgresql/9.4/demo -mindepth 1 -delete"
                  ],
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres pgbackrest --stanza=demo restore"
                  ],
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo pg_ctlcluster 9.4 demo start"
                  ],
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres sleep 2"
                  ],
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres pgbackrest --stanza=demo --type=incr \\",
                     "    --log-level-console=info backup"
                  ],
                  "highlight" : {
                     "filter" : true,
                     "filter-context" : 2,
                     "list" : [
                        "backup begins after the next regular checkpoint completes"
                     ]
                  },
                  "host" : "db-primary",
                  "output" : true
               },
               "type" : "exe",
               "value" : {
                  "output" : [
                     "P00   INFO: backup command begin 1.29: --db1-path=/var/lib/postgresql/9.4/demo --log-level-console=info --log-level-stderr=off --no-log-timestamp --repo-cipher-pass=<redacted> --repo-cipher-type=aes-256-cbc --repo-path=/var/lib/pgbackrest --retention-full=2 --stanza=demo --type=incr",
                     "P00   INFO: last backup label = 20180705-221523F_20180705-221534D, version = 1.29",
                     "P00   INFO: execute exclusive pg_start_backup() with label \"pgBackRest backup started at 2018-07-05 22:15:56\": backup begins after the next regular checkpoint completes",
                     "P00   INFO: backup start archive = 000000020000000000000005, lsn = 0/5000028",
                     "P01   INFO: backup file /var/lib/postgresql/9.4/demo/pg_multixact/offsets/0000 (8KB, 33%) checksum 0631457264ff7f8d5fb1edc2c0211992a67c73e6",
                     "       [filtered 10 lines of output]"
                  ]
               }
            },
            {
               "key" : {
                  "file" : "/etc/pgbackrest.conf",
                  "host" : "db-primary",
                  "option" : {
                     "global" : {
                        "start-fast" : {
                           "value" : "y"
                        }
                     }
                  }
               },
               "type" : "cfg-pgbackrest",
               "value" : {
                  "config" : [
                     "[demo]",
                     "db-path=/var/lib/postgresql/9.4/demo",
                     "",
                     "[global]",
                     "repo-cipher-pass=zWaf6XtpjIVZC5444yXB+cgFDFl7MxGlgkZSaoPvTGirhPygu4jOKOXf9LO4vjfO",
                     "repo-cipher-type=aes-256-cbc",
                     "repo-path=/var/lib/pgbackrest",
                     "retention-full=2",
                     "start-fast=y"
                  ]
               }
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres pgbackrest --stanza=demo --type=incr \\",
                     "    --log-level-console=info backup"
                  ],
                  "highlight" : {
                     "filter" : true,
                     "filter-context" : 2,
                     "list" : [
                        "backup begins after the requested immediate checkpoint completes"
                     ]
                  },
                  "host" : "db-primary",
                  "output" : true
               },
               "type" : "exe",
               "value" : {
                  "output" : [
                     "P00   INFO: backup command begin 1.29: --db1-path=/var/lib/postgresql/9.4/demo --log-level-console=info --log-level-stderr=off --no-log-timestamp --repo-cipher-pass=<redacted> --repo-cipher-type=aes-256-cbc --repo-path=/var/lib/pgbackrest --retention-full=2 --stanza=demo --start-fast --type=incr",
                     "P00   INFO: last backup label = 20180705-221523F_20180705-221556I, version = 1.29",
                     "P00   INFO: execute exclusive pg_start_backup() with label \"pgBackRest backup started at 2018-07-05 22:16:00\": backup begins after the requested immediate checkpoint completes",
                     "P00   INFO: backup start archive = 000000020000000000000006, lsn = 0/6000028",
                     "P01   INFO: backup file /var/lib/postgresql/9.4/demo/global/pg_control (8KB, 97%) checksum 7df60ef9b13f809b2b0548c6508da704b7d4dcb7",
                     "       [filtered 8 lines of output]"
                  ]
               }
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo chmod 550 /var/lib/pgbackrest/backup/demo/"
                  ],
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres pgbackrest --stanza=demo --type=incr \\",
                     "    --log-level-console=info backup"
                  ],
                  "err-expect" : "47",
                  "highlight" : {
                     "filter" : true,
                     "filter-context" : 2,
                     "list" : [
                        "ERROR:"
                     ]
                  },
                  "host" : "db-primary",
                  "output" : true
               },
               "type" : "exe",
               "value" : {
                  "output" : [
                     "       [filtered 2 lines of output]",
                     "P00   INFO: execute exclusive pg_start_backup() with label \"pgBackRest backup started at 2018-07-05 22:16:04\": backup begins after the requested immediate checkpoint completes",
                     "P00   INFO: backup start archive = 000000020000000000000007, lsn = 0/7000028",
                     "P00  ERROR: [047]: unable to create path '/var/lib/pgbackrest/backup/demo/20180705-221523F_20180705-221604I': Permission denied",
                     "P00   INFO: backup command end: aborted with exception [047]"
                  ]
               }
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo chmod 750 /var/lib/pgbackrest/backup/demo/"
                  ],
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres pgbackrest --stanza=demo --type=incr \\",
                     "    --log-level-console=info backup"
                  ],
                  "err-expect" : "57",
                  "highlight" : {
                     "filter" : true,
                     "filter-context" : 2,
                     "list" : [
                        "ERROR:"
                     ]
                  },
                  "host" : "db-primary",
                  "output" : true
               },
               "type" : "exe",
               "value" : {
                  "output" : [
                     "P00   INFO: backup command begin 1.29: --db1-path=/var/lib/postgresql/9.4/demo --log-level-console=info --log-level-stderr=off --no-log-timestamp --repo-cipher-pass=<redacted> --repo-cipher-type=aes-256-cbc --repo-path=/var/lib/pgbackrest --retention-full=2 --stanza=demo --start-fast --type=incr",
                     "P00   INFO: last backup label = 20180705-221523F_20180705-221600I, version = 1.29",
                     "P00   INFO: execute exclusive pg_start_backup() with label \"pgBackRest backup started at 2018-07-05 22:16:06\": backup begins after the requested immediate checkpoint completes",
                     "P00  ERROR: [057]: ERROR:  a backup is already in progress",
                     "            HINT:  Run pg_stop_backup() and try again.:",
                     "            select to_char(current_timestamp, 'YYYY-MM-DD HH24:MI:SS.US TZ'), pg_xlogfile_name(lsn), lsn::text from pg_start_backup('pgBackRest backup started at 2018-07-05 22:16:06', true) as lsn"
                  ]
               }
            },
            {
               "key" : {
                  "file" : "/etc/pgbackrest.conf",
                  "host" : "db-primary",
                  "option" : {
                     "global" : {
                        "stop-auto" : {
                           "value" : "y"
                        }
                     }
                  }
               },
               "type" : "cfg-pgbackrest",
               "value" : {
                  "config" : [
                     "[demo]",
                     "db-path=/var/lib/postgresql/9.4/demo",
                     "",
                     "[global]",
                     "repo-cipher-pass=zWaf6XtpjIVZC5444yXB+cgFDFl7MxGlgkZSaoPvTGirhPygu4jOKOXf9LO4vjfO",
                     "repo-cipher-type=aes-256-cbc",
                     "repo-path=/var/lib/pgbackrest",
                     "retention-full=2",
                     "start-fast=y",
                     "stop-auto=y"
                  ]
               }
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres pgbackrest --stanza=demo --type=incr \\",
                     "    --log-level-console=info backup"
                  ],
                  "highlight" : {
                     "filter" : true,
                     "filter-context" : 2,
                     "list" : [
                        "cluster is already in backup mode|backup begins after the requested immediate checkpoint completes"
                     ]
                  },
                  "host" : "db-primary",
                  "output" : true
               },
               "type" : "exe",
               "value" : {
                  "output" : [
                     "P00   INFO: backup command begin 1.29: --db1-path=/var/lib/postgresql/9.4/demo --log-level-console=info --log-level-stderr=off --no-log-timestamp --repo-cipher-pass=<redacted> --repo-cipher-type=aes-256-cbc --repo-path=/var/lib/pgbackrest --retention-full=2 --stanza=demo --start-fast --stop-auto --type=incr",
                     "P00   INFO: last backup label = 20180705-221523F_20180705-221600I, version = 1.29",
                     "P00   WARN: the cluster is already in backup mode but no pgBackRest backup process is running. pg_stop_backup() will be called so a new backup can be started.",
                     "P00   INFO: execute exclusive pg_stop_backup() and wait for all WAL segments to archive",
                     "P00   INFO: execute exclusive pg_start_backup() with label \"pgBackRest backup started at 2018-07-05 22:16:08\": backup begins after the requested immediate checkpoint completes",
                     "P00   INFO: backup start archive = 000000020000000000000008, lsn = 0/8000028",
                     "P01   INFO: backup file /var/lib/postgresql/9.4/demo/global/pg_control (8KB, 97%) checksum 390ede54c87382c2138b9af6bdaa0d1a00aa009a",
                     "       [filtered 8 lines of output]"
                  ]
               }
            },
            {
               "key" : {
                  "file" : "/etc/pgbackrest.conf",
                  "host" : "db-primary",
                  "option" : {
                     "global" : {
                        "retention-full" : {
                           "value" : "2"
                        }
                     }
                  }
               },
               "type" : "cfg-pgbackrest",
               "value" : {
                  "config" : [
                     "[demo]",
                     "db-path=/var/lib/postgresql/9.4/demo",
                     "",
                     "[global]",
                     "repo-cipher-pass=zWaf6XtpjIVZC5444yXB+cgFDFl7MxGlgkZSaoPvTGirhPygu4jOKOXf9LO4vjfO",
                     "repo-cipher-type=aes-256-cbc",
                     "repo-path=/var/lib/pgbackrest",
                     "retention-full=2",
                     "start-fast=y",
                     "stop-auto=y"
                  ]
               }
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres pgbackrest --stanza=demo --type=full \\",
                     "    --log-level-console=detail backup"
                  ],
                  "highlight" : {
                     "filter" : true,
                     "filter-context" : 2,
                     "list" : [
                        "archive retention on backup 20180705-221523F|remove archive"
                     ]
                  },
                  "host" : "db-primary",
                  "output" : true
               },
               "type" : "exe",
               "value" : {
                  "output" : [
                     "       [filtered 763 lines of output]",
                     "P00   INFO: backup command end: completed successfully",
                     "P00   INFO: expire command begin 1.29: --log-level-console=detail --log-level-stderr=off --no-log-timestamp --repo-cipher-pass=<redacted> --repo-cipher-type=aes-256-cbc --repo-path=/var/lib/pgbackrest --retention-archive=2 --retention-full=2 --stanza=demo",
                     "P00 DETAIL: archive retention on backup 20180705-221523F, archiveId = 9.4-1, start = 000000010000000000000002",
                     "P00 DETAIL: no archive to remove, archiveId = 9.4-1",
                     "P00   INFO: expire command end: completed successfully"
                  ]
               }
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres ls -1 /var/lib/pgbackrest/backup/demo | tail -5 | head -1"
                  ],
                  "host" : "db-primary",
                  "output" : true
               },
               "type" : "exe",
               "value" : {
                  "output" : [
                     "20180705-221614F"
                  ]
               }
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres pgbackrest --stanza=demo --type=full \\",
                     "    --log-level-console=info backup"
                  ],
                  "highlight" : {
                     "filter" : true,
                     "filter-context" : 2,
                     "list" : [
                        "expire full backup set\\: 20180705-221523F|archive retention on backup 20180705-221614F|remove archive"
                     ]
                  },
                  "host" : "db-primary",
                  "output" : true
               },
               "type" : "exe",
               "value" : {
                  "output" : [
                     "       [filtered 763 lines of output]",
                     "P00   INFO: backup command end: completed successfully",
                     "P00   INFO: expire command begin 1.29: --log-level-console=info --log-level-stderr=off --no-log-timestamp --repo-cipher-pass=<redacted> --repo-cipher-type=aes-256-cbc --repo-path=/var/lib/pgbackrest --retention-archive=2 --retention-full=2 --stanza=demo",
                     "P00   INFO: expire full backup set: 20180705-221523F, 20180705-221523F_20180705-221534D, 20180705-221523F_20180705-221556I, 20180705-221523F_20180705-221600I, 20180705-221523F_20180705-221608I",
                     "P00   INFO: remove expired backup 20180705-221523F_20180705-221608I",
                     "P00   INFO: remove expired backup 20180705-221523F_20180705-221600I",
                     "       [filtered 3 lines of output]"
                  ]
               }
            },
            {
               "key" : {
                  "file" : "/etc/pgbackrest.conf",
                  "host" : "db-primary",
                  "option" : {
                     "global" : {
                        "retention-diff" : {
                           "value" : "1"
                        }
                     }
                  }
               },
               "type" : "cfg-pgbackrest",
               "value" : {
                  "config" : [
                     "[demo]",
                     "db-path=/var/lib/postgresql/9.4/demo",
                     "",
                     "[global]",
                     "repo-cipher-pass=zWaf6XtpjIVZC5444yXB+cgFDFl7MxGlgkZSaoPvTGirhPygu4jOKOXf9LO4vjfO",
                     "repo-cipher-type=aes-256-cbc",
                     "repo-path=/var/lib/pgbackrest",
                     "retention-diff=1",
                     "retention-full=2",
                     "start-fast=y",
                     "stop-auto=y"
                  ]
               }
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres pgbackrest --stanza=demo --type=diff backup"
                  ],
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres ls -1 /var/lib/pgbackrest/backup/demo | tail -5 | head -1"
                  ],
                  "host" : "db-primary",
                  "output" : true
               },
               "type" : "exe",
               "value" : {
                  "output" : [
                     "20180705-221626F_20180705-221638D"
                  ]
               }
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres pgbackrest --stanza=demo --type=incr backup"
                  ],
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres pgbackrest --stanza=demo --type=diff \\",
                     "    --log-level-console=info backup"
                  ],
                  "highlight" : {
                     "filter" : true,
                     "filter-context" : 2,
                     "list" : [
                        "expire diff backup set: 20180705-221626F_20180705-221638D"
                     ]
                  },
                  "host" : "db-primary",
                  "output" : true
               },
               "type" : "exe",
               "value" : {
                  "output" : [
                     "       [filtered 10 lines of output]",
                     "P00   INFO: backup command end: completed successfully",
                     "P00   INFO: expire command begin 1.29: --log-level-console=info --log-level-stderr=off --no-log-timestamp --repo-cipher-pass=<redacted> --repo-cipher-type=aes-256-cbc --repo-path=/var/lib/pgbackrest --retention-archive=2 --retention-diff=1 --retention-full=2 --stanza=demo",
                     "P00   INFO: expire diff backup set: 20180705-221626F_20180705-221638D, 20180705-221626F_20180705-221643I",
                     "P00   INFO: remove expired backup 20180705-221626F_20180705-221643I",
                     "P00   INFO: remove expired backup 20180705-221626F_20180705-221638D"
                  ]
               }
            },
            {
               "key" : {
                  "file" : "/etc/pgbackrest.conf",
                  "host" : "db-primary",
                  "option" : {
                     "global" : {
                        "retention-diff" : {
                           "value" : "2"
                        }
                     }
                  }
               },
               "type" : "cfg-pgbackrest",
               "value" : {
                  "config" : [
                     "[demo]",
                     "db-path=/var/lib/postgresql/9.4/demo",
                     "",
                     "[global]",
                     "repo-cipher-pass=zWaf6XtpjIVZC5444yXB+cgFDFl7MxGlgkZSaoPvTGirhPygu4jOKOXf9LO4vjfO",
                     "repo-cipher-type=aes-256-cbc",
                     "repo-path=/var/lib/pgbackrest",
                     "retention-diff=2",
                     "retention-full=2",
                     "start-fast=y",
                     "stop-auto=y"
                  ]
               }
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres ls -1 /var/lib/pgbackrest/backup/demo | tail -5 | head -1"
                  ],
                  "host" : "db-primary",
                  "output" : true
               },
               "type" : "exe",
               "value" : {
                  "output" : [
                     "20180705-221626F_20180705-221646D"
                  ]
               }
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres psql -c \" \\",
                     "    select pg_create_restore_point('generate WAL'); select pg_switch_xlog(); \\",
                     "    select pg_create_restore_point('generate WAL'); select pg_switch_xlog();\""
                  ],
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres pgbackrest --stanza=demo --type=diff \\",
                     "    --log-level-console=info backup"
                  ],
                  "highlight" : {
                     "filter" : true,
                     "filter-context" : 2,
                     "list" : [
                        "new backup label"
                     ]
                  },
                  "host" : "db-primary",
                  "output" : true
               },
               "type" : "exe",
               "value" : {
                  "output" : [
                     "       [filtered 7 lines of output]",
                     "P00   INFO: execute exclusive pg_stop_backup() and wait for all WAL segments to archive",
                     "P00   INFO: backup stop archive = 000000020000000000000011, lsn = 0/110000F0",
                     "P00   INFO: new backup label = 20180705-221626F_20180705-221652D",
                     "P00   INFO: backup command end: completed successfully",
                     "P00   INFO: expire command begin 1.29: --log-level-console=info --log-level-stderr=off --no-log-timestamp --repo-cipher-pass=<redacted> --repo-cipher-type=aes-256-cbc --repo-path=/var/lib/pgbackrest --retention-archive=2 --retention-diff=2 --retention-full=2 --stanza=demo"
                  ]
               }
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres ls -1 /var/lib/pgbackrest/backup/demo | tail -5 | head -1"
                  ],
                  "host" : "db-primary",
                  "output" : true
               },
               "type" : "exe",
               "value" : {
                  "output" : [
                     "20180705-221626F_20180705-221652D"
                  ]
               }
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres pgbackrest --stanza=demo --log-level-console=detail \\",
                     "    --retention-archive-type=diff --retention-archive=1 expire"
                  ],
                  "highlight" : {
                     "filter" : true,
                     "filter-context" : 2,
                     "list" : [
                        "archive retention on backup 20180705-221626F_20180705-221646D|remove archive"
                     ]
                  },
                  "host" : "db-primary",
                  "output" : true
               },
               "type" : "exe",
               "value" : {
                  "output" : [
                     "P00   INFO: expire command begin 1.29: --log-level-console=detail --log-level-stderr=off --no-log-timestamp --repo-cipher-pass=<redacted> --repo-cipher-type=aes-256-cbc --repo-path=/var/lib/pgbackrest --retention-archive=1 --retention-archive-type=diff --retention-diff=2 --retention-full=2 --stanza=demo",
                     "P00 DETAIL: archive retention on backup 20180705-221614F, archiveId = 9.4-1, start = 000000020000000000000009, stop = 000000020000000000000009",
                     "P00 DETAIL: archive retention on backup 20180705-221626F, archiveId = 9.4-1, start = 00000002000000000000000A, stop = 00000002000000000000000A",
                     "P00 DETAIL: archive retention on backup 20180705-221626F_20180705-221646D, archiveId = 9.4-1, start = 00000002000000000000000D, stop = 00000002000000000000000D",
                     "P00 DETAIL: archive retention on backup 20180705-221626F_20180705-221652D, archiveId = 9.4-1, start = 000000020000000000000011",
                     "P00 DETAIL: remove archive: archiveId = 9.4-1, start = 00000002000000000000000B, stop = 00000002000000000000000C",
                     "P00 DETAIL: remove archive: archiveId = 9.4-1, start = 00000002000000000000000E, stop = 000000020000000000000010",
                     "P00   INFO: expire command end: completed successfully"
                  ]
               }
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo pg_ctlcluster 9.4 demo stop"
                  ],
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres pgbackrest --stanza=demo --delta \\",
                     "    --log-level-console=detail restore"
                  ],
                  "highlight" : {
                     "filter" : true,
                     "filter-context" : 2,
                     "list" : [
                        "demo\\/PG_VERSION - exists and matches backup|check\\/clean db path|restore global\\/pg_control"
                     ]
                  },
                  "host" : "db-primary",
                  "output" : true
               },
               "type" : "exe",
               "value" : {
                  "output" : [
                     "       [filtered 692 lines of output]",
                     "P01 DETAIL: restore file /var/lib/postgresql/9.4/demo/base/12134/PG_VERSION - exists and matches backup (4B, 99%) checksum 8dbabb96e032b8d9f1993c0e4b9141e71ade01a1",
                     "P01 DETAIL: restore file /var/lib/postgresql/9.4/demo/base/1/PG_VERSION - exists and matches backup (4B, 99%) checksum 8dbabb96e032b8d9f1993c0e4b9141e71ade01a1",
                     "P01 DETAIL: restore file /var/lib/postgresql/9.4/demo/PG_VERSION - exists and matches backup (4B, 100%) checksum 8dbabb96e032b8d9f1993c0e4b9141e71ade01a1",
                     "P01 DETAIL: restore file /var/lib/postgresql/9.4/demo/global/12086 - exists and is zero size (0B, 100%)",
                     "P01 DETAIL: restore file /var/lib/postgresql/9.4/demo/global/12038 - exists and is zero size (0B, 100%)",
                     "       [filtered 83 lines of output]",
                     "P01 DETAIL: restore file /var/lib/postgresql/9.4/demo/base/1/11885 - exists and is zero size (0B, 100%)",
                     "P00   INFO: write /var/lib/postgresql/9.4/demo/recovery.conf",
                     "P00   INFO: restore global/pg_control (performed last to ensure aborted restores cannot be started)",
                     "P00   INFO: restore command end: completed successfully"
                  ]
               }
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo pg_ctlcluster 9.4 demo start"
                  ],
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres sleep 2"
                  ],
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres psql -c \"create database test1;\""
                  ],
                  "host" : "db-primary",
                  "output" : true
               },
               "type" : "exe",
               "value" : {
                  "output" : [
                     "CREATE DATABASE"
                  ]
               }
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres psql -c \"create database test2;\""
                  ],
                  "host" : "db-primary",
                  "output" : true
               },
               "type" : "exe",
               "value" : {
                  "output" : [
                     "CREATE DATABASE"
                  ]
               }
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres pgbackrest --stanza=demo --type=incr backup"
                  ],
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres psql -c \"create table test1_table (id int); \\",
                     "    insert into test1_table (id) values (1);\" test1"
                  ],
                  "host" : "db-primary",
                  "output" : true
               },
               "type" : "exe",
               "value" : {
                  "output" : [
                     "INSERT 0 1"
                  ]
               }
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres psql -c \"create table test2_table (id int); \\",
                     "    insert into test2_table (id) values (2);\" test2"
                  ],
                  "host" : "db-primary",
                  "output" : true
               },
               "type" : "exe",
               "value" : {
                  "output" : [
                     "INSERT 0 1"
                  ]
               }
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres du -sh /var/lib/postgresql/9.4/demo/base/16384"
                  ],
                  "host" : "db-primary",
                  "output" : true
               },
               "type" : "exe",
               "value" : {
                  "output" : [
                     "6.4M\t/var/lib/postgresql/9.4/demo/base/16384"
                  ]
               }
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo pg_ctlcluster 9.4 demo stop"
                  ],
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres pgbackrest --stanza=demo --delta \\",
                     "    --db-include=test2 restore"
                  ],
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo pg_ctlcluster 9.4 demo start"
                  ],
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres sleep 2"
                  ],
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres psql -c \"select * from test2_table;\" test2"
                  ],
                  "host" : "db-primary",
                  "output" : true
               },
               "type" : "exe",
               "value" : {
                  "output" : [
                     " id ",
                     "----",
                     "  2",
                     "(1 row)"
                  ]
               }
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres psql -c \"select * from test1_table;\" test1"
                  ],
                  "err-expect" : "2",
                  "highlight" : {
                     "filter" : false,
                     "filter-context" : 2,
                     "list" : [
                        "relation mapping file.*contains invalid data"
                     ]
                  },
                  "host" : "db-primary",
                  "output" : true
               },
               "type" : "exe",
               "value" : {
                  "output" : [
                     "psql: FATAL:  relation mapping file \"base/16384/pg_filenode.map\" contains invalid data"
                  ]
               }
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres du -sh /var/lib/postgresql/9.4/demo/base/16384"
                  ],
                  "host" : "db-primary",
                  "output" : true
               },
               "type" : "exe",
               "value" : {
                  "output" : [
                     "152K\t/var/lib/postgresql/9.4/demo/base/16384"
                  ]
               }
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres psql -c \"drop database test1;\""
                  ],
                  "host" : "db-primary",
                  "output" : true
               },
               "type" : "exe",
               "value" : {
                  "output" : [
                     "DROP DATABASE"
                  ]
               }
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres psql -c \"select oid, datname from pg_database order by oid;\""
                  ],
                  "highlight" : {
                     "filter" : false,
                     "filter-context" : 2,
                     "list" : [
                        "test2"
                     ]
                  },
                  "host" : "db-primary",
                  "output" : true
               },
               "type" : "exe",
               "value" : {
                  "output" : [
                     "  oid  |  datname  ",
                     "-------+-----------",
                     "     1 | template1",
                     " 12134 | template0",
                     " 12139 | postgres",
                     " 16385 | test2",
                     "(4 rows)"
                  ]
               }
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres pgbackrest --stanza=demo --type=diff backup"
                  ],
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres psql -c \"begin; \\",
                     "    create table important_table (message text); \\",
                     "    insert into important_table values ('Important Data'); \\",
                     "    commit; \\",
                     "    select * from important_table;\""
                  ],
                  "highlight" : {
                     "filter" : true,
                     "filter-context" : 2,
                     "list" : [
                        "Important Data"
                     ]
                  },
                  "host" : "db-primary",
                  "output" : true
               },
               "type" : "exe",
               "value" : {
                  "output" : [
                     "    message     ",
                     "----------------",
                     " Important Data",
                     "(1 row)"
                  ]
               }
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres psql -Atc \"select current_timestamp\""
                  ],
                  "host" : "db-primary",
                  "output" : true
               },
               "type" : "exe",
               "value" : {
                  "output" : [
                     "2018-07-05 22:17:32.812092+00"
                  ]
               }
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres psql -c \"begin; \\",
                     "    drop table important_table; \\",
                     "    commit; \\",
                     "    select * from important_table;\""
                  ],
                  "err-expect" : "1",
                  "highlight" : {
                     "filter" : true,
                     "filter-context" : 2,
                     "list" : [
                        "does not exist"
                     ]
                  },
                  "host" : "db-primary",
                  "output" : true
               },
               "type" : "exe",
               "value" : {
                  "output" : [
                     "ERROR:  relation \"important_table\" does not exist",
                     "LINE 1: ...le important_table;     commit;     select * from important_...",
                     "                                                             ^"
                  ]
               }
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo pg_ctlcluster 9.4 demo stop"
                  ],
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres pgbackrest --stanza=demo --delta \\",
                     "    --type=time \"--target=2018-07-05 22:17:32.812092+00\" restore"
                  ],
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo rm /var/log/postgresql/postgresql-9.4-demo.log"
                  ],
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres cat /var/lib/postgresql/9.4/demo/recovery.conf"
                  ],
                  "highlight" : {
                     "filter" : true,
                     "filter-context" : 2,
                     "list" : [
                        "recovery_target_time"
                     ]
                  },
                  "host" : "db-primary",
                  "output" : true
               },
               "type" : "exe",
               "value" : {
                  "output" : [
                     "restore_command = '/usr/bin/pgbackrest --stanza=demo archive-get %f \"%p\"'",
                     "recovery_target_time = '2018-07-05 22:17:32.812092+00'"
                  ]
               }
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo pg_ctlcluster 9.4 demo start"
                  ],
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres sleep 2"
                  ],
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres psql -c \"select * from important_table\""
                  ],
                  "highlight" : {
                     "filter" : true,
                     "filter-context" : 2,
                     "list" : [
                        "Important Data"
                     ]
                  },
                  "host" : "db-primary",
                  "output" : true
               },
               "type" : "exe",
               "value" : {
                  "output" : [
                     "    message     ",
                     "----------------",
                     " Important Data",
                     "(1 row)"
                  ]
               }
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres cat /var/log/postgresql/postgresql-9.4-demo.log"
                  ],
                  "highlight" : {
                     "filter" : true,
                     "filter-context" : 2,
                     "list" : [
                        "recovery stopping before|last completed transaction|starting point-in-time recovery"
                     ]
                  },
                  "host" : "db-primary",
                  "output" : true
               },
               "type" : "exe",
               "value" : {
                  "output" : [
                     "LOG:  database system was interrupted; last known up at 2018-07-05 22:17:26 UTC",
                     "LOG:  starting point-in-time recovery to 2018-07-05 22:17:32.812092+00",
                     "LOG:  restored log file \"00000004.history\" from archive",
                     "LOG:  restored log file \"000000040000000000000016\" from archive",
                     "       [filtered 2 lines of output]",
                     "LOG:  incomplete startup packet",
                     "LOG:  restored log file \"000000040000000000000017\" from archive",
                     "LOG:  recovery stopping before commit of transaction 686, time 2018-07-05 22:17:33.066969+00",
                     "LOG:  redo done at 0/170157F0",
                     "LOG:  last completed transaction was at log time 2018-07-05 22:17:32.510815+00",
                     "LOG:  selected new timeline ID: 5",
                     "LOG:  restored log file \"00000004.history\" from archive",
                     "       [filtered 5 lines of output]"
                  ]
               }
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres psql -c \"begin; \\",
                     "    drop table important_table; \\",
                     "    commit; \\",
                     "    select * from important_table;\""
                  ],
                  "err-expect" : "1",
                  "highlight" : {
                     "filter" : true,
                     "filter-context" : 2,
                     "list" : [
                        "does not exist"
                     ]
                  },
                  "host" : "db-primary",
                  "output" : true
               },
               "type" : "exe",
               "value" : {
                  "output" : [
                     "ERROR:  relation \"important_table\" does not exist",
                     "LINE 1: ...le important_table;     commit;     select * from important_...",
                     "                                                             ^"
                  ]
               }
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres ls -1 /var/lib/pgbackrest/backup/demo | tail -5 | head -1"
                  ],
                  "host" : "db-primary",
                  "output" : true
               },
               "type" : "exe",
               "value" : {
                  "output" : [
                     "20180705-221626F_20180705-221725D"
                  ]
               }
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres pgbackrest --stanza=demo --type=incr backup"
                  ],
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo pg_ctlcluster 9.4 demo stop"
                  ],
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres pgbackrest --stanza=demo --delta \\",
                     "    --type=time \"--target=2018-07-05 22:17:32.812092+00\" restore"
                  ],
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo rm /var/log/postgresql/postgresql-9.4-demo.log"
                  ],
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo pg_ctlcluster 9.4 demo start"
                  ],
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres sleep 2"
                  ],
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres psql -c \"select * from important_table\""
                  ],
                  "err-expect" : "1",
                  "highlight" : {
                     "filter" : true,
                     "filter-context" : 2,
                     "list" : [
                        "does not exist"
                     ]
                  },
                  "host" : "db-primary",
                  "output" : true
               },
               "type" : "exe",
               "value" : {
                  "output" : [
                     "ERROR:  relation \"important_table\" does not exist",
                     "LINE 1: select * from important_table",
                     "                      ^"
                  ]
               }
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres cat /var/log/postgresql/postgresql-9.4-demo.log"
                  ],
                  "highlight" : {
                     "filter" : true,
                     "filter-context" : 2,
                     "list" : [
                        "starting point-in-time recovery|consistent recovery state reached"
                     ]
                  },
                  "host" : "db-primary",
                  "output" : true
               },
               "type" : "exe",
               "value" : {
                  "output" : [
                     "LOG:  database system was interrupted; last known up at 2018-07-05 22:17:45 UTC",
                     "LOG:  starting point-in-time recovery to 2018-07-05 22:17:32.812092+00",
                     "LOG:  restored log file \"00000005.history\" from archive",
                     "LOG:  restored log file \"000000050000000000000018\" from archive",
                     "LOG:  redo starts at 0/18000028",
                     "LOG:  consistent recovery state reached at 0/180000F0",
                     "LOG:  incomplete startup packet",
                     "FATAL:  the database system is starting up",
                     "       [filtered 11 lines of output]"
                  ]
               }
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres pgbackrest info"
                  ],
                  "highlight" : {
                     "filter" : false,
                     "filter-context" : 2,
                     "list" : [
                        "20180705-221626F_20180705-221725D"
                     ]
                  },
                  "host" : "db-primary",
                  "output" : true
               },
               "type" : "exe",
               "value" : {
                  "output" : [
                     "stanza: demo",
                     "    status: ok",
                     "",
                     "    db (current)",
                     "        wal archive min/max (9.4-1): 000000020000000000000009 / 000000050000000000000018",
                     "",
                     "        full backup: 20180705-221614F",
                     "            timestamp start/stop: 2018-07-05 22:16:14 / 2018-07-05 22:16:26",
                     "            wal start/stop: 000000020000000000000009 / 000000020000000000000009",
                     "            database size: 19.2MB, backup size: 19.2MB",
                     "            repository size: 2.2MB, repository backup size: 2.2MB",
                     "",
                     "        full backup: 20180705-221626F",
                     "            timestamp start/stop: 2018-07-05 22:16:26 / 2018-07-05 22:16:37",
                     "            wal start/stop: 00000002000000000000000A / 00000002000000000000000A",
                     "            database size: 19.2MB, backup size: 19.2MB",
                     "            repository size: 2.2MB, repository backup size: 2.2MB",
                     "",
                     "        diff backup: 20180705-221626F_20180705-221652D",
                     "            timestamp start/stop: 2018-07-05 22:16:52 / 2018-07-05 22:16:55",
                     "            wal start/stop: 000000020000000000000011 / 000000020000000000000011",
                     "            database size: 19.2MB, backup size: 8.2KB",
                     "            repository size: 2.2MB, repository backup size: 400B",
                     "            backup reference list: 20180705-221626F",
                     "",
                     "        incr backup: 20180705-221626F_20180705-221705I",
                     "            timestamp start/stop: 2018-07-05 22:17:05 / 2018-07-05 22:17:14",
                     "            wal start/stop: 000000030000000000000013 / 000000030000000000000013",
                     "            database size: 31.7MB, backup size: 12.5MB",
                     "            repository size: 3.7MB, repository backup size: 1.5MB",
                     "            backup reference list: 20180705-221626F",
                     "",
                     "        diff backup: 20180705-221626F_20180705-221725D",
                     "            timestamp start/stop: 2018-07-05 22:17:25 / 2018-07-05 22:17:32",
                     "            wal start/stop: 000000040000000000000016 / 000000040000000000000016",
                     "            database size: 25.5MB, backup size: 6.3MB",
                     "            repository size: 3MB, repository backup size: 771.6KB",
                     "            backup reference list: 20180705-221626F",
                     "",
                     "        incr backup: 20180705-221626F_20180705-221743I",
                     "            timestamp start/stop: 2018-07-05 22:17:43 / 2018-07-05 22:17:47",
                     "            wal start/stop: 000000050000000000000018 / 000000050000000000000018",
                     "            database size: 25.5MB, backup size: 1.7MB",
                     "            repository size: 3MB, repository backup size: 200.8KB",
                     "            backup reference list: 20180705-221626F, 20180705-221626F_20180705-221725D"
                  ]
               }
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo pg_ctlcluster 9.4 demo stop"
                  ],
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres pgbackrest --stanza=demo --delta \\",
                     "    --type=time \"--target=2018-07-05 22:17:32.812092+00\" \\",
                     "    --set=20180705-221626F_20180705-221725D restore"
                  ],
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo rm /var/log/postgresql/postgresql-9.4-demo.log"
                  ],
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo pg_ctlcluster 9.4 demo start"
                  ],
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres sleep 2"
                  ],
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres psql -c \"select * from important_table\""
                  ],
                  "highlight" : {
                     "filter" : true,
                     "filter-context" : 2,
                     "list" : [
                        "Important Data"
                     ]
                  },
                  "host" : "db-primary",
                  "output" : true
               },
               "type" : "exe",
               "value" : {
                  "output" : [
                     "    message     ",
                     "----------------",
                     " Important Data",
                     "(1 row)"
                  ]
               }
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres cat /var/log/postgresql/postgresql-9.4-demo.log"
                  ],
                  "highlight" : {
                     "filter" : true,
                     "filter-context" : 2,
                     "list" : [
                        "recovery stopping before|last completed transaction|starting point-in-time recovery"
                     ]
                  },
                  "host" : "db-primary",
                  "output" : true
               },
               "type" : "exe",
               "value" : {
                  "output" : [
                     "LOG:  database system was interrupted; last known up at 2018-07-05 22:17:26 UTC",
                     "LOG:  starting point-in-time recovery to 2018-07-05 22:17:32.812092+00",
                     "LOG:  restored log file \"00000004.history\" from archive",
                     "LOG:  restored log file \"000000040000000000000016\" from archive",
                     "       [filtered 2 lines of output]",
                     "LOG:  incomplete startup packet",
                     "LOG:  restored log file \"000000040000000000000017\" from archive",
                     "LOG:  recovery stopping before commit of transaction 686, time 2018-07-05 22:17:33.066969+00",
                     "LOG:  redo done at 0/170157F0",
                     "LOG:  last completed transaction was at log time 2018-07-05 22:17:32.510815+00",
                     "LOG:  restored log file \"00000005.history\" from archive",
                     "LOG:  restored log file \"00000006.history\" from archive",
                     "       [filtered 7 lines of output]"
                  ]
               }
            },
            {
               "key" : {
                  "file" : "/etc/pgbackrest.conf",
                  "host" : "db-primary",
                  "option" : {
                     "global" : {
                        "repo-cipher-pass" : {},
                        "repo-cipher-type" : {
                           "value" : "none"
                        }
                     }
                  }
               },
               "type" : "cfg-pgbackrest",
               "value" : {
                  "config" : [
                     "[demo]",
                     "db-path=/var/lib/postgresql/9.4/demo",
                     "",
                     "[global]",
                     "repo-cipher-type=none",
                     "repo-path=/var/lib/pgbackrest",
                     "retention-diff=2",
                     "retention-full=2",
                     "start-fast=y",
                     "stop-auto=y"
                  ]
               }
            },
            {
               "key" : {
                  "file" : "/etc/pgbackrest.conf",
                  "host" : "db-primary",
                  "option" : {
                     "global" : {
                        "process-max" : {
                           "value" : "4"
                        },
                        "repo-path" : {
                           "value" : "/"
                        },
                        "repo-s3-bucket" : {
                           "value" : "demo-bucket"
                        },
                        "repo-s3-endpoint" : {
                           "value" : "s3.amazonaws.com"
                        },
                        "repo-s3-key" : {
                           "value" : "accessKey1"
                        },
                        "repo-s3-key-secret" : {
                           "value" : "verySecretKey1"
                        },
                        "repo-s3-region" : {
                           "value" : "us-east-1"
                        },
                        "repo-s3-verify-ssl" : {
                           "value" : "n"
                        },
                        "repo-type" : {
                           "value" : "s3"
                        }
                     }
                  }
               },
               "type" : "cfg-pgbackrest",
               "value" : {
                  "config" : [
                     "[demo]",
                     "db-path=/var/lib/postgresql/9.4/demo",
                     "",
                     "[global]",
                     "process-max=4",
                     "repo-cipher-type=none",
                     "repo-path=/",
                     "repo-s3-bucket=demo-bucket",
                     "repo-s3-endpoint=s3.amazonaws.com",
                     "repo-s3-key=accessKey1",
                     "repo-s3-key-secret=verySecretKey1",
                     "repo-s3-region=us-east-1",
                     "repo-type=s3",
                     "retention-diff=2",
                     "retention-full=2",
                     "start-fast=y",
                     "stop-auto=y"
                  ]
               }
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo echo \"172.17.0.2 demo-bucket.s3.amazonaws.com s3.amazonaws.com\" | \\",
                     "    sudo tee -a /etc/hosts"
                  ],
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "aws s3 --no-verify-ssl mb s3://demo-bucket 2>&1"
                  ],
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres pgbackrest --stanza=demo --log-level-console=info stanza-create"
                  ],
                  "highlight" : {
                     "filter" : true,
                     "filter-context" : 2,
                     "list" : [
                        "completed successfully"
                     ]
                  },
                  "host" : "db-primary",
                  "output" : true
               },
               "type" : "exe",
               "value" : {
                  "output" : [
                     "P00   INFO: stanza-create command begin 1.29: --db1-path=/var/lib/postgresql/9.4/demo --log-level-console=info --log-level-stderr=off --no-log-timestamp --repo-cipher-type=none --repo-path=/ --repo-s3-bucket=demo-bucket --repo-s3-endpoint=s3.amazonaws.com --repo-s3-key=<redacted> --repo-s3-key-secret=<redacted> --repo-s3-region=us-east-1 --no-repo-s3-verify-ssl --repo-type=s3 --stanza=demo",
                     "P00   INFO: stanza-create command end: completed successfully"
                  ]
               }
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres pgbackrest --stanza=demo \\",
                     "    --log-level-console=info backup"
                  ],
                  "highlight" : {
                     "filter" : true,
                     "filter-context" : 2,
                     "list" : [
                        "no prior backup exists|full backup size"
                     ]
                  },
                  "host" : "db-primary",
                  "output" : true
               },
               "type" : "exe",
               "value" : {
                  "output" : [
                     "P00   INFO: backup command begin 1.29: --db1-path=/var/lib/postgresql/9.4/demo --log-level-console=info --log-level-stderr=off --no-log-timestamp --process-max=4 --repo-cipher-type=none --repo-path=/ --repo-s3-bucket=demo-bucket --repo-s3-endpoint=s3.amazonaws.com --repo-s3-key=<redacted> --repo-s3-key-secret=<redacted> --repo-s3-region=us-east-1 --no-repo-s3-verify-ssl --repo-type=s3 --retention-diff=2 --retention-full=2 --stanza=demo --start-fast --stop-auto",
                     "P00   WARN: no prior backup exists, incr backup has been changed to full",
                     "P00   INFO: execute exclusive pg_start_backup() with label \"pgBackRest backup started at 2018-07-05 22:18:11\": backup begins after the requested immediate checkpoint completes",
                     "P00   INFO: backup start archive = 000000070000000000000018, lsn = 0/18000028",
                     "       [filtered 995 lines of output]",
                     "P02   INFO: backup file /var/lib/postgresql/9.4/demo/base/1/11895 (0B, 100%)",
                     "P01   INFO: backup file /var/lib/postgresql/9.4/demo/base/1/11885 (0B, 100%)",
                     "P00   INFO: full backup size = 25.5MB",
                     "P00   INFO: execute exclusive pg_stop_backup() and wait for all WAL segments to archive",
                     "P00   INFO: backup stop archive = 000000070000000000000018, lsn = 0/18000128",
                     "       [filtered 4 lines of output]"
                  ]
               }
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo pg_ctlcluster 9.4 demo stop"
                  ],
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres pgbackrest --stanza=demo --log-level-console=info stop"
                  ],
                  "highlight" : {
                     "filter" : true,
                     "filter-context" : 2,
                     "list" : [
                        "completed successfully"
                     ]
                  },
                  "host" : "db-primary",
                  "output" : true
               },
               "type" : "exe",
               "value" : {
                  "output" : [
                     "P00   INFO: stop command begin 1.29: --log-level-console=info --log-level-stderr=off --no-log-timestamp --repo-cipher-type=none --repo-path=/ --repo-s3-bucket=demo-bucket --repo-s3-endpoint=s3.amazonaws.com --repo-s3-key=<redacted> --repo-s3-key-secret=<redacted> --repo-s3-region=us-east-1 --no-repo-s3-verify-ssl --repo-type=s3 --stanza=demo",
                     "P00   INFO: stop command end: completed successfully"
                  ]
               }
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres pgbackrest --stanza=demo --log-level-console=info stanza-delete"
                  ],
                  "highlight" : {
                     "filter" : true,
                     "filter-context" : 2,
                     "list" : [
                        "completed successfully"
                     ]
                  },
                  "host" : "db-primary",
                  "output" : true
               },
               "type" : "exe",
               "value" : {
                  "output" : [
                     "P00   INFO: stanza-delete command begin 1.29: --db1-path=/var/lib/postgresql/9.4/demo --log-level-console=info --log-level-stderr=off --no-log-timestamp --repo-cipher-type=none --repo-path=/ --repo-s3-bucket=demo-bucket --repo-s3-endpoint=s3.amazonaws.com --repo-s3-key=<redacted> --repo-s3-key-secret=<redacted> --repo-s3-region=us-east-1 --no-repo-s3-verify-ssl --repo-type=s3 --stanza=demo",
                     "P00   INFO: stanza-delete command end: completed successfully"
                  ]
               }
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo pg_ctlcluster 9.4 demo start"
                  ],
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "image" : "pgbackrest/test:u16-base",
                  "name" : "backup",
                  "os" : "u16"
               },
               "type" : "host",
               "value" : {
                  "ip" : "172.17.0.4"
               }
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo adduser --disabled-password --gecos \"\" backrest"
                  ],
                  "host" : "backup",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo apt-get install libdbd-pg-perl libio-socket-ssl-perl libxml-libxml-perl"
                  ],
                  "cmd-extra" : "-y 2>&1",
                  "host" : "backup",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo mkdir /root/pgbackrest-release-1.29"
                  ],
                  "host" : "backup",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo cp -r /backrest/bin /root/pgbackrest-release-1.29"
                  ],
                  "host" : "backup",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo cp -r /backrest/build /root/pgbackrest-release-1.29"
                  ],
                  "host" : "backup",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo cp -r /backrest/lib /root/pgbackrest-release-1.29"
                  ],
                  "host" : "backup",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo cp -r /backrest/libc /root/pgbackrest-release-1.29"
                  ],
                  "host" : "backup",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo cp -r /backrest/src /root/pgbackrest-release-1.29"
                  ],
                  "host" : "backup",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo cp -r /root/pgbackrest-release-1.29/lib/pgBackRest \\",
                     "    /usr/share/perl5"
                  ],
                  "host" : "backup",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo find /usr/share/perl5/pgBackRest -type f -exec chmod 644 {} +"
                  ],
                  "host" : "backup",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo find /usr/share/perl5/pgBackRest -type d -exec chmod 755 {} +"
                  ],
                  "host" : "backup",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo cp /root/pgbackrest-release-1.29/bin/pgbackrest /usr/bin/pgbackrest"
                  ],
                  "host" : "backup",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo chmod 755 /usr/bin/pgbackrest"
                  ],
                  "host" : "backup",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo mkdir -m 770 /var/log/pgbackrest"
                  ],
                  "host" : "backup",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo chown backrest:backrest /var/log/pgbackrest"
                  ],
                  "host" : "backup",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo touch /etc/pgbackrest.conf"
                  ],
                  "host" : "backup",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo chmod 640 /etc/pgbackrest.conf"
                  ],
                  "host" : "backup",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo chown backrest:backrest /etc/pgbackrest.conf"
                  ],
                  "host" : "backup",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo sh -c 'cd /root/pgbackrest-release-1.29/libc && \\",
                     "    perl Makefile.PL INSTALLMAN1DIR=none INSTALLMAN3DIR=none'"
                  ],
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo make -C /root/pgbackrest-release-1.29/libc test"
                  ],
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo make -C /root/pgbackrest-release-1.29/libc install"
                  ],
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo mkdir /var/lib/pgbackrest"
                  ],
                  "host" : "backup",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo chmod 750 /var/lib/pgbackrest"
                  ],
                  "host" : "backup",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo chown backrest:backrest /var/lib/pgbackrest"
                  ],
                  "host" : "backup",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u backrest mkdir -m 750 /home/backrest/.ssh"
                  ],
                  "host" : "backup",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u backrest ssh-keygen -f /home/backrest/.ssh/id_rsa -t rsa -b 4096 -N \"\""
                  ],
                  "host" : "backup",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres mkdir -m 750 -p /home/postgres/.ssh"
                  ],
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres ssh-keygen -f /home/postgres/.ssh/id_rsa -t rsa -b 4096 -N \"\""
                  ],
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo ssh root@db-primary cat /home/postgres/.ssh/id_rsa.pub | \\",
                     "    sudo -u backrest tee -a /home/backrest/.ssh/authorized_keys"
                  ],
                  "host" : "backup",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo ssh root@backup cat /home/backrest/.ssh/id_rsa.pub | \\",
                     "    sudo -u postgres tee -a /home/postgres/.ssh/authorized_keys"
                  ],
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u backrest ssh postgres@db-primary"
                  ],
                  "cmd-extra" : "-o StrictHostKeyChecking=no ls",
                  "host" : "backup",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres ssh backrest@backup"
                  ],
                  "cmd-extra" : "-o StrictHostKeyChecking=no ls",
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "file" : "/etc/pgbackrest.conf",
                  "host" : "backup",
                  "option" : {
                     "global" : {
                        "repo-path" : {
                           "value" : "/var/lib/pgbackrest"
                        }
                     }
                  }
               },
               "type" : "cfg-pgbackrest",
               "value" : {
                  "config" : [
                     "[global]",
                     "repo-path=/var/lib/pgbackrest"
                  ]
               }
            },
            {
               "key" : {
                  "file" : "/etc/pgbackrest.conf",
                  "host" : "backup",
                  "option" : {
                     "demo" : {
                        "db1-host" : {
                           "value" : "db-primary"
                        },
                        "db1-path" : {
                           "value" : "/var/lib/postgresql/9.4/demo"
                        },
                        "db1-user" : {
                           "value" : "postgres"
                        }
                     },
                     "global" : {
                        "log-level-stderr" : {
                           "value" : "off"
                        },
                        "log-timestamp" : {
                           "value" : "n"
                        },
                        "retention-full" : {
                           "value" : "2"
                        },
                        "start-fast" : {
                           "value" : "y"
                        }
                     }
                  }
               },
               "type" : "cfg-pgbackrest",
               "value" : {
                  "config" : [
                     "[demo]",
                     "db1-host=db-primary",
                     "db1-path=/var/lib/postgresql/9.4/demo",
                     "db1-user=postgres",
                     "",
                     "[global]",
                     "repo-path=/var/lib/pgbackrest",
                     "retention-full=2",
                     "start-fast=y"
                  ]
               }
            },
            {
               "key" : {
                  "file" : "/etc/pgbackrest.conf",
                  "host" : "db-primary",
                  "option" : {
                     "demo" : {
                        "db-path" : {
                           "value" : "/var/lib/postgresql/9.4/demo"
                        }
                     },
                     "global" : {
                        "backup-host" : {
                           "value" : "backup"
                        },
                        "backup-user" : {
                           "value" : "backrest"
                        },
                        "log-level-file" : {
                           "value" : "detail"
                        },
                        "log-level-stderr" : {
                           "value" : "off"
                        },
                        "log-timestamp" : {
                           "value" : "n"
                        }
                     }
                  },
                  "reset" : true
               },
               "type" : "cfg-pgbackrest",
               "value" : {
                  "config" : [
                     "[demo]",
                     "db-path=/var/lib/postgresql/9.4/demo",
                     "",
                     "[global]",
                     "backup-host=backup",
                     "backup-user=backrest",
                     "log-level-file=detail"
                  ]
               }
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u backrest pgbackrest --stanza=demo stanza-create"
                  ],
                  "host" : "backup",
                  "output" : true
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres pgbackrest --stanza=demo check"
                  ],
                  "host" : "db-primary",
                  "output" : true
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u backrest pgbackrest --stanza=demo check"
                  ],
                  "host" : "backup",
                  "output" : true
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u backrest pgbackrest --stanza=demo backup"
                  ],
                  "host" : "backup",
                  "output" : true
               },
               "type" : "exe",
               "value" : {
                  "output" : [
                     "P00   WARN: no prior backup exists, incr backup has been changed to full"
                  ]
               }
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo pg_ctlcluster 9.4 demo stop"
                  ],
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres pgbackrest --stanza=demo --delta restore"
                  ],
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo pg_ctlcluster 9.4 demo start"
                  ],
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres sleep 2"
                  ],
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u backrest pgbackrest --stanza=demo backup"
                  ],
                  "host" : "backup",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo mkdir -m 750 /var/spool/pgbackrest"
                  ],
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo chown postgres:postgres /var/spool/pgbackrest"
                  ],
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "file" : "/etc/pgbackrest.conf",
                  "host" : "db-primary",
                  "option" : {
                     "global" : {
                        "archive-async" : {
                           "value" : "y"
                        },
                        "spool-path" : {
                           "value" : "/var/spool/pgbackrest"
                        }
                     },
                     "global:archive-push" : {
                        "process-max" : {
                           "value" : "2"
                        }
                     }
                  }
               },
               "type" : "cfg-pgbackrest",
               "value" : {
                  "config" : [
                     "[demo]",
                     "db-path=/var/lib/postgresql/9.4/demo",
                     "",
                     "[global]",
                     "archive-async=y",
                     "backup-host=backup",
                     "backup-user=backrest",
                     "log-level-file=detail",
                     "spool-path=/var/spool/pgbackrest",
                     "",
                     "[global:archive-push]",
                     "process-max=2"
                  ]
               }
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres rm -f /var/log/pgbackrest/demo-archive-async.log"
                  ],
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres psql -c \" \\",
                     "    select pg_create_restore_point('test async push'); select pg_switch_xlog(); \\",
                     "    select pg_create_restore_point('test async push'); select pg_switch_xlog(); \\",
                     "    select pg_create_restore_point('test async push'); select pg_switch_xlog(); \\",
                     "    select pg_create_restore_point('test async push'); select pg_switch_xlog(); \\",
                     "    select pg_create_restore_point('test async push'); select pg_switch_xlog();\""
                  ],
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres pgbackrest --stanza=demo --log-level-console=info check"
                  ],
                  "highlight" : {
                     "filter" : true,
                     "filter-context" : 2,
                     "list" : [
                        "WAL segment"
                     ]
                  },
                  "host" : "db-primary",
                  "output" : true
               },
               "type" : "exe",
               "value" : {
                  "output" : [
                     "P00   INFO: check command begin 1.29: --backup-host=backup --backup-user=backrest --db1-path=/var/lib/postgresql/9.4/demo --log-level-console=info --log-level-file=detail --log-level-stderr=off --no-log-timestamp --stanza=demo",
                     "P00   INFO: WAL segment 000000080000000000000024 successfully stored in the archive at '/var/lib/pgbackrest/archive/demo/9.4-1/0000000800000000/000000080000000000000024-5778280824c975d3bd7207cb890bdf519044c78f.gz'",
                     "P00   INFO: check command end: completed successfully"
                  ]
               }
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres cat /var/log/pgbackrest/demo-archive-async.log"
                  ],
                  "highlight" : {
                     "filter" : true,
                     "filter-context" : 2,
                     "list" : [
                        " WAL file\\(s\\) to archive|pushed WAL file 0000000"
                     ]
                  },
                  "host" : "db-primary",
                  "output" : true
               },
               "type" : "exe",
               "value" : {
                  "output" : [
                     "-------------------PROCESS START-------------------",
                     "P00   INFO: archive-push command begin 1.29: --archive-async --backup-host=backup --backup-user=backrest --db1-path=/var/lib/postgresql/9.4/demo --log-level-file=detail --log-level-stderr=off --no-log-timestamp --process-max=2 --spool-path=/var/spool/pgbackrest --stanza=demo",
                     "P00   INFO: push 2 WAL file(s) to archive: 00000008000000000000001F...000000080000000000000020",
                     "P01 DETAIL: pushed WAL file 00000008000000000000001F to archive",
                     "P02 DETAIL: pushed WAL file 000000080000000000000020 to archive",
                     "P00   INFO: archive-push command end: completed successfully",
                     "",
                     "-------------------PROCESS START-------------------",
                     "P00   INFO: archive-push command begin 1.29: --archive-async --backup-host=backup --backup-user=backrest --db1-path=/var/lib/postgresql/9.4/demo --log-level-file=detail --log-level-stderr=off --no-log-timestamp --process-max=2 --spool-path=/var/spool/pgbackrest --stanza=demo",
                     "P00   INFO: push 3 WAL file(s) to archive: 000000080000000000000021...000000080000000000000023",
                     "P01 DETAIL: pushed WAL file 000000080000000000000021 to archive",
                     "P02 DETAIL: pushed WAL file 000000080000000000000022 to archive",
                     "P01 DETAIL: pushed WAL file 000000080000000000000023 to archive",
                     "P00   INFO: archive-push command end: completed successfully",
                     "",
                     "-------------------PROCESS START-------------------",
                     "P00   INFO: archive-push command begin 1.29: --archive-async --backup-host=backup --backup-user=backrest --db1-path=/var/lib/postgresql/9.4/demo --log-level-file=detail --log-level-stderr=off --no-log-timestamp --process-max=2 --spool-path=/var/spool/pgbackrest --stanza=demo",
                     "P00   INFO: push 1 WAL file(s) to archive: 000000080000000000000024",
                     "P01 DETAIL: pushed WAL file 000000080000000000000024 to archive",
                     "P00   INFO: archive-push command end: completed successfully"
                  ]
               }
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u backrest pgbackrest --stanza=demo --type=full backup"
                  ],
                  "host" : "backup",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "file" : "/etc/pgbackrest.conf",
                  "host" : "backup",
                  "option" : {
                     "global" : {
                        "process-max" : {
                           "value" : "3"
                        }
                     }
                  }
               },
               "type" : "cfg-pgbackrest",
               "value" : {
                  "config" : [
                     "[demo]",
                     "db1-host=db-primary",
                     "db1-path=/var/lib/postgresql/9.4/demo",
                     "db1-user=postgres",
                     "",
                     "[global]",
                     "process-max=3",
                     "repo-path=/var/lib/pgbackrest",
                     "retention-full=2",
                     "start-fast=y"
                  ]
               }
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u backrest pgbackrest --stanza=demo --type=full backup"
                  ],
                  "host" : "backup",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u backrest pgbackrest info"
                  ],
                  "highlight" : {
                     "filter" : false,
                     "filter-context" : 2,
                     "list" : [
                        "timestamp start/stop"
                     ]
                  },
                  "host" : "backup",
                  "output" : true
               },
               "type" : "exe",
               "value" : {
                  "output" : [
                     "stanza: demo",
                     "    status: ok",
                     "",
                     "    db (current)",
                     "        wal archive min/max (9.4-1): 000000080000000000000026 / 000000080000000000000028",
                     "",
                     "        full backup: 20180705-221949F",
                     "            timestamp start/stop: 2018-07-05 22:19:49 / 2018-07-05 22:20:04",
                     "            wal start/stop: 000000080000000000000026 / 000000080000000000000026",
                     "            database size: 25.5MB, backup size: 25.5MB",
                     "            repository size: 3MB, repository backup size: 3MB",
                     "",
                     "        full backup: 20180705-222005F",
                     "            timestamp start/stop: 2018-07-05 22:20:05 / 2018-07-05 22:20:15",
                     "            wal start/stop: 000000080000000000000028 / 000000080000000000000028",
                     "            database size: 25.5MB, backup size: 25.5MB",
                     "            repository size: 3MB, repository backup size: 3MB"
                  ]
               }
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres pgbackrest stop"
                  ],
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u backrest pgbackrest --stanza=demo backup"
                  ],
                  "err-expect" : "62",
                  "highlight" : {
                     "filter" : true,
                     "filter-context" : 2,
                     "list" : [
                        "\\: stop file exists for all stanzas"
                     ]
                  },
                  "host" : "backup",
                  "output" : true
               },
               "type" : "exe",
               "value" : {
                  "output" : [
                     "P00  ERROR: [062]: raised from remote process on 'db-primary': stop file exists for all stanzas"
                  ]
               }
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres pgbackrest stop"
                  ],
                  "host" : "db-primary",
                  "output" : true
               },
               "type" : "exe",
               "value" : {
                  "output" : [
                     "P00   WARN: stop file already exists for all stanzas"
                  ]
               }
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres pgbackrest start"
                  ],
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres pgbackrest --stanza=demo stop"
                  ],
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u backrest pgbackrest --stanza=demo backup"
                  ],
                  "err-expect" : "62",
                  "highlight" : {
                     "filter" : true,
                     "filter-context" : 2,
                     "list" : [
                        "\\: stop file exists for stanza demo"
                     ]
                  },
                  "host" : "backup",
                  "output" : true
               },
               "type" : "exe",
               "value" : {
                  "output" : [
                     "P00  ERROR: [062]: raised from remote process on 'db-primary': stop file exists for stanza demo"
                  ]
               }
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres pgbackrest --stanza=demo start"
                  ],
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "image" : "pgbackrest/test:u16-base",
                  "name" : "db-standby",
                  "os" : "u16"
               },
               "type" : "host",
               "value" : {
                  "ip" : "172.17.0.5"
               }
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo apt-get install libdbd-pg-perl libio-socket-ssl-perl libxml-libxml-perl"
                  ],
                  "cmd-extra" : "-y 2>&1",
                  "host" : "db-standby",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo mkdir /root/pgbackrest-release-1.29"
                  ],
                  "host" : "db-standby",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo cp -r /backrest/bin /root/pgbackrest-release-1.29"
                  ],
                  "host" : "db-standby",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo cp -r /backrest/build /root/pgbackrest-release-1.29"
                  ],
                  "host" : "db-standby",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo cp -r /backrest/lib /root/pgbackrest-release-1.29"
                  ],
                  "host" : "db-standby",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo cp -r /backrest/libc /root/pgbackrest-release-1.29"
                  ],
                  "host" : "db-standby",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo cp -r /backrest/src /root/pgbackrest-release-1.29"
                  ],
                  "host" : "db-standby",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo cp -r /root/pgbackrest-release-1.29/lib/pgBackRest \\",
                     "    /usr/share/perl5"
                  ],
                  "host" : "db-standby",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo find /usr/share/perl5/pgBackRest -type f -exec chmod 644 {} +"
                  ],
                  "host" : "db-standby",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo find /usr/share/perl5/pgBackRest -type d -exec chmod 755 {} +"
                  ],
                  "host" : "db-standby",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo cp /root/pgbackrest-release-1.29/bin/pgbackrest /usr/bin/pgbackrest"
                  ],
                  "host" : "db-standby",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo chmod 755 /usr/bin/pgbackrest"
                  ],
                  "host" : "db-standby",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo mkdir -m 770 /var/log/pgbackrest"
                  ],
                  "host" : "db-standby",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo chown postgres:postgres /var/log/pgbackrest"
                  ],
                  "host" : "db-standby",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo touch /etc/pgbackrest.conf"
                  ],
                  "host" : "db-standby",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo chmod 640 /etc/pgbackrest.conf"
                  ],
                  "host" : "db-standby",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo chown postgres:postgres /etc/pgbackrest.conf"
                  ],
                  "host" : "db-standby",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo sh -c 'cd /root/pgbackrest-release-1.29/libc && \\",
                     "    perl Makefile.PL INSTALLMAN1DIR=none INSTALLMAN3DIR=none'"
                  ],
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo make -C /root/pgbackrest-release-1.29/libc test"
                  ],
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo make -C /root/pgbackrest-release-1.29/libc install"
                  ],
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo pg_createcluster 9.4 demo"
                  ],
                  "host" : "db-standby",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres mkdir -m 750 -p /home/postgres/.ssh"
                  ],
                  "host" : "db-standby",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres ssh-keygen -f /home/postgres/.ssh/id_rsa -t rsa -b 4096 -N \"\""
                  ],
                  "host" : "db-standby",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo ssh root@db-standby cat /home/postgres/.ssh/id_rsa.pub | \\",
                     "    sudo -u backrest tee -a /home/backrest/.ssh/authorized_keys"
                  ],
                  "host" : "backup",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo ssh root@backup cat /home/backrest/.ssh/id_rsa.pub | \\",
                     "    sudo -u postgres tee -a /home/postgres/.ssh/authorized_keys"
                  ],
                  "host" : "db-standby",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u backrest ssh postgres@db-standby"
                  ],
                  "cmd-extra" : "-o StrictHostKeyChecking=no ls",
                  "host" : "backup",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres ssh backrest@backup"
                  ],
                  "cmd-extra" : "-o StrictHostKeyChecking=no ls",
                  "host" : "db-standby",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "file" : "/etc/postgresql/9.4/demo/postgresql.conf",
                  "host" : "db-standby",
                  "option" : {
                     "log_filename" : {
                        "value" : "'postgresql.log'"
                     },
                     "log_line_prefix" : {
                        "value" : "''"
                     }
                  }
               },
               "type" : "cfg-postgresql",
               "value" : {
                  "config" : [
                     "log_filename = 'postgresql.log'",
                     "log_line_prefix = ''"
                  ]
               }
            },
            {
               "key" : {
                  "file" : "/etc/pgbackrest.conf",
                  "host" : "db-standby",
                  "option" : {
                     "demo" : {
                        "db-path" : {
                           "value" : "/var/lib/postgresql/9.4/demo"
                        },
                        "recovery-option" : {
                           "value" : "standby_mode=on"
                        }
                     },
                     "global" : {
                        "backup-host" : {
                           "value" : "backup"
                        },
                        "log-level-stderr" : {
                           "value" : "off"
                        },
                        "log-timestamp" : {
                           "value" : "n"
                        }
                     }
                  }
               },
               "type" : "cfg-pgbackrest",
               "value" : {
                  "config" : [
                     "[demo]",
                     "db-path=/var/lib/postgresql/9.4/demo",
                     "recovery-option=standby_mode=on",
                     "",
                     "[global]",
                     "backup-host=backup"
                  ]
               }
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres pgbackrest --stanza=demo --delta restore"
                  ],
                  "host" : "db-standby",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres cat /var/lib/postgresql/9.4/demo/recovery.conf"
                  ],
                  "host" : "db-standby",
                  "output" : true
               },
               "type" : "exe",
               "value" : {
                  "output" : [
                     "standby_mode = 'on'",
                     "restore_command = '/usr/bin/pgbackrest --stanza=demo archive-get %f \"%p\"'"
                  ]
               }
            },
            {
               "key" : {
                  "file" : "/etc/postgresql/9.4/demo/postgresql.conf",
                  "host" : "db-standby",
                  "option" : {
                     "hot_standby" : {
                        "value" : "on"
                     }
                  }
               },
               "type" : "cfg-postgresql",
               "value" : {
                  "config" : [
                     "hot_standby = on",
                     "log_filename = 'postgresql.log'",
                     "log_line_prefix = ''"
                  ]
               }
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo rm /var/log/postgresql/postgresql-9.4-demo.log"
                  ],
                  "host" : "db-standby",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo pg_ctlcluster 9.4 demo start"
                  ],
                  "host" : "db-standby",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres sleep 2"
                  ],
                  "host" : "db-standby",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres cat /var/log/postgresql/postgresql-9.4-demo.log"
                  ],
                  "highlight" : {
                     "filter" : true,
                     "filter-context" : 2,
                     "list" : [
                        "entering standby mode|database system is ready to accept read only connections"
                     ]
                  },
                  "host" : "db-standby",
                  "output" : true
               },
               "type" : "exe",
               "value" : {
                  "output" : [
                     "LOG:  could not bind IPv6 socket: Cannot assign requested address",
                     "HINT:  Is another postmaster already running on port 5432? If not, wait a few seconds and retry.",
                     "LOG:  database system was interrupted; last known up at 2018-07-05 22:20:06 UTC",
                     "LOG:  entering standby mode",
                     "LOG:  restored log file \"00000008.history\" from archive",
                     "LOG:  incomplete startup packet",
                     "LOG:  restored log file \"000000080000000000000028\" from archive",
                     "LOG:  redo starts at 0/28000028",
                     "LOG:  consistent recovery state reached at 0/280000F0",
                     "LOG:  database system is ready to accept read only connections"
                  ]
               }
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres psql -c \" \\",
                     "    begin; \\",
                     "    create table replicated_table (message text); \\",
                     "    insert into replicated_table values ('Important Data'); \\",
                     "    commit; \\",
                     "    select * from replicated_table\";"
                  ],
                  "highlight" : {
                     "filter" : true,
                     "filter-context" : 2,
                     "list" : [
                        "Important Data"
                     ]
                  },
                  "host" : "db-primary",
                  "output" : true
               },
               "type" : "exe",
               "value" : {
                  "output" : [
                     "    message     ",
                     "----------------",
                     " Important Data",
                     "(1 row)"
                  ]
               }
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres psql -c \"select * from replicated_table;\""
                  ],
                  "err-expect" : "1",
                  "highlight" : {
                     "filter" : true,
                     "filter-context" : 2,
                     "list" : [
                        "does not exist"
                     ]
                  },
                  "host" : "db-standby",
                  "output" : true
               },
               "type" : "exe",
               "value" : {
                  "output" : [
                     "ERROR:  relation \"replicated_table\" does not exist",
                     "LINE 1: select * from replicated_table;",
                     "                      ^"
                  ]
               }
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres psql -c \"select *, current_timestamp from pg_switch_xlog()\";"
                  ],
                  "host" : "db-primary",
                  "output" : true
               },
               "type" : "exe",
               "value" : {
                  "output" : [
                     " pg_switch_xlog |              now              ",
                     "----------------+-------------------------------",
                     " 0/290199E0     | 2018-07-05 22:20:49.401096+00",
                     "(1 row)"
                  ]
               }
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres psql -c \" \\",
                     "    select *, current_timestamp from replicated_table\""
                  ],
                  "highlight" : {
                     "filter" : false,
                     "filter-context" : 2,
                     "list" : [
                        "Important Data"
                     ]
                  },
                  "host" : "db-standby",
                  "output" : true
               },
               "type" : "exe",
               "value" : {
                  "output" : [
                     "    message     |              now              ",
                     "----------------+-------------------------------",
                     " Important Data | 2018-07-05 22:20:50.956462+00",
                     "(1 row)"
                  ]
               }
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres pgbackrest --stanza=demo --log-level-console=info check"
                  ],
                  "highlight" : {
                     "filter" : true,
                     "filter-context" : 2,
                     "list" : [
                        "all other checks passed"
                     ]
                  },
                  "host" : "db-standby",
                  "output" : true
               },
               "type" : "exe",
               "value" : {
                  "output" : [
                     "P00   INFO: check command begin 1.29: --backup-host=backup --db1-path=/var/lib/postgresql/9.4/demo --log-level-console=info --log-level-stderr=off --no-log-timestamp --stanza=demo",
                     "P00   INFO: switch xlog cannot be performed on the standby, all other checks passed successfully",
                     "P00   INFO: check command end: completed successfully"
                  ]
               }
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres psql -c \" \\",
                     "    create user replicator password 'jw8s0F4' replication\";"
                  ],
                  "host" : "db-primary",
                  "output" : true
               },
               "type" : "exe",
               "value" : {
                  "output" : [
                     "CREATE ROLE"
                  ]
               }
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres sh -c 'echo \\",
                     "    \"host    replication     replicator      172.17.0.5/32           md5\" \\",
                     "    >> /etc/postgresql/9.4/demo/pg_hba.conf'"
                  ],
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo pg_ctlcluster 9.4 demo reload"
                  ],
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "file" : "/etc/pgbackrest.conf",
                  "host" : "db-standby",
                  "option" : {
                     "demo" : {
                        "recovery-option" : {
                           "value" : "primary_conninfo=host=172.17.0.3 port=5432 user=replicator"
                        }
                     }
                  }
               },
               "type" : "cfg-pgbackrest",
               "value" : {
                  "config" : [
                     "[demo]",
                     "db-path=/var/lib/postgresql/9.4/demo",
                     "recovery-option=standby_mode=on",
                     "recovery-option=primary_conninfo=host=172.17.0.3 port=5432 user=replicator",
                     "",
                     "[global]",
                     "backup-host=backup"
                  ]
               }
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres sh -c 'echo \\",
                     "    \"172.17.0.3:*:replication:replicator:jw8s0F4\" \\",
                     "    >> /home/postgres/.pgpass'"
                  ],
                  "host" : "db-standby",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres chmod 600 /home/postgres/.pgpass"
                  ],
                  "host" : "db-standby",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo pg_ctlcluster 9.4 demo stop"
                  ],
                  "host" : "db-standby",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres pgbackrest --stanza=demo --delta restore"
                  ],
                  "host" : "db-standby",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres cat /var/lib/postgresql/9.4/demo/recovery.conf"
                  ],
                  "host" : "db-standby",
                  "output" : true
               },
               "type" : "exe",
               "value" : {
                  "output" : [
                     "primary_conninfo = 'host=172.17.0.3 port=5432 user=replicator'",
                     "standby_mode = 'on'",
                     "restore_command = '/usr/bin/pgbackrest --stanza=demo archive-get %f \"%p\"'"
                  ]
               }
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo rm /var/log/postgresql/postgresql-9.4-demo.log"
                  ],
                  "host" : "db-standby",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo pg_ctlcluster 9.4 demo start"
                  ],
                  "host" : "db-standby",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres sleep 2"
                  ],
                  "host" : "db-standby",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres cat /var/log/postgresql/postgresql-9.4-demo.log"
                  ],
                  "highlight" : {
                     "filter" : true,
                     "filter-context" : 2,
                     "list" : [
                        "started streaming WAL from primary"
                     ]
                  },
                  "host" : "db-standby",
                  "output" : true
               },
               "type" : "exe",
               "value" : {
                  "output" : [
                     "       [filtered 10 lines of output]",
                     "LOG:  database system is ready to accept read only connections",
                     "LOG:  restored log file \"000000080000000000000029\" from archive",
                     "LOG:  started streaming WAL from primary at 0/2A000000 on timeline 8"
                  ]
               }
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres psql -c \" \\",
                     "    begin; \\",
                     "    create table stream_table (message text); \\",
                     "    insert into stream_table values ('Important Data'); \\",
                     "    commit; \\",
                     "    select *, current_timestamp from stream_table\";"
                  ],
                  "highlight" : {
                     "filter" : true,
                     "filter-context" : 2,
                     "list" : [
                        "Important Data"
                     ]
                  },
                  "host" : "db-primary",
                  "output" : true
               },
               "type" : "exe",
               "value" : {
                  "output" : [
                     "    message     |              now              ",
                     "----------------+-------------------------------",
                     " Important Data | 2018-07-05 22:21:03.489564+00",
                     "(1 row)"
                  ]
               }
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres psql -c \" \\",
                     "    select *, current_timestamp from stream_table\""
                  ],
                  "highlight" : {
                     "filter" : false,
                     "filter-context" : 2,
                     "list" : [
                        "Important Data"
                     ]
                  },
                  "host" : "db-standby",
                  "output" : true
               },
               "type" : "exe",
               "value" : {
                  "output" : [
                     "    message     |             now             ",
                     "----------------+-----------------------------",
                     " Important Data | 2018-07-05 22:21:03.7855+00",
                     "(1 row)"
                  ]
               }
            },
            {
               "key" : {
                  "file" : "/etc/pgbackrest.conf",
                  "host" : "backup",
                  "option" : {
                     "demo" : {
                        "db2-host" : {
                           "value" : "db-standby"
                        },
                        "db2-path" : {
                           "value" : "/var/lib/postgresql/9.4/demo"
                        },
                        "db2-user" : {
                           "value" : "postgres"
                        }
                     },
                     "global" : {
                        "backup-standby" : {
                           "value" : "y"
                        }
                     }
                  }
               },
               "type" : "cfg-pgbackrest",
               "value" : {
                  "config" : [
                     "[demo]",
                     "db1-host=db-primary",
                     "db1-path=/var/lib/postgresql/9.4/demo",
                     "db1-user=postgres",
                     "db2-host=db-standby",
                     "db2-path=/var/lib/postgresql/9.4/demo",
                     "db2-user=postgres",
                     "",
                     "[global]",
                     "backup-standby=y",
                     "process-max=3",
                     "repo-path=/var/lib/pgbackrest",
                     "retention-full=2",
                     "start-fast=y"
                  ]
               }
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u backrest pgbackrest --stanza=demo --log-level-console=detail backup"
                  ],
                  "highlight" : {
                     "filter" : true,
                     "filter-context" : 2,
                     "list" : [
                        "backup file db-primary|replay on the standby"
                     ]
                  },
                  "host" : "backup",
                  "output" : true
               },
               "type" : "exe",
               "value" : {
                  "output" : [
                     "       [filtered 2 lines of output]",
                     "P00   INFO: execute exclusive pg_start_backup() with label \"pgBackRest backup started at 2018-07-05 22:21:04\": backup begins after the requested immediate checkpoint completes",
                     "P00   INFO: backup start archive = 00000008000000000000002B, lsn = 0/2B000028",
                     "P00   INFO: wait for replay on the standby to reach 0/2B000028",
                     "P00   INFO: replay on the standby reached 0/2B0000C8",
                     "P04   INFO: backup file db-standby:/var/lib/postgresql/9.4/demo/base/12139/12009 (240KB, 12%) checksum 14a2c1b5fe6f7155aaeaaec0ca7eb60c46aa5ac1",
                     "P02   INFO: backup file db-standby:/var/lib/postgresql/9.4/demo/base/12139/12007 (392KB, 32%) checksum 87f10131e163854653b5968b390075c2dbfbb735",
                     "P04   INFO: backup file db-standby:/var/lib/postgresql/9.4/demo/base/12139/12010 (232KB, 44%) checksum 3dbbb29edd9a48fd214a407048690b5dee1b9f75",
                     "P02   INFO: backup file db-standby:/var/lib/postgresql/9.4/demo/base/12139/11891 (128KB, 51%) checksum c111ec02806557817e44dceb037f760d69e6e58a",
                     "P04   INFO: backup file db-standby:/var/lib/postgresql/9.4/demo/base/12139/11892 (88KB, 55%) checksum 5c5d1c6a0b94c76eee597f9812fc105863097dbc",
                     "P01   INFO: backup file db-primary:/var/lib/postgresql/9.4/demo/global/pg_control (8KB, 56%) checksum c3017ecef8bf1b95a65ab87e0a323d6f1035ba92",
                     "P02   INFO: backup file db-standby:/var/lib/postgresql/9.4/demo/base/12139/11900 (64KB, 59%) checksum 85f2904959a51142abfeee4ac714c0b83768ebc4",
                     "P01   INFO: backup file db-primary:/var/lib/postgresql/9.4/demo/backup_label (238B, 59%) checksum 839bb33be4e25f8a2bda51cdda80cd5761fe934a",
                     "P02   INFO: backup file db-standby:/var/lib/postgresql/9.4/demo/base/12139/11903 (56KB, 62%) checksum 6469c3d1fc92d2d1792b2f66dab2266660bdd09f",
                     "P03   INFO: backup file db-standby:/var/lib/postgresql/9.4/demo/base/12139/11889 (344KB, 80%) checksum 95f362e9fd6b1863138b8c3e9d5a6bf872c9dc15",
                     "       [filtered 29 lines of output]"
                  ]
               }
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo apt-get install postgresql-9.5"
                  ],
                  "cmd-extra" : "-y",
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo pg_dropcluster 9.5 main"
                  ],
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres /usr/lib/postgresql/9.5/bin/initdb \\",
                     "    -D /var/lib/postgresql/9.5/demo -k -A peer"
                  ],
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo pg_createcluster 9.5 demo"
                  ],
                  "host" : "db-primary",
                  "output" : true
               },
               "type" : "exe",
               "value" : {
                  "output" : [
                     "Configuring already existing cluster (configuration: /etc/postgresql/9.5/demo, data: /var/lib/postgresql/9.5/demo, owner: 5000:5000)",
                     "Ver Cluster Port Status Owner    Data directory               Log file",
                     "9.5 demo    5433 down   postgres /var/lib/postgresql/9.5/demo /var/log/postgresql/postgresql-9.5-demo.log"
                  ]
               }
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo pg_ctlcluster 9.4 demo stop"
                  ],
                  "host" : "db-standby",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo apt-get install postgresql-9.5"
                  ],
                  "cmd-extra" : "-y",
                  "host" : "db-standby",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo pg_dropcluster 9.5 main"
                  ],
                  "host" : "db-standby",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo pg_ctlcluster 9.4 demo stop"
                  ],
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres sh -c 'cd /var/lib/postgresql && \\",
                     "    /usr/lib/postgresql/9.5/bin/pg_upgrade \\",
                     "    --old-bindir=/usr/lib/postgresql/9.4/bin \\",
                     "    --new-bindir=/usr/lib/postgresql/9.5/bin \\",
                     "    --old-datadir=/var/lib/postgresql/9.4/demo \\",
                     "    --new-datadir=/var/lib/postgresql/9.5/demo \\",
                     "    --old-options=\" -c config_file=/etc/postgresql/9.4/demo/postgresql.conf\" \\",
                     "    --new-options=\" -c config_file=/etc/postgresql/9.5/demo/postgresql.conf\"'"
                  ],
                  "highlight" : {
                     "filter" : true,
                     "filter-context" : 2,
                     "list" : [
                        "Upgrade Complete"
                     ]
                  },
                  "host" : "db-primary",
                  "output" : true
               },
               "type" : "exe",
               "value" : {
                  "output" : [
                     "       [filtered 68 lines of output]",
                     "Creating script to delete old cluster                       ok",
                     "",
                     "Upgrade Complete",
                     "----------------",
                     "Optimizer statistics are not transferred by pg_upgrade so,",
                     "       [filtered 4 lines of output]"
                  ]
               }
            },
            {
               "key" : {
                  "file" : "/etc/postgresql/9.5/demo/postgresql.conf",
                  "host" : "db-primary",
                  "option" : {
                     "archive_command" : {
                        "value" : "'pgbackrest --stanza=demo archive-push %p'"
                     },
                     "archive_mode" : {
                        "value" : "on"
                     },
                     "listen_addresses" : {
                        "value" : "'*'"
                     },
                     "log_line_prefix" : {
                        "value" : "''"
                     },
                     "max_wal_senders" : {
                        "value" : "3"
                     },
                     "port" : {
                        "value" : "5432"
                     },
                     "wal_level" : {
                        "value" : "hot_standby"
                     }
                  }
               },
               "type" : "cfg-postgresql",
               "value" : {
                  "config" : [
                     "archive_command = 'pgbackrest --stanza=demo archive-push %p'",
                     "archive_mode = on",
                     "listen_addresses = '*'",
                     "log_line_prefix = ''",
                     "max_wal_senders = 3",
                     "port = 5432",
                     "wal_level = hot_standby"
                  ]
               }
            },
            {
               "key" : {
                  "file" : "/etc/pgbackrest.conf",
                  "host" : "db-primary",
                  "option" : {
                     "demo" : {
                        "db-path" : {
                           "value" : "/var/lib/postgresql/9.5/demo"
                        }
                     }
                  }
               },
               "type" : "cfg-pgbackrest",
               "value" : {
                  "config" : [
                     "[demo]",
                     "db-path=/var/lib/postgresql/9.5/demo",
                     "",
                     "[global]",
                     "archive-async=y",
                     "backup-host=backup",
                     "backup-user=backrest",
                     "log-level-file=detail",
                     "spool-path=/var/spool/pgbackrest",
                     "",
                     "[global:archive-push]",
                     "process-max=2"
                  ]
               }
            },
            {
               "key" : {
                  "file" : "/etc/pgbackrest.conf",
                  "host" : "db-standby",
                  "option" : {
                     "demo" : {
                        "db-path" : {
                           "value" : "/var/lib/postgresql/9.5/demo"
                        }
                     }
                  }
               },
               "type" : "cfg-pgbackrest",
               "value" : {
                  "config" : [
                     "[demo]",
                     "db-path=/var/lib/postgresql/9.5/demo",
                     "recovery-option=standby_mode=on",
                     "recovery-option=primary_conninfo=host=172.17.0.3 port=5432 user=replicator",
                     "",
                     "[global]",
                     "backup-host=backup"
                  ]
               }
            },
            {
               "key" : {
                  "file" : "/etc/pgbackrest.conf",
                  "host" : "backup",
                  "option" : {
                     "demo" : {
                        "db1-path" : {
                           "value" : "/var/lib/postgresql/9.5/demo"
                        },
                        "db2-path" : {
                           "value" : "/var/lib/postgresql/9.5/demo"
                        }
                     },
                     "global" : {
                        "backup-standby" : {
                           "value" : "n"
                        }
                     }
                  }
               },
               "type" : "cfg-pgbackrest",
               "value" : {
                  "config" : [
                     "[demo]",
                     "db1-host=db-primary",
                     "db1-path=/var/lib/postgresql/9.5/demo",
                     "db1-user=postgres",
                     "db2-host=db-standby",
                     "db2-path=/var/lib/postgresql/9.5/demo",
                     "db2-user=postgres",
                     "",
                     "[global]",
                     "backup-standby=n",
                     "process-max=3",
                     "repo-path=/var/lib/pgbackrest",
                     "retention-full=2",
                     "start-fast=y"
                  ]
               }
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo cp /etc/postgresql/9.4/demo/pg_hba.conf \\",
                     "    /etc/postgresql/9.5/demo/pg_hba.conf"
                  ],
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u backrest pgbackrest --stanza=demo --no-online \\",
                     "    --log-level-console=info stanza-upgrade"
                  ],
                  "highlight" : {
                     "filter" : true,
                     "filter-context" : 2,
                     "list" : [
                        "completed successfully"
                     ]
                  },
                  "host" : "backup",
                  "output" : true
               },
               "type" : "exe",
               "value" : {
                  "output" : [
                     "P00   INFO: stanza-upgrade command begin 1.29: --no-backup-standby --db1-host=db-primary --db1-path=/var/lib/postgresql/9.5/demo --db1-user=postgres --db2-host=db-standby --db2-path=/var/lib/postgresql/9.5/demo --db2-user=postgres --log-level-console=info --log-level-stderr=off --no-log-timestamp --no-online --repo-path=/var/lib/pgbackrest --stanza=demo",
                     "P00   INFO: stanza-upgrade command end: completed successfully"
                  ]
               }
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo pg_ctlcluster 9.5 demo start"
                  ],
                  "host" : "db-primary",
                  "output" : true
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres pg_lsclusters"
                  ],
                  "host" : "db-primary",
                  "output" : true
               },
               "type" : "exe",
               "value" : {
                  "output" : [
                     "Ver Cluster Port Status Owner    Data directory               Log file",
                     "9.4 demo    5432 down   postgres /var/lib/postgresql/9.4/demo /var/log/postgresql/postgresql-9.4-demo.log",
                     "9.5 demo    5432 online postgres /var/lib/postgresql/9.5/demo /var/log/postgresql/postgresql-9.5-demo.log"
                  ]
               }
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres pgbackrest --stanza=demo check"
                  ],
                  "host" : "db-primary",
                  "output" : true
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u backrest pgbackrest --stanza=demo check"
                  ],
                  "host" : "backup",
                  "output" : true
               },
               "type" : "exe",
               "value" : {
                  "output" : [
                     "P00   WARN: [056]: raised from remote process on 'db-standby': could not connect to server: No such file or directory",
                     "            \tIs the server running locally and accepting",
                     "            \tconnections on Unix domain socket \"/var/run/postgresql/.s.PGSQL.5432\"?"
                  ]
               }
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo pg_dropcluster 9.4 demo"
                  ],
                  "host" : "db-primary",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u backrest pgbackrest --stanza=demo --type=full backup"
                  ],
                  "host" : "backup",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo pg_dropcluster 9.4 demo"
                  ],
                  "host" : "db-standby",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres /usr/lib/postgresql/9.5/bin/initdb \\",
                     "    -D /var/lib/postgresql/9.5/demo -k -A peer"
                  ],
                  "host" : "db-standby",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo pg_createcluster 9.5 demo"
                  ],
                  "host" : "db-standby",
                  "output" : true
               },
               "type" : "exe",
               "value" : {
                  "output" : [
                     "Configuring already existing cluster (configuration: /etc/postgresql/9.5/demo, data: /var/lib/postgresql/9.5/demo, owner: 5000:5000)",
                     "Ver Cluster Port Status Owner    Data directory               Log file",
                     "9.5 demo    5432 down   postgres /var/lib/postgresql/9.5/demo /var/log/postgresql/postgresql-9.5-demo.log"
                  ]
               }
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres pgbackrest --stanza=demo --delta restore"
                  ],
                  "host" : "db-standby",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "file" : "/etc/postgresql/9.5/demo/postgresql.conf",
                  "host" : "db-standby",
                  "option" : {
                     "hot_standby" : {
                        "value" : "on"
                     }
                  }
               },
               "type" : "cfg-postgresql",
               "value" : {
                  "config" : [
                     "hot_standby = on"
                  ]
               }
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo pg_ctlcluster 9.5 demo start"
                  ],
                  "host" : "db-standby",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "cmd" : [
                     "sudo -u postgres sleep 2"
                  ],
                  "host" : "db-standby",
                  "output" : false
               },
               "type" : "exe"
            },
            {
               "key" : {
                  "file" : "/etc/pgbackrest.conf",
                  "host" : "backup",
                  "option" : {
                     "global" : {
                        "backup-standby" : {
                           "value" : "y"
                        }
                     }
                  }
               },
               "type" : "cfg-pgbackrest",
               "value" : {
                  "config" : [
                     "[demo]",
                     "db1-host=db-primary",
                     "db1-path=/var/lib/postgresql/9.5/demo",
                     "db1-user=postgres",
                     "db2-host=db-standby",
                     "db2-path=/var/lib/postgresql/9.5/demo",
                     "db2-user=postgres",
                     "",
                     "[global]",
                     "backup-standby=y",
                     "process-max=3",
                     "repo-path=/var/lib/pgbackrest",
                     "retention-full=2",
                     "start-fast=y"
                  ]
               }
            }
         ]
      }
   }
}
